!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Zotero=e()}}(function(){var e;return function t(e,r,o){function n(a,s){if(!r[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[a]={exports:{}};e[a][0].call(l.exports,function(t){var r=e[a][1][t];return n(r?r:t)},l,l.exports,t,e,r,o)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)n(o[a]);return n}({1:[function(e,t,r){(function(r){"use strict";if("undefined"==typeof window)var o=window;else var o=r;var n=e("./src/Base.js");o.Zotero=o.Z=n,n.Cache=e("./src/Cache.js"),n.Ajax=n.ajax=e("./src/Ajax.js"),n.ApiObject=e("./src/ApiObject.js"),n.ApiResponse=e("./src/ApiResponse.js"),n.Net=n.net=e("./src/Net.js"),n.Library=e("./src/Library.js"),n.Container=e("./src/Container"),n.Collections=e("./src/Collections.js"),n.Items=e("./src/Items.js"),n.Tags=e("./src/Tags.js"),n.Groups=e("./src/Groups.js"),n.Searches=e("./src/Searches.js"),n.Deleted=e("./src/Deleted.js"),n.Collection=e("./src/Collection.js"),n.Localizations=n.localizations=e("./src/Localizations.js"),n.Item=e("./src/Item.js"),n.Tag=e("./src/Tag.js"),n.Search=e("./src/Search.js"),n.Group=e("./src/Group.js"),n.User=e("./src/User.js"),n.Utils=n.utils=e("./src/Utils.js"),n.Url=n.url=e("./src/Url.js"),n.File=n.file=e("./src/File.js"),n.Idb=e("./src/Idb.js"),n.Preferences=e("./src/Preferences.js"),t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/Ajax.js":50,"./src/ApiObject.js":51,"./src/ApiResponse.js":52,"./src/Base.js":53,"./src/Cache.js":54,"./src/Collection.js":55,"./src/Collections.js":56,"./src/Container":57,"./src/Deleted.js":58,"./src/File.js":59,"./src/Group.js":60,"./src/Groups.js":61,"./src/Idb.js":62,"./src/Item.js":63,"./src/Items.js":65,"./src/Library.js":66,"./src/Localizations.js":67,"./src/Net.js":68,"./src/Preferences.js":69,"./src/Search.js":70,"./src/Searches.js":71,"./src/Tag.js":72,"./src/Tags.js":73,"./src/Url.js":74,"./src/User.js":75,"./src/Utils.js":76}],2:[function(e,t,r){!function(e){if(!Array.prototype.find){var t=function(e){var t=Object(this),r=t.length<0?0:t.length>>>0;if(0!==r){if("function"!=typeof e||"[object Function]"!==Object.prototype.toString.call(e))throw new TypeError("Array#find: predicate must be a function");for(var o,n=arguments[1],i=0;r>i;i++)if(o=t[i],e.call(n,o,i,t))return o}};if(Object.defineProperty)try{Object.defineProperty(Array.prototype,"find",{value:t,configurable:!0,enumerable:!1,writable:!0})}catch(r){}Array.prototype.find||(Array.prototype.find=t)}}(this)},{}],3:[function(e,t,r){!function(e){if(!Array.prototype.findIndex){var t=function(e){var t=Object(this),r=Math.max(0,t.length)>>>0;if(0===r)return-1;if("function"!=typeof e||"[object Function]"!==Object.prototype.toString.call(e))throw new TypeError("Array#findIndex: predicate must be a function");for(var o=arguments.length>1?arguments[1]:void 0,n=0;r>n;n++)if(e.call(o,t[n],n,t))return n;return-1};if(Object.defineProperty)try{Object.defineProperty(Array.prototype,"findIndex",{value:t,configurable:!0,writable:!0})}catch(r){}Array.prototype.findIndex||(Array.prototype.findIndex=t)}}(this)},{}],4:[function(e,t,r){t.exports=function(e){function t(e,t){if(n(e))for(var r=0;r<e.length;r++)t(e[r]);else t(e)}function r(e){var i="pending",a=[],s=[],u=[],c=null,l=null,p=o++,d={done:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(n(arguments[e]))for(var t=arguments[e],r=0;r<t.length;r++)"resolved"===i&&t[r].apply(this===f?d:this,l),a.push(t[r].bind(this===f?d:this));else"resolved"===i&&arguments[e].apply(this===f?d:this,l),a.push(arguments[e].bind(this===f?d:this));return this},fail:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(n(arguments[e]))for(var t=arguments[e],r=0;r<t.length;r++)"rejected"===i&&t[r].apply(this===f?d:this,l),s.push(t[r].bind(this===f?d:this));else"rejected"===i&&arguments[e].apply(this===f?d:this,l),s.push(arguments[e].bind(this===f?d:this));return this},always:function(){return d.done.apply(d,arguments).fail.apply(d,arguments),this},progress:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(n(arguments[e]))for(var t=arguments[e],r=0;r<t.length;r++)"pending"===i&&u.push(t[r]),null!==c&&t[r].apply(f,c);else"pending"===i&&u.push(arguments[e]),null!==c&&arguments[e].apply(f,c);return this},promise:function(e){if(null==e)return d;for(var t in d)e[t]=d[t];return e},state:function(){return i},debug:function(){console.log("id",p),console.log("[debug]",a,s,i)},isRejected:function(){return"rejected"===i},isResolved:function(){return"resolved"===i},pipe:function(e,o,n){var i=r(function(r){var i=this;t(e||null,function(e){"function"==typeof e?f.done(function(){var t=e.apply(this,arguments);t&&"function"==typeof t.promise?t.promise().done(r.resolve).fail(r.reject).progress(r.notify):r.resolveWith(this===d?r.promise():this,[t])}.bind(i)):f.done(r.resolve)}),t(o||null,function(e){"function"==typeof e?f.fail(function(){var t=e.apply(this,arguments);t&&"function"==typeof t.promise?t.promise().done(r.resolve).fail(r.reject).progress(r.notify):r.rejectWith(this===d?r.promise():this,[t])}.bind(i)):f.fail(r.reject)}),t(n||null,function(e){"function"==typeof e?f.progress(function(){var t=e.apply(this,arguments);t&&"function"==typeof t.promise?t.promise().done(r.resolve).fail(r.reject).progress(r.notify):r.notifyWith(this===d?r.promise():this,[t])}.bind(i)):f.progress(r.notify)})});return i.promise()},getContext:function(){return context},getId:function(){return p}},f={resolveWith:function(e){if("pending"===i){i="resolved";for(var t=l=arguments.length>1?arguments[1]:[],r=0;r<a.length;r++)a[r].apply(e,t)}return this},rejectWith:function(e){if("pending"===i){i="rejected";for(var t=l=arguments.length>1?arguments[1]:[],r=0;r<s.length;r++)s[r].apply(e,t)}return this},notifyWith:function(e){var t;if("pending"===i){t=c=arguments.length>1?arguments[1]:[];for(var r=0;r<u.length;r++)u[r].apply(e,t)}return this},resolve:function(){var e=f.resolveWith(this===f?d:this,arguments);return this!==f?this:e},reject:function(){var e=f.rejectWith(this===f?d:this,arguments);return this!==f?this:e},notify:function(){var e=f.notifyWith(this===f?d:this,arguments);return this!==f?this:e}};d.then=d.pipe;var h=d.promise(f);return context=h,h.id=f.id=p,e&&e.apply(h,[h]),h}var o=0,n=function(e){return"[object Array]"===Object.prototype.toString.call(e)};return r.when=function(){if(arguments.length<2){var t=arguments.length?arguments[0]:void 0;return t&&"function"==typeof t.isResolved&&"function"==typeof t.isRejected?t.promise():r().resolveWith(e,[t]).promise()}return function(e){for(var t=r(),o=e.length,n=0,i=new Array(o),a=new Array(o),s=[],u=0;u<e.length;u++)s[u]=e[u]&&e[u].promise?e[u].promise():void 0,function(r){var u=null;e[r].done?e[r].done(function(){i[r]=arguments.length<2?arguments[0]:arguments,++n==o&&t.resolve.apply(s,i)}).fail(function(){t.reject.apply(s,arguments)}):(u=e[r],e[r]=new Deferred,e[r].done(function(){i[r]=arguments.length<2?arguments[0]:arguments,++n==o&&t.resolve.apply(s,i)}).fail(function(){t.reject.apply(s,arguments)}).resolve(u)),console.log("execing progress"),e[r].progress(function(){a[r]=arguments.length<2?arguments[0]:arguments,t.notify.apply(s,a)})}(u);return t.promise()}(arguments)},r}({})},{}],5:[function(e,t,r){"use strict";e("array.prototype.find"),e("array.prototype.findindex");var o=e("./lib/FDBFactory");t.exports=new o},{"./lib/FDBFactory":12,"array.prototype.find":2,"array.prototype.findindex":3}],6:[function(e,t,r){"use strict";t.exports=function(e,t){this.deletePending=!1,this.transactions=[],this.rawObjectStores={},this.connections=[],this.name=e,this.version=t,this.processTransactions=function(){setImmediate(function(){var e=this.transactions.some(function(e){return e._started&&!e._finished});if(!e){var t=this.transactions.find(function(e){return!e._started&&!e._finished});t&&(t._start(),t.addEventListener("complete",this.processTransactions.bind(this)),t.addEventListener("abort",this.processTransactions.bind(this)))}}.bind(this))}}},{}],7:[function(e,t,r){"use strict";t.exports=function(e,t){this._eventPath=[],this._stopPropagation=!1,this._stopImmediatePropagation=!1,this._canceled=!1,this._initialized=!0,this._dispatch=!1,this.type=e,this.target=null,this.currentTarget=null,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.eventPhase=this.NONE,this.stopPropagation=function(){this._stopPropagation=!0}.bind(this),this.stopImmediatePropagation=function(){this._stopPropagation=!0,this._stopImmediatePropagation=!0}.bind(this),t=void 0!==t?t:{},this.bubbles=void 0!==t.bubbles?t.bubbles:!1,this.cancelable=void 0!==t.cancelable?t.cancelable:!1,this.preventDefault=function(){this.cancelable&&(this._canceled=!0)}.bind(this),this.defaultPrevented=!1,this.isTrusted=!1,this.timestamp=Date.now()}},{}],8:[function(e,t,r){"use strict";function o(e,t){return e._stopImmediatePropagation||e.eventPhase===e.CAPTURING_PHASE&&t.capture===!1||e.eventPhase===e.BUBBLING_PHASE&&t.capture===!0}function n(e,t){if(e.currentTarget=t,t._listeners.forEach(function(t){e.type!==t.type||o(e,t)||t.callback.call(e.currentTarget,e)}),e.currentTarget["on"+e.type]){var r={type:e.type,callback:e.currentTarget["on"+e.type],capture:!1};if(o(e,r))return;r.callback.call(e.currentTarget,e)}}var i=e("./errors/InvalidStateError");t.exports=function(){this._listeners=[],this.addEventListener=function(e,t,r){null!==t&&(r=void 0!==r?r:!1,this._listeners.push({type:e,callback:t,capture:r}))},this.removeEventListener=function(e,t,r){r=void 0!==r?r:!1;var o=this._listeners.findIndex(function(o){return o.type===e&&o.callback===t&&o.capture===r});this._listeners.splice(o,1)},this.dispatchEvent=function(e){if(e._dispatch||!e._initialized)throw new i("The object is in an invalid state.");return e._isTrusted=!1,e._dispatch=!0,e.target=this,e.eventPhase=e.CAPTURING_PHASE,e._eventPath.forEach(function(t){e._stopPropagation||n(e,t)}),e.eventPhase=e.AT_TARGET,e._stopPropagation||n(e,e.target),e.bubbles&&(e._eventPath.reverse(),e.eventPhase=e.BUBBLING_PHASE,e._eventPath.forEach(function(t){e._stopPropagation||n(e,t)})),e._dispatch=!1,e.eventPhase=e.NONE,e.currentTarget=null,e._canceled?!1:!0}}},{"./errors/InvalidStateError":29}],9:[function(e,t,r){"use strict";function o(e){return e.source.hasOwnProperty("_rawIndex")?e.source.objectStore:e.source}var n=e("./structuredClone"),i=e("./FDBKeyRange"),a=e("./errors/DataError"),s=e("./errors/InvalidStateError"),u=e("./errors/ReadOnlyError"),c=e("./errors/TransactionInactiveError"),l=e("./cmp"),p=e("./extractKey"),d=e("./validateKey");t.exports=function(e,t,r,f){this._gotValue=!1,this._range=t,this._position=void 0,this._objectStorePosition=void 0,this._request=f;var h={source:e,direction:void 0!==r?r:"next",key:void 0,primaryKey:void 0};Object.defineProperty(this,"source",{get:function(){return h.source}}),Object.defineProperty(this,"direction",{get:function(){return h.direction}}),Object.defineProperty(this,"key",{get:function(){return h.key}}),Object.defineProperty(this,"primaryKey",{get:function(){return h.primaryKey}}),this._iterate=function(e){var t,r=!this.source.hasOwnProperty("_rawIndex");t=r?this.source._rawObjectStore.records:this.source._rawIndex.records;var o;if("next"===this.direction)o=t.find(function(t){if(void 0!==e&&-1===l(t.key,e))return!1;if(void 0!==this._position&&r&&1!==l(t.key,this._position))return!1;if(void 0!==this._position&&!r){var o=l(t.key,this._position);if(-1===o)return!1;if(0===o&&1!==l(t.value,this._objectStorePosition))return!1}return void 0===this._range||i.check(this._range,t.key)?!0:!1}.bind(this));else if("nextunique"===this.direction)o=t.find(function(t){return void 0!==e&&-1===l(t.key,e)?!1:void 0!==this._position&&1!==l(t.key,this._position)?!1:void 0===this._range||i.check(this._range,t.key)?!0:!1}.bind(this));else if("prev"===this.direction)o=t.reverse().find(function(t){if(void 0!==e&&1===l(t.key,e))return!1;if(void 0!==this._position&&r&&-1!==l(t.key,this._position))return!1;if(void 0!==this._position&&!r){var o=l(t.key,this._position);if(1===o)return!1;if(0===o&&-1!==l(t.value,this._objectStorePosition))return!1}return void 0===this._range||i.check(this._range,t.key)?!0:!1}.bind(this)),t.reverse();else if("prevunique"===this.direction){var a=t.reverse().find(function(t){return void 0!==e&&1===l(t.key,e)?!1:void 0!==this._position&&-1!==l(t.key,this._position)?!1:void 0===this._range||i.check(this._range,t.key)?!0:!1}.bind(this));t.reverse(),a&&(o=t.find(function(e){return 0===l(e.key,a.key)}))}var s;return o?(this._position=o.key,r||(this._objectStorePosition=o.value),h.key=o.key,r?this.value=n(o.value):(this.value=n(this.source.objectStore._rawObjectStore.getValue(o.value)),h.primaryKey=n(o.value)),this._gotValue=!0,s=this):(h.key=void 0,r||(this._objectStorePosition=void 0),this.value=void 0,s=null),s},this.update=function(e){if(void 0===e)throw new TypeError;var t=o(this),r=this.source.hasOwnProperty("_rawIndex")?this.primaryKey:this._position,i=t.transaction;if("readonly"===i.mode)throw new u;if(!i._active)throw new c;if(t._rawObjectStore.deleted)throw new s;if(!this._gotValue||!this.hasOwnProperty("value"))throw new s;if(null!==t.keyPath){var l;try{l=p(t.keyPath,e)}catch(d){}if(l!==r)throw new a}var f={key:r,value:n(e)};return i._execRequestAsync({source:this,operation:t._rawObjectStore.storeRecord.bind(t._rawObjectStore,f,!1,i._rollbackLog)})},this.advance=function(e){if(!Number.isInteger(e)||0>=e)throw new TypeError;var t=o(this),r=t.transaction;if(!r._active)throw new c;if(t._rawObjectStore.deleted)throw new s;if(!this._gotValue)throw new s;this._request.readyState="pending",r._execRequestAsync({source:this.source,operation:function(){for(var t,r=0;e>r&&(t=this._iterate(),t);r++);return t}.bind(this),request:this._request}),this._gotValue=!1},this["continue"]=function(e){var t=o(this),r=t.transaction;if(!r._active)throw new c;if(t._rawObjectStore.deleted)throw new s;if(!this._gotValue)throw new s;if(void 0!==e){d(e);var n=l(e,this._position);if(0>=n&&("next"===this.direction||"nextunique"===this.direction)||n>=0&&("prev"===this.direction||"prevunique"===this.direction))throw new a}this._request.readyState="pending",r._execRequestAsync({source:this.source,operation:this._iterate.bind(this,e),request:this._request}),this._gotValue=!1},this["delete"]=function(){var e=o(this),t=this.source.hasOwnProperty("_rawIndex")?this.primaryKey:this._position,r=e.transaction;if("readonly"===r.mode)throw new u;if(!r._active)throw new c;if(e._rawObjectStore.deleted)throw new s;if(!this._gotValue||!this.hasOwnProperty("value"))throw new s;return r._execRequestAsync({source:this,operation:e._rawObjectStore.deleteRecord.bind(e._rawObjectStore,t,r._rollbackLog)})},this.toString=function(){return"[object IDBCursor]"}}},{"./FDBKeyRange":14,"./cmp":23,"./errors/DataError":27,"./errors/InvalidStateError":29,"./errors/ReadOnlyError":31,"./errors/TransactionInactiveError":32,"./extractKey":34,"./structuredClone":35,"./validateKey":36}],10:[function(e,t,r){"use strict";function o(){i.apply(this,arguments),this.value=void 0,this.toString=function(){return"[object IDBCursorWithValue]"}}var n=e("util"),i=e("./FDBCursor");n.inherits(o,i),t.exports=o},{"./FDBCursor":9,util:49}],11:[function(e,t,r){"use strict";function o(e){if(!e._runningVersionchangeTransaction)throw new d;var t=e._rawDatabase.transactions.find(function(e){return e._active&&"versionchange"===e.mode});if(!t)throw new h;return t}function n(e){e._closePending=!0;var t=e._rawDatabase.transactions.every(function(e){return e._finished});t?(e._closed=!0,e._rawDatabase.connections=e._rawDatabase.connections.filter(function(t){return e!==t})):setImmediate(function(){n(e)})}function i(e){s.call(this),this._closePending=!1,this._closed=!1,this._runningVersionchangeTransaction=!1,this._rawDatabase=e,this._rawDatabase.connections.push(this),this.name=e.name,this.version=e.version,this.objectStoreNames=Object.keys(e.rawObjectStores).sort(),this.createObjectStore=function(e,t){if(void 0===e)throw new TypeError;var r=o(this);if(this._rawDatabase.rawObjectStores.hasOwnProperty(e))throw new l;t=t||{};var n=void 0!==t.keyPath?t.keyPath:null,i=void 0!==t.autoIncrement?t.autoIncrement:!1;if(null!==n&&y(n),i&&(""===n||Array.isArray(n)))throw new p;r._rollbackLog.push(function(t){this.objectStoreNames=t,delete this._rawDatabase.rawObjectStores[e]}.bind(this,this.objectStoreNames.slice()));var a=new c(this._rawDatabase,e,n,i);return this.objectStoreNames.push(e),this.objectStoreNames.sort(),this._rawDatabase.rawObjectStores[e]=a,r.objectStore(e)},this.deleteObjectStore=function(e){if(void 0===e)throw new TypeError;var t=o(this);if(!this._rawDatabase.rawObjectStores.hasOwnProperty(e))throw new f;this.objectStoreNames=this.objectStoreNames.filter(function(t){return t!==e}),t._rollbackLog.push(function(t){t.deleted=!1,this._rawDatabase.rawObjectStores[e]=t,this.objectStoreNames.push(e),this.objectStoreNames.sort()}.bind(this,this._rawDatabase.rawObjectStores[e])),this._rawDatabase.rawObjectStores[e].deleted=!0,delete this._rawDatabase.rawObjectStores[e]},this.transaction=function(e,t){if(t=void 0!==t?t:"readonly","readonly"!==t&&"readwrite"!==t&&"versionchange"!==t)throw new TypeError("Invalid mode: "+t);var r=this._rawDatabase.transactions.some(function(e){return e._active&&"versionchange"===e.mode});if(r)throw new d;if(this._closePending)throw new d;if(Array.isArray(e)||(e=[e]),0===e.length&&"versionchange"!==t)throw new p;e.forEach(function(e){if(this.objectStoreNames.indexOf(e)<0)throw new f("No objectStore named "+e+" in this database")}.bind(this));var o=new u(e,t);return o.db=this,this._rawDatabase.transactions.push(o),this._rawDatabase.processTransactions(),o},this.close=function(){n(this)},this.toString=function(){return"[object IDBDatabase]"}}var a=e("util"),s=e("./EventTarget"),u=e("./FDBTransaction"),c=e("./ObjectStore"),l=e("./errors/ConstraintError"),p=e("./errors/InvalidAccessError"),d=e("./errors/InvalidStateError"),f=e("./errors/NotFoundError"),h=e("./errors/TransactionInactiveError"),y=e("./validateKeyPath");a.inherits(i,s),t.exports=i},{"./EventTarget":8,"./FDBTransaction":18,"./ObjectStore":22,"./errors/ConstraintError":25,"./errors/InvalidAccessError":28,"./errors/InvalidStateError":29,"./errors/NotFoundError":30,"./errors/TransactionInactiveError":32,"./validateKeyPath":37,util:49}],12:[function(e,t,r){"use strict";function o(e,t,r,o){try{var n;if(!e.hasOwnProperty(t))return void o();n=e[t],n.deletePending=!0;var i=n.connections.filter(function(e){return!e._closed});i.forEach(function(e){if(!e._closePending){var t=new l("versionchange",{oldVersion:n.version,newVersion:null});e.dispatchEvent(t)}});var a=i.some(function(e){return!e._closed});if(r&&a){var s=new l("blocked",{oldVersion:n.version,newVersion:null});r.dispatchEvent(s)}}catch(u){o(u)}var c=function(){var r=i.some(function(e){return!e._closed});return r?void setImmediate(c):(delete e[t],void o())};c()}function n(e,t,r,o){e._runningVersionchangeTransaction=!0;var n=e.version,i=e._rawDatabase.connections.filter(function(t){return e!==t});i.forEach(function(e){if(!e._closed){var r=new l("versionchange",{oldVersion:n,newVersion:t});e.dispatchEvent(r)}});var a=i.some(function(e){return!e._closed});if(a){var s=new l("blocked",{oldVersion:n,newVersion:t});r.dispatchEvent(s)}var u=function(){var a=i.some(function(e){return!e._closed});if(a)return void setImmediate(u);e._rawDatabase.version=t,e.version=t;var s=e.transaction(e.objectStoreNames,"versionchange");r.result=e,r.transaction=s,s._rollbackLog.push(function(){e._rawDatabase.version=n,e.version=n});var c=new l("upgradeneeded",{oldVersion:n,newVersion:t});r.dispatchEvent(c),r.readyState="done",s.addEventListener("error",function(){e._runningVersionchangeTransaction=!1}),s.addEventListener("abort",function(){e._runningVersionchangeTransaction=!1,r.transaction=null,setImmediate(function(){o(new p)})}),s.addEventListener("complete",function(){e._runningVersionchangeTransaction=!1,r.transaction=null,setImmediate(function(){o(e._closePending?new p:null)})})};u()}function i(e,t,r,o,i){var a;if(e.hasOwnProperty(t)?a=e[t]:(a=new s(t,0),e[t]=a),void 0===r&&(r=0!==a.version?a.version:1),a.version>r)return i(new d);var u=new c(e[t]);a.version<r?n(u,r,o,function(e){return e?i(e):void i(null,u)}):i(null,u)}var a=e("./Event"),s=e("./Database"),u=e("./FDBOpenDBRequest"),c=e("./FDBDatabase"),l=e("./FDBVersionChangeEvent"),p=e("./errors/AbortError"),d=e("./errors/VersionError"),f=e("./cmp");t.exports=function(){this._databases={},this.cmp=f,this.deleteDatabase=function(e){var t=new u;return t.source=null,setImmediate(function(){var r=this._databases.hasOwnProperty(e)?this._databases[e].version:null;o(this._databases,e,t,function(e){var o;return e?(t.error=new Error,t.error.name=e.name,o=new a("error",{bubbles:!0,cancelable:!1}),o._eventPath=[],void t.dispatchEvent(o)):(t.result=void 0,o=new l("success",{oldVersion:r,newVersion:null}),void t.dispatchEvent(o))})}.bind(this)),t},this.open=function(e,t){if(arguments.length>1&&(isNaN(t)||1>t||t>=9007199254740992))throw new TypeError;var r=new u;return r.source=null,setImmediate(function(){i(this._databases,e,t,r,function(e,t){var o;return e?(r.result=void 0,r.error=new Error,r.error.name=e.name,o=new a("error",{bubbles:!0,cancelable:!1}),o._eventPath=[],void r.dispatchEvent(o)):(r.result=t,o=new a("success"),o._eventPath=[],void r.dispatchEvent(o))})}.bind(this)),r},this.toString=function(){return"[object IDBFactory]"}}},{"./Database":6,"./Event":7,"./FDBDatabase":11,"./FDBOpenDBRequest":16,"./FDBVersionChangeEvent":19,"./cmp":23,"./errors/AbortError":24,"./errors/VersionError":33}],13:[function(e,t,r){"use strict";function o(e){if(!e.objectStore.transaction._active)throw new l;if(e._rawIndex.deleted||e.objectStore._rawObjectStore.deleted)throw new c}var n=e("./structuredClone"),i=e("./FDBCursor"),a=e("./FDBCursorWithValue"),s=e("./FDBKeyRange"),u=e("./FDBRequest"),c=e("./errors/InvalidStateError"),l=e("./errors/TransactionInactiveError"),p=e("./cmp"),d=e("./validateKey");t.exports=function(e,t){this._rawIndex=t,this.name=t.name,this.objectStore=e,this.keyPath=t.keyPath,this.multiEntry=t.multiEntry,this.unique=t.unique,this.openCursor=function(e,t){o(this),null===e&&(e=void 0),void 0===e||e instanceof s||(e=s.only(n(d(e))));var r=new u;r.source=this,r.transaction=this.objectStore.transaction;var i=new a(this,e,t);return i._request=r,this.objectStore.transaction._execRequestAsync({source:this,operation:i._iterate.bind(i),request:r})},this.openKeyCursor=function(e,t){o(this),null===e&&(e=void 0),void 0===e||e instanceof s||(e=s.only(n(d(e))));var r=new u;r.source=this,r.transaction=this.objectStore.transaction;var a=new i(this,e,t);return a._request=r,this.objectStore.transaction._execRequestAsync({source:this,operation:a._iterate.bind(a),request:r})},this.get=function(e){return o(this),e instanceof s||(e=n(d(e))),this.objectStore.transaction._execRequestAsync({source:this,operation:this._rawIndex.getValue.bind(this._rawIndex,e)})},this.getKey=function(e){return o(this),e instanceof s||(e=n(d(e))),this.objectStore.transaction._execRequestAsync({source:this,operation:this._rawIndex.getKey.bind(this._rawIndex,e)})},this.count=function(e){return o(this),void 0===e||e instanceof s||(e=n(d(e))),this.objectStore.transaction._execRequestAsync({source:this,operation:function(){var t;return e instanceof s?(t=0,this._rawIndex.records.forEach(function(r){s.check(e,r.key)&&(t+=1)})):void 0!==e?(t=0,this._rawIndex.records.forEach(function(r){0===p(r.key,e)&&(t+=1)})):t=this._rawIndex.records.length,t}.bind(this)})},this.toString=function(){return"[object IDBIndex]"}}},{"./FDBCursor":9,"./FDBCursorWithValue":10,"./FDBKeyRange":14,"./FDBRequest":17,"./cmp":23,"./errors/InvalidStateError":29,"./errors/TransactionInactiveError":32,"./structuredClone":35,"./validateKey":36}],14:[function(e,t,r){"use strict";function o(){this.lower=void 0,this.upper=void 0,this.lowerOpen=void 0,this.upperOpen=void 0,this.toString=function(){return"[object IDBKeyRange]"}}var n=e("./errors/DataError"),i=e("./cmp"),a=e("./validateKey");o.only=function(e){if(void 0===e)throw new TypeError;a(e);var t=new o;return t.lower=e,t.upper=e,t.lowerOpen=!1,t.upperOpen=!1,t},o.lowerBound=function(e,t){if(void 0===e)throw new TypeError;a(e);var r=new o;return r.lower=e,r.lowerOpen=t===!0?!0:!1,r.upperOpen=!0,r},o.upperBound=function(e,t){if(void 0===e)throw new TypeError;a(e);var r=new o;return r.upper=e,r.lowerOpen=!0,r.upperOpen=t===!0?!0:!1,r},o.bound=function(e,t,r,s){if(void 0===e||void 0===t)throw new TypeError;var u=i(e,t);if(1===u||0===u&&(r||s))throw new n;a(e),a(t);var c=new o;return c.lower=e,c.upper=t,c.lowerOpen=r===!0?!0:!1,c.upperOpen=s===!0?!0:!1,c},o.check=function(e,t){var r;return void 0!==e.lower&&(r=i(e.lower,t),1===r||0===r&&e.lowerOpen)?!1:void 0!==e.upper&&(r=i(e.upper,t),-1===r||0===r&&e.upperOpen)?!1:!0},t.exports=o},{"./cmp":23,"./errors/DataError":27,"./validateKey":36}],15:[function(e,t,r){"use strict";function o(e){if(e._rawObjectStore.deleted)throw new h;if(!e.transaction._active)throw new b}function n(e,t){if("readonly"===this.transaction.mode)throw new g;if(o(this),null!==this.keyPath){if(void 0!==t)throw new d;var r=v(this.keyPath,e);if(void 0!==r)w(r);else if(!this._rawObjectStore.keyGenerator)throw new d}if(null===this.keyPath&&null===this._rawObjectStore.keyGenerator&&void 0===t)throw new d;return void 0!==t&&w(t),{key:i(t),value:i(e)}}var i=e("./structuredClone"),a=e("./Index"),s=e("./FDBCursorWithValue"),u=e("./FDBIndex"),c=e("./FDBKeyRange"),l=e("./FDBRequest"),p=e("./errors/ConstraintError"),d=e("./errors/DataError"),f=e("./errors/InvalidAccessError"),h=e("./errors/InvalidStateError"),y=e("./errors/NotFoundError"),g=e("./errors/ReadOnlyError"),b=e("./errors/TransactionInactiveError"),m=e("./cmp"),v=e("./extractKey"),w=e("./validateKey"),A=e("./validateKeyPath");t.exports=function(e,t){this._rawObjectStore=t,this._rawIndexesCache={},this.name=t.name,this.keyPath=t.keyPath,this.indexNames=Object.keys(t.rawIndexes).sort(),this.autoIncrement=t.autoIncrement,this.transaction=e,this.put=function(e,t){var r=n.call(this,e,t);return this.transaction._execRequestAsync({source:this,operation:this._rawObjectStore.storeRecord.bind(this._rawObjectStore,r,!1,this.transaction._rollbackLog)})},this.add=function(e,t){var r=n.call(this,e,t);return this.transaction._execRequestAsync({source:this,operation:this._rawObjectStore.storeRecord.bind(this._rawObjectStore,r,!0,this.transaction._rollbackLog)})},this["delete"]=function(e){if("readonly"===this.transaction.mode)throw new g;return o(this),e instanceof c||(e=i(w(e))),this.transaction._execRequestAsync({source:this,operation:this._rawObjectStore.deleteRecord.bind(this._rawObjectStore,e,this.transaction._rollbackLog)})},this.get=function(e){return o(this),e instanceof c||(e=i(w(e))),this.transaction._execRequestAsync({source:this,operation:this._rawObjectStore.getValue.bind(this._rawObjectStore,e)})},this.clear=function(){if("readonly"===this.transaction.mode)throw new g;return o(this),this.transaction._execRequestAsync({source:this,operation:this._rawObjectStore.clear.bind(this._rawObjectStore,this.transaction._rollbackLog)})},this.openCursor=function(e,t){o(this),null===e&&(e=void 0),void 0===e||e instanceof c||(e=c.only(i(w(e))));var r=new l;r.source=this,r.transaction=this.transaction;var n=new s(this,e,t);return n._request=r,this.transaction._execRequestAsync({source:this,operation:n._iterate.bind(n),request:r})},this.createIndex=function(e,t,r){if(void 0===t)throw new TypeError;r=void 0!==r?r:{};var n=void 0!==r.multiEntry?r.multiEntry:!1,i=void 0!==r.unique?r.unique:!1;if("versionchange"!==this.transaction.mode)throw new h;if(o(this),this.indexNames.indexOf(e)>=0)throw new p;if(A(t),Array.isArray(t)&&n)throw new f;this.transaction._rollbackLog.push(function(t){this.indexNames=t,delete this._rawObjectStore.rawIndexes[e]}.bind(this,this.indexNames.slice()));var s=new a(this._rawObjectStore,e,t,n,i);return this.indexNames.push(e),this.indexNames.sort(),this._rawObjectStore.rawIndexes[e]=s,s.initialize(this.transaction),new u(this,s)},this.index=function(e){if(void 0===e)throw new TypeError;if(this._rawIndexesCache.hasOwnProperty(e))return this._rawIndexesCache[e];if(this.indexNames.indexOf(e)<0)throw new y;if(this._rawObjectStore.deleted)throw new h;var t=new u(this,this._rawObjectStore.rawIndexes[e]);return this._rawIndexesCache[e]=t,t},this.deleteIndex=function(e){if(void 0===e)throw new TypeError;if("versionchange"!==this.transaction.mode)throw new h;if(o(this),!this._rawObjectStore.rawIndexes.hasOwnProperty(e))throw new y;this.transaction._rollbackLog.push(function(t){t.deleted=!1,this._rawObjectStore.rawIndexes[e]=t,this.indexNames.push(e),this.indexNames.sort()}.bind(this,this._rawObjectStore.rawIndexes[e])),this.indexNames=this.indexNames.filter(function(t){return t!==e}),this._rawObjectStore.rawIndexes[e].deleted=!0,this.transaction._execRequestAsync({source:this,operation:function(){delete this._rawObjectStore.rawIndexes[e]}.bind(this)})},this.count=function(e){return o(this),void 0===e||e instanceof c||(e=i(w(e))),this.transaction._execRequestAsync({source:this,operation:function(){var t;return e instanceof c?(t=0,this._rawObjectStore.records.forEach(function(r){c.check(e,r.key)&&(t+=1)})):void 0!==e?(t=0,this._rawObjectStore.records.forEach(function(r){0===m(r.key,e)&&(t+=1)})):t=this._rawObjectStore.records.length,t}.bind(this)})},this.toString=function(){return"[object IDBObjectStore]"}}},{"./FDBCursorWithValue":10,"./FDBIndex":13,"./FDBKeyRange":14,"./FDBRequest":17,"./Index":20,"./cmp":23,"./errors/ConstraintError":25,"./errors/DataError":27,"./errors/InvalidAccessError":28,"./errors/InvalidStateError":29,"./errors/NotFoundError":30,"./errors/ReadOnlyError":31,"./errors/TransactionInactiveError":32,"./extractKey":34,"./structuredClone":35,"./validateKey":36,"./validateKeyPath":37}],16:[function(e,t,r){"use strict";function o(){i.call(this),this.onupgradeneeded=null,this.onblocked=null,this.toString=function(){return"[object IDBOpenDBRequest]"}}var n=e("util"),i=e("./FDBRequest");n.inherits(o,i),t.exports=o},{"./FDBRequest":17,util:49}],17:[function(e,t,r){"use strict";function o(){i.call(this),this.result=null,this.error=null,this.source=null,this.transaction=null,this.readyState="pending",this.onsuccess=null,this.onerror=null,this.toString=function(){return"[object IDBRequest]"}}var n=e("util"),i=e("./EventTarget");n.inherits(o,i),t.exports=o},{"./EventTarget":8,util:49}],18:[function(e,t,r){"use strict";function o(e,t){a.call(this),this._scope=e,this._started=!1,this._active=!0,this._finished=!1,this._requests=[],this._rollbackLog=[],this.mode=t,this.db=null,this.error=null,this.onabort=null,this.oncomplete=null,this.onerror=null,this._abort=function(e){this._rollbackLog.reverse().forEach(function(e){e()});var t;null!==e&&(t=new Error,t.name=e,this.error=t),this._requests.forEach(function(e){var t=e.request;if("done"!==t.readyState&&(t.readyState="done",t.source)){t.result=void 0,t.error=new c;var r=new i("error",{bubbles:!0,cancelable:!0});r._eventPath=[this.db,this],t.dispatchEvent(r)}}.bind(this)),setImmediate(function(){var e=new i("abort",{bubbles:!0,cancelable:!1});e._eventPath=[this.db],this.dispatchEvent(e)}.bind(this)),this._finished=!0},this.abort=function(){if(this._finished)throw new d;this._active=!1,this._abort(null)},this.objectStore=function(e){if(this._scope.indexOf(e)<0)throw new p;if(!this._active)throw new d;return new s(this,this.db._rawDatabase.rawObjectStores[e])},this._execRequestAsync=function(e){
var t=e.source,r=e.operation,o=e.hasOwnProperty("request")?e.request:null;if(!this._active)throw new l;return o||(t?(o=new u,o.source=t,o.transaction=t.transaction):o={readyState:"pending"}),this._requests.push({request:o,operation:r}),o},this._start=function(){var e;if(this._started=!0,this._requests.length>0){var t=this._requests.shift(),r=t.request,o=t.operation;if("done"===r.readyState)return void setImmediate(this._start.bind(this));if(r.source){var n;try{var a=o();r.readyState="done",r.result=a,r.error=void 0,this._active=!0,e=new i("success",{bubbles:!1,cancelable:!1})}catch(s){r.readyState="done",r.result=void 0,r.error=s,this._active=!0,e=new i("error",{bubbles:!0,cancelable:!0}),n=this._abort.bind(this,s.name)}try{e._eventPath=[this.db,this],r.dispatchEvent(e)}catch(s){throw this._abort("AbortError"),s}e._canceled||n&&n()}else o();return void(this._requests.length>0?this._start():setImmediate(this._start.bind(this)))}this._finished||(this._active=!1,this._finished=!0,this.error||(e=new i,e.type="complete",this.dispatchEvent(e)))},this.toString=function(){return"[object IDBRequest]"}}var n=e("util"),i=e("./Event"),a=e("./EventTarget"),s=e("./FDBObjectStore"),u=e("./FDBRequest"),c=e("./errors/AbortError"),l=e("./errors/TransactionInactiveError"),p=e("./errors/NotFoundError"),d=e("./errors/InvalidStateError");n.inherits(o,a),t.exports=o},{"./Event":7,"./EventTarget":8,"./FDBObjectStore":15,"./FDBRequest":17,"./errors/AbortError":24,"./errors/InvalidStateError":29,"./errors/NotFoundError":30,"./errors/TransactionInactiveError":32,util:49}],19:[function(e,t,r){"use strict";function o(e,t){i.call(this,e),t=void 0!==t?t:{},this.oldVersion=void 0!==t.oldVersion?t.oldVersion:0,this.newVersion=void 0!==t.newVersion?t.newVersion:null,this.toString=function(){return"[object IDBVersionChangeEvent]"}}var n=e("util"),i=e("./Event");n.inherits(o,i),t.exports=o},{"./Event":7,util:49}],20:[function(e,t,r){"use strict";var o=e("./FDBKeyRange"),n=e("./errors/ConstraintError"),i=e("./cmp"),a=e("./extractKey"),s=e("./validateKey");t.exports=function(e,t,r,u,c){this.records=[],this.rawObjectStore=e,this.initialized=!1,this.deleted=!1,this.name=t,this.keyPath=r,this.multiEntry=u,this.unique=c,this._getRecord=function(e){var t;return t=e instanceof o?this.records.find(function(t){return o.check(e,t.key)}):this.records.find(function(t){return 0===i(t.key,e)})},this.getKey=function(e){var t=this._getRecord(e);return void 0!==t?t.value:void 0},this.getValue=function(e){var t=this._getRecord(e);return void 0!==t?this.rawObjectStore.getValue(t.value):void 0},this.storeRecord=function(e){var t=a(this.keyPath,e.value);if(void 0!==t){if(this.multiEntry&&Array.isArray(t)){var r=[];t.forEach(function(e){if(r.indexOf(e)<0)try{s(e),r.push(e)}catch(t){}}),t=r}else try{s(t)}catch(o){return}if(this.multiEntry&&Array.isArray(t))this.unique&&t.forEach(function(e){this.records.forEach(function(t){if(0===i(t.key,e))throw new n})}.bind(this));else if(this.unique){var u=this.records.findIndex(function(e){return 0===i(e.key,t)});if(u>=0)throw new n}var c=function(e){var t=this.records.findIndex(function(t){return i(t.key,e.key)>=0});if(-1===t)t=this.records.length;else for(;t<this.records.length&&0===i(this.records[t].key,e.key)&&-1===i(this.records[t].value,e.value);)t+=1;this.records.splice(t,0,e)}.bind(this);this.multiEntry&&Array.isArray(t)?t.forEach(function(t){c({key:t,value:e.key})}):c({key:t,value:e.key})}},this.initialize=function(e){if(this.initialized)throw new Error("Index already initialized");e._execRequestAsync({source:null,operation:function(){try{this.rawObjectStore.records.forEach(function(e){this.storeRecord(e)}.bind(this)),this.initialized=!0}catch(t){e._abort(t.name)}}.bind(this)})}}},{"./FDBKeyRange":14,"./cmp":23,"./errors/ConstraintError":25,"./extractKey":34,"./validateKey":36}],21:[function(e,t,r){"use strict";var o=e("./errors/ConstraintError");t.exports=function(){this.num=0,this.next=function(){if(this.num>=9007199254740992)throw new o;return this.num+=1,this.num},this.setIfLarger=function(e){if(e>9007199254740992)throw new o;e>this.num&&(this.num=Math.floor(e))}}},{"./errors/ConstraintError":25}],22:[function(e,t,r){"use strict";var o=e("./structuredClone"),n=e("../lib/FDBKeyRange"),i=e("./KeyGenerator"),a=e("./errors/ConstraintError"),s=e("./errors/DataError"),u=e("./cmp"),c=e("./extractKey");t.exports=function(e,t,r,l){this.rawDatabase=e,this.records=[],this.rawIndexes={},this.keyGenerator=l===!0?new i:null,this.deleted=!1,this.name=t,this.keyPath=r,this.autoIncrement=l,this.getValue=function(e){var t;return t=e instanceof n?this.records.find(function(t){return n.check(e,t.key)}):this.records.find(function(t){return 0===u(t.key,e)}),void 0!==t?o(t.value):void 0},this.storeRecord=function(e,t,r){if(null!==this.keyPath){var o=c(this.keyPath,e.value);void 0!==o&&(e.key=o)}var n;if(null!==this.keyGenerator&&void 0===e.key){if(r&&r.push(function(e){this.keyGenerator.num=e}.bind(this,this.keyGenerator.num)),e.key=this.keyGenerator.next(),null!==this.keyPath){var i,l=this.keyPath,p=e.value;for(n=0;n>=0;){if("object"!=typeof p)throw new s;n=l.indexOf("."),n>=0&&(i=l.slice(0,n),l=l.slice(n+1),p.hasOwnProperty(i)||(p[i]={}),p=p[i])}i=l,p[i]=e.key}}else null!==this.keyGenerator&&"number"==typeof e.key&&this.keyGenerator.setIfLarger(e.key);if(n=this.records.findIndex(function(t){return 0===u(t.key,e.key)}),n>=0){if(t)throw new a;this.deleteRecord(e.key,r)}return 0===this.records.length&&(n=0),n=this.records.findIndex(function(t){return 1===u(t.key,e.key)}),-1===n&&(n=this.records.length),this.records.splice(n,0,e),Object.keys(this.rawIndexes).forEach(function(t){this.rawIndexes[t].initialized&&this.rawIndexes[t].storeRecord(e)}.bind(this)),r&&r.push(this.deleteRecord.bind(this,e.key)),e.key},this.deleteRecord=function(e,t){var r;r=e instanceof n?e:n.only(e),this.records=this.records.filter(function(e){var o=n.check(r,e.key);return o&&t&&t.push(this.storeRecord.bind(this,e,!0)),!o}.bind(this)),Object.keys(this.rawIndexes).forEach(function(e){var t=this.rawIndexes[e];t.records=t.records.filter(function(e){return!n.check(r,e.value)})}.bind(this))},this.clear=function(e){e&&this.records.forEach(function(t){e.push(this.storeRecord.bind(this,t,!0))}.bind(this)),this.records=[],Object.keys(this.rawIndexes).forEach(function(e){var t=this.rawIndexes[e];t.records=[]}.bind(this))}}},{"../lib/FDBKeyRange":14,"./KeyGenerator":21,"./cmp":23,"./errors/ConstraintError":25,"./errors/DataError":27,"./extractKey":34,"./structuredClone":35}],23:[function(e,t,r){"use strict";function o(e){if("number"==typeof e)return"Number";if(e instanceof Date)return"Date";if(Array.isArray(e))return"Array";if("string"==typeof e)return"String";throw new i}function n(e,t){if(void 0===t)throw new TypeError;a(e),a(t);var r=o(e),i=o(t);if(r!==i)return"Array"===r?1:"String"!==r||"Date"!==i&&"Number"!==i?"Date"===r&&"Number"===i?1:-1:1;if("Array"===r){for(var s=Math.min(e.length,t.length),u=0;s>u;u++){var c=n(e[u],t[u]);if(0!==c)return c}return e.length>t.length?1:e.length<t.length?-1:0}if("Date"===r){if(e.getTime()===t.getTime())return 0}else if(e===t)return 0;return e>t?1:-1}var i=e("./errors/DataError"),a=e("./validateKey");t.exports=n},{"./errors/DataError":27,"./validateKey":36}],24:[function(e,t,r){"use strict";function o(e){this.name=this.constructor.name,this.message=void 0!==e?e:" A request was aborted, for example through a call to IDBTransaction.abort.",Error.captureStackTrace&&Error.captureStackTrace(this,o)}var n=e("util");n.inherits(o,Error),t.exports=o},{util:49}],25:[function(e,t,r){"use strict";function o(e){this.name=this.constructor.name,this.message=void 0!==e?e:" A mutation operation in the transaction failed because a constraint was not satisfied. For example, an object such as an object store or index already exists and a request attempted to create a new one.",Error.captureStackTrace&&Error.captureStackTrace(this,o)}var n=e("util");n.inherits(o,Error),t.exports=o},{util:49}],26:[function(e,t,r){"use strict";function o(e){this.name=this.constructor.name,this.message=void 0!==e?e:"The data being stored could not be cloned by the internal structured cloning algorithm.",Error.captureStackTrace&&Error.captureStackTrace(this,o)}var n=e("util");n.inherits(o,Error),t.exports=o},{util:49}],27:[function(e,t,r){"use strict";function o(e){this.name=this.constructor.name,this.message=void 0!==e?e:"Data provided to an operation does not meet requirements.",Error.captureStackTrace&&Error.captureStackTrace(this,o)}var n=e("util");n.inherits(o,Error),t.exports=o},{util:49}],28:[function(e,t,r){"use strict";function o(e){this.name=this.constructor.name,this.message=void 0!==e?e:"An invalid operation was performed on an object. For example transaction creation attempt was made, but an empty scope was provided.",Error.captureStackTrace&&Error.captureStackTrace(this,o)}var n=e("util");n.inherits(o,Error),t.exports=o},{util:49}],29:[function(e,t,r){"use strict";function o(e){this.name=this.constructor.name,this.message=void 0!==e?e:"An operation was called on an object on which it is not allowed or at a time when it is not allowed. Also occurs if a request is made on a source object that has been deleted or removed. Use TransactionInactiveError or ReadOnlyError when possible, as they are more specific variations of InvalidStateError.",Error.captureStackTrace&&Error.captureStackTrace(this,o)}var n=e("util");n.inherits(o,Error),t.exports=o},{util:49}],30:[function(e,t,r){"use strict";function o(e){this.name=this.constructor.name,this.message=void 0!==e?e:"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",Error.captureStackTrace&&Error.captureStackTrace(this,o)}var n=e("util");n.inherits(o,Error),t.exports=o},{util:49}],31:[function(e,t,r){"use strict";function o(e){this.name=this.constructor.name,this.message=void 0!==e?e:'The mutating operation was attempted in a "readonly" transaction.',Error.captureStackTrace&&Error.captureStackTrace(this,o)}var n=e("util");n.inherits(o,Error),t.exports=o},{util:49}],32:[function(e,t,r){"use strict";function o(e){this.name=this.constructor.name,this.message=void 0!==e?e:"A request was placed against a transaction which is currently not active, or which is finished.",Error.captureStackTrace&&Error.captureStackTrace(this,o)}var n=e("util");n.inherits(o,Error),t.exports=o},{util:49}],33:[function(e,t,r){"use strict";function o(e){this.name=this.constructor.name,this.message=void 0!==e?e:"An attempt was made to open a database using a lower version than the existing version.",Error.captureStackTrace&&Error.captureStackTrace(this,o)}var n=e("util");n.inherits(o,Error),t.exports=o},{util:49}],34:[function(e,t,r){"use strict";function o(e,t){if(Array.isArray(e)){var r=[];return e.forEach(function(e){void 0!==e&&null!==e&&"string"!=typeof e&&e.toString&&(e=e.toString()),r.push(n(i(o(e,t))))}),r}if(""===e)return t;for(var a=e,s=t;null!==a;){var u,c=a.indexOf(".");if(c>=0?(u=a.slice(0,c),a=a.slice(c+1)):(u=a,a=null),!s.hasOwnProperty(u))return;s=s[u]}return s}var n=e("./structuredClone"),i=e("./validateKey");t.exports=o},{"./structuredClone":35,"./validateKey":36}],35:[function(e,t,r){"use strict";var o=e("realistic-structured-clone"),n=e("./errors/DataCloneError");t.exports=function(e){try{return o(e)}catch(t){throw new n}}},{"./errors/DataCloneError":26,"realistic-structured-clone":45}],36:[function(e,t,r){"use strict";function o(e,t){if("number"==typeof e){if(isNaN(e))throw new n}else if(e instanceof Date){if(isNaN(e.valueOf()))throw new n}else{if(Array.isArray(e)){t=void 0!==t?t:[],e.forEach(function(e){if("object"==typeof e&&t.indexOf(e)>=0)throw new n;t.push(e)});var r=0;if(e=e.map(function(e){return r+=1,o(e,t)}),r!==e.length)throw new n;return e}if("string"!=typeof e)throw new n}return e}var n=e("./errors/DataError");t.exports=o},{"./errors/DataError":27}],37:[function(e,t,r){"use strict";function o(e,t){if(void 0===e||null===e||"string"==typeof e||!e.toString||"array"!==t&&Array.isArray(e)||(e=e.toString()),"string"==typeof e){if(""===e&&"string"!==t)return;try{var r=/^(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])(?:[\$0-9A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])*$/;if(e.length>=1&&r.test(e))return}catch(n){throw new SyntaxError(n.message)}if(e.indexOf(" ")>=0)throw new SyntaxError("The keypath argument contains an invalid key path (no spaces allowed).")}if(Array.isArray(e)&&e.length>0){if(t)throw new SyntaxError("The keypath argument contains an invalid key path (nested arrays).");return void e.forEach(function(e){o(e,"array")})}if("string"==typeof e&&e.indexOf(".")>=0)return e=e.split("."),void e.forEach(function(e){o(e,"string")});throw new SyntaxError}t.exports=o},{}],38:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],39:[function(e,t,r){function o(e){return function(t,r,o){for(var n=-1,i=Object(t),a=o(t),s=a.length;s--;){var u=a[e?s:++n];if(r(i[u],u,i)===!1)break}return t}}var n=o();t.exports=n},{}],40:[function(e,t,r){function o(e){return function(t){return null==t?void 0:t[e]}}function n(e){return a(e)&&g.call(e,"callee")&&(!m.call(e,"callee")||b.call(e)==d)}function i(e){return null!=e&&u(v(e))&&!s(e)}function a(e){return l(e)&&i(e)}function s(e){var t=c(e)?b.call(e):"";return t==f||t==h}function u(e){return"number"==typeof e&&e>-1&&e%1==0&&p>=e}function c(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function l(e){return!!e&&"object"==typeof e}var p=9007199254740991,d="[object Arguments]",f="[object Function]",h="[object GeneratorFunction]",y=Object.prototype,g=y.hasOwnProperty,b=y.toString,m=y.propertyIsEnumerable,v=o("length");t.exports=n},{}],41:[function(e,t,r){function o(e){return!!e&&"object"==typeof e}function n(e,t){var r=null==e?void 0:e[t];return u(r)?r:void 0}function i(e){return"number"==typeof e&&e>-1&&e%1==0&&m>=e}function a(e){return s(e)&&y.call(e)==l}function s(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function u(e){return null==e?!1:a(e)?g.test(f.call(e)):o(e)&&p.test(e)}var c="[object Array]",l="[object Function]",p=/^\[object .+?Constructor\]$/,d=Object.prototype,f=Function.prototype.toString,h=d.hasOwnProperty,y=d.toString,g=RegExp("^"+f.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),b=n(Array,"isArray"),m=9007199254740991,v=b||function(e){return o(e)&&i(e.length)&&y.call(e)==c};t.exports=v},{}],42:[function(e,t,r){function o(e){return!!e&&"object"==typeof e}function n(e,t){return a(e,t,u)}function i(e){var t;if(!o(e)||d.call(e)!=c||s(e)||!p.call(e,"constructor")&&(t=e.constructor,"function"==typeof t&&!(t instanceof t)))return!1;var r;return n(e,function(e,t){r=t}),void 0===r||p.call(e,r)}var a=e("lodash._basefor"),s=e("lodash.isarguments"),u=e("lodash.keysin"),c="[object Object]",l=Object.prototype,p=l.hasOwnProperty,d=l.toString;t.exports=i},{"lodash._basefor":39,"lodash.isarguments":40,"lodash.keysin":43}],43:[function(e,t,r){function o(e,t){return e="number"==typeof e||c.test(e)?+e:-1,t=null==t?d:t,e>-1&&e%1==0&&t>e}function n(e){return"number"==typeof e&&e>-1&&e%1==0&&d>=e}function i(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function a(e){if(null==e)return[];i(e)||(e=Object(e));var t=e.length;t=t&&n(t)&&(u(e)||s(e))&&t||0;for(var r=e.constructor,a=-1,c="function"==typeof r&&r.prototype===e,l=Array(t),d=t>0;++a<t;)l[a]=a+"";for(var f in e)d&&o(f,t)||"constructor"==f&&(c||!p.call(e,f))||l.push(f);return l}var s=e("lodash.isarguments"),u=e("lodash.isarray"),c=/^\d+$/,l=Object.prototype,p=l.hasOwnProperty,d=9007199254740991;t.exports=a},{"lodash.isarguments":40,"lodash.isarray":41}],44:[function(e,t,r){function o(){l=!1,s.length?c=s.concat(c):p=-1,c.length&&n()}function n(){if(!l){var e=setTimeout(o);l=!0;for(var t=c.length;t;){for(s=c,c=[];++p<t;)s&&s[p].run();p=-1,t=c.length}s=null,l=!1,clearTimeout(e)}}function i(e,t){this.fun=e,this.array=t}function a(){}var s,u=t.exports={},c=[],l=!1,p=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new i(e,t)),1!==c.length||l||setTimeout(n,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=a,u.addListener=a,u.once=a,u.off=a,u.removeListener=a,u.removeAllListeners=a,u.emit=a,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],45:[function(e,t,r){"use strict";function o(e){this.name=this.constructor.name,this.message=e,Error.captureStackTrace&&Error.captureStackTrace(this,o)}function n(e,t){t=void 0!==t?t:[];for(var r=0;r<t.length;r++)if(t[r].source===e)return t[r].destination;var i,s=typeof e;if("string"===s||"number"===s||"boolean"===s||"undefined"===s||null===e)return e;var u="none";if(e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date)i=new e.constructor(e.valueOf());else if(e instanceof RegExp)i=new RegExp(e.source,"g".substr(0,Number(e.global))+"i".substr(0,Number(e.ignoreCase))+"m".substr(0,Number(e.multiline)));else if(Array.isArray(e))i=new Array(e.length),u="own";else if(a(e))i={},u="own";else if(e instanceof Map)i=new Map,u="map";else{if(!(e instanceof Set))throw new o;i=new Set,u="set"}if(t.push({source:e,destination:i}),"map"===u)throw new o("Map support not implemented yet");if("set"===u)throw new o("Set support not implemented yet");if("own"===u)for(var c in e)if(e.hasOwnProperty(c)){var l=e[c],p=n(l,t);i[c]=p}return i}var i=e("util"),a=e("lodash.isplainobject");i.inherits(o,Error),t.exports=n},{"lodash.isplainobject":42,util:49}],46:[function(t,r,o){!function(t){if("object"==typeof o)r.exports=t();else if("function"==typeof e&&e.amd)e(t);else{var n;try{n=window}catch(i){n=self}n.SparkMD5=t()}}(function(e){"use strict";function t(e,t,r,o,n,i){return t=v(v(t,e),v(o,i)),v(t<<n|t>>>32-n,r)}function r(e,r,o,n,i,a,s){return t(r&o|~r&n,e,r,i,a,s)}function o(e,r,o,n,i,a,s){return t(r&n|o&~n,e,r,i,a,s)}function n(e,r,o,n,i,a,s){return t(r^o^n,e,r,i,a,s)}function i(e,r,o,n,i,a,s){return t(o^(r|~n),e,r,i,a,s)}function a(e,t){var a=e[0],s=e[1],u=e[2],c=e[3];a=r(a,s,u,c,t[0],7,-680876936),c=r(c,a,s,u,t[1],12,-389564586),u=r(u,c,a,s,t[2],17,606105819),s=r(s,u,c,a,t[3],22,-1044525330),a=r(a,s,u,c,t[4],7,-176418897),c=r(c,a,s,u,t[5],12,1200080426),u=r(u,c,a,s,t[6],17,-1473231341),s=r(s,u,c,a,t[7],22,-45705983),a=r(a,s,u,c,t[8],7,1770035416),c=r(c,a,s,u,t[9],12,-1958414417),u=r(u,c,a,s,t[10],17,-42063),s=r(s,u,c,a,t[11],22,-1990404162),a=r(a,s,u,c,t[12],7,1804603682),c=r(c,a,s,u,t[13],12,-40341101),u=r(u,c,a,s,t[14],17,-1502002290),s=r(s,u,c,a,t[15],22,1236535329),a=o(a,s,u,c,t[1],5,-165796510),c=o(c,a,s,u,t[6],9,-1069501632),u=o(u,c,a,s,t[11],14,643717713),s=o(s,u,c,a,t[0],20,-373897302),a=o(a,s,u,c,t[5],5,-701558691),c=o(c,a,s,u,t[10],9,38016083),u=o(u,c,a,s,t[15],14,-660478335),s=o(s,u,c,a,t[4],20,-405537848),a=o(a,s,u,c,t[9],5,568446438),c=o(c,a,s,u,t[14],9,-1019803690),u=o(u,c,a,s,t[3],14,-187363961),s=o(s,u,c,a,t[8],20,1163531501),a=o(a,s,u,c,t[13],5,-1444681467),c=o(c,a,s,u,t[2],9,-51403784),u=o(u,c,a,s,t[7],14,1735328473),s=o(s,u,c,a,t[12],20,-1926607734),a=n(a,s,u,c,t[5],4,-378558),c=n(c,a,s,u,t[8],11,-2022574463),u=n(u,c,a,s,t[11],16,1839030562),s=n(s,u,c,a,t[14],23,-35309556),a=n(a,s,u,c,t[1],4,-1530992060),c=n(c,a,s,u,t[4],11,1272893353),u=n(u,c,a,s,t[7],16,-155497632),s=n(s,u,c,a,t[10],23,-1094730640),a=n(a,s,u,c,t[13],4,681279174),c=n(c,a,s,u,t[0],11,-358537222),u=n(u,c,a,s,t[3],16,-722521979),s=n(s,u,c,a,t[6],23,76029189),a=n(a,s,u,c,t[9],4,-640364487),c=n(c,a,s,u,t[12],11,-421815835),u=n(u,c,a,s,t[15],16,530742520),s=n(s,u,c,a,t[2],23,-995338651),a=i(a,s,u,c,t[0],6,-198630844),c=i(c,a,s,u,t[7],10,1126891415),u=i(u,c,a,s,t[14],15,-1416354905),s=i(s,u,c,a,t[5],21,-57434055),a=i(a,s,u,c,t[12],6,1700485571),c=i(c,a,s,u,t[3],10,-1894986606),u=i(u,c,a,s,t[10],15,-1051523),s=i(s,u,c,a,t[1],21,-2054922799),a=i(a,s,u,c,t[8],6,1873313359),c=i(c,a,s,u,t[15],10,-30611744),u=i(u,c,a,s,t[6],15,-1560198380),s=i(s,u,c,a,t[13],21,1309151649),a=i(a,s,u,c,t[4],6,-145523070),c=i(c,a,s,u,t[11],10,-1120210379),u=i(u,c,a,s,t[2],15,718787259),s=i(s,u,c,a,t[9],21,-343485551),e[0]=v(a,e[0]),e[1]=v(s,e[1]),e[2]=v(u,e[2]),e[3]=v(c,e[3])}function s(e){var t,r=[];for(t=0;64>t;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function u(e){var t,r=[];for(t=0;64>t;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function c(e){var t,r,o,n,i,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;c>=t;t+=64)a(l,s(e.substring(t-64,t)));for(e=e.substring(t-64),r=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;r>t;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(a(l,o),t=0;16>t;t+=1)o[t]=0;return n=8*c,n=n.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),u=parseInt(n[1],16)||0,o[14]=i,o[15]=u,a(l,o),l}function l(e){var t,r,o,n,i,s,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;c>=t;t+=64)a(l,u(e.subarray(t-64,t)));for(e=c>t-64?e.subarray(t-64):new Uint8Array(0),r=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;r>t;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(a(l,o),t=0;16>t;t+=1)o[t]=0;return n=8*c,n=n.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),s=parseInt(n[1],16)||0,o[14]=i,o[15]=s,a(l,o),l}function p(e){var t,r="";for(t=0;4>t;t+=1)r+=w[e>>8*t+4&15]+w[e>>8*t&15];return r}function d(e){var t;for(t=0;t<e.length;t+=1)e[t]=p(e[t]);return e.join("")}function f(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function h(e,t){var r,o=e.length,n=new ArrayBuffer(o),i=new Uint8Array(n);for(r=0;o>r;r+=1)i[r]=e.charCodeAt(r);return t?i:n}function y(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function g(e,t,r){var o=new Uint8Array(e.byteLength+t.byteLength);return o.set(new Uint8Array(e)),o.set(new Uint8Array(t),e.byteLength),r?o:o.buffer}function b(e){var t,r=[],o=e.length;for(t=0;o-1>t;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function m(){this.reset()}var v=function(e,t){return e+t&4294967295},w=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==d(c("hello"))&&(v=function(e,t){
var r=(65535&e)+(65535&t),o=(e>>16)+(t>>16)+(r>>16);return o<<16|65535&r}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function t(e,t){return e=0|e||0,0>e?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,o){var n,i,a,s,u=this.byteLength,c=t(r,u),l=u;return o!==e&&(l=t(o,u)),c>l?new ArrayBuffer(0):(n=l-c,i=new ArrayBuffer(n),a=new Uint8Array(i),s=new Uint8Array(this,c,n),a.set(s),i)}}(),m.prototype.append=function(e){return this.appendBinary(f(e)),this},m.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,r=this._buff.length;for(t=64;r>=t;t+=64)a(this._hash,s(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},m.prototype.end=function(e){var t,r,o=this._buff,n=o.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;n>t;t+=1)i[t>>2]|=o.charCodeAt(t)<<(t%4<<3);return this._finish(i,n),r=d(this._hash),e&&(r=b(r)),this.reset(),r},m.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},m.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},m.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},m.prototype._finish=function(e,t){var r,o,n,i=t;if(e[i>>2]|=128<<(i%4<<3),i>55)for(a(this._hash,e),i=0;16>i;i+=1)e[i]=0;r=8*this._length,r=r.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(r[2],16),n=parseInt(r[1],16)||0,e[14]=o,e[15]=n,a(this._hash,e)},m.hash=function(e,t){return m.hashBinary(f(e),t)},m.hashBinary=function(e,t){var r=c(e),o=d(r);return t?b(o):o},m.ArrayBuffer=function(){this.reset()},m.ArrayBuffer.prototype.append=function(e){var t,r=g(this._buff.buffer,e,!0),o=r.length;for(this._length+=e.byteLength,t=64;o>=t;t+=64)a(this._hash,u(r.subarray(t-64,t)));return this._buff=o>t-64?new Uint8Array(r.buffer.slice(t-64)):new Uint8Array(0),this},m.ArrayBuffer.prototype.end=function(e){var t,r,o=this._buff,n=o.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;n>t;t+=1)i[t>>2]|=o[t]<<(t%4<<3);return this._finish(i,n),r=d(this._hash),e&&(r=b(r)),this.reset(),r},m.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.ArrayBuffer.prototype.getState=function(){var e=m.prototype.getState.call(this);return e.buff=y(e.buff),e},m.ArrayBuffer.prototype.setState=function(e){return e.buff=h(e.buff,!0),m.prototype.setState.call(this,e)},m.ArrayBuffer.prototype.destroy=m.prototype.destroy,m.ArrayBuffer.prototype._finish=m.prototype._finish,m.ArrayBuffer.hash=function(e,t){var r=l(new Uint8Array(e)),o=d(r);return t?b(o):o},m})},{}],47:[function(t,r,o){"use strict";!function(t,o){"function"==typeof e&&e.amd?e([],o):"object"==typeof r&&r.exports?r.exports=o():t.striptags=o()}(this,function(){function e(e,s){function u(e){f==r?y+=e:s&&f==o&&(g+=e)}function c(){var e,t,r,o="",n=!1;e:for(e=0,t=g.length;t>e;e++)switch(r=g[e].toLowerCase()){case"<":break;case">":break e;case"/":n=!0;break;default:if(r.match(a)){if(n)break e}else n=!0,o+=r}-1!==s.indexOf(o)&&(y+=g),g=""}var l,p,d,e=e||"",f=r,h=0,y="",g="",b=!1;for("string"==typeof s?s=t(s):Array.isArray(s)||(s=null),l=0,p=e.length;p>l;l++)switch(d=e[l]){case"<":if(b)break;if(" "==e[l+1]){u(d);break}if(f==r){f=o,u(d);break}if(f==o){h++;break}u(d);break;case">":if(h){h--;break}if(b)break;if(f==o){b=f=0,s&&(g+=">",c());break}if(f==n){b=f=0,g="";break}if(f==i&&"-"==e[l-1]&&"-"==e[l-2]){b=f=0,g="";break}u(d);break;case'"':case"'":f==o&&(b==d?b=!1:b||(b=d)),u(d);break;case"!":if(f==o&&"<"==e[l-1]){f=n;break}u(d);break;case"-":if(f==n&&"-"==e[l-1]&&"!"==e[l-2]){f=i;break}u(d);break;case"E":case"e":if(f==n&&"doctype"==e.substr(l-6,7).toLowerCase()){f=o;break}u(d);break;default:u(d)}return y}function t(e){for(var t,r=[];null!==(t=s.exec(e));)r.push(t[1]);return 0!==r.length?r:null}var r=0,o=1,n=2,i=3,a=/\s/,s=/<(\w*)>/g;return e})},{}],48:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],49:[function(e,t,r){(function(t,o){function n(e,t){var o={seen:[],stylize:a};return arguments.length>=3&&(o.depth=arguments[2]),arguments.length>=4&&(o.colors=arguments[3]),y(t)?o.showHidden=t:t&&r._extend(o,t),A(o.showHidden)&&(o.showHidden=!1),A(o.depth)&&(o.depth=2),A(o.colors)&&(o.colors=!1),A(o.customInspect)&&(o.customInspect=!0),o.colors&&(o.stylize=i),u(o,e,o.depth)}function i(e,t){var r=n.styles[t];return r?"["+n.colors[r][0]+"m"+e+"["+n.colors[r][1]+"m":e}function a(e,t){return e}function s(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function u(e,t,o){if(e.customInspect&&t&&Z(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var n=t.inspect(o,e);return v(n)||(n=u(e,n,o)),n}var i=c(e,t);if(i)return i;var a=Object.keys(t),y=s(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),C(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(t);if(0===a.length){if(Z(t)){var g=t.name?": "+t.name:"";return e.stylize("[Function"+g+"]","special")}if(D(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(x(t))return e.stylize(Date.prototype.toString.call(t),"date");if(C(t))return l(t)}var b="",m=!1,w=["{","}"];if(h(t)&&(m=!0,w=["[","]"]),Z(t)){var A=t.name?": "+t.name:"";b=" [Function"+A+"]"}if(D(t)&&(b=" "+RegExp.prototype.toString.call(t)),x(t)&&(b=" "+Date.prototype.toUTCString.call(t)),C(t)&&(b=" "+l(t)),0===a.length&&(!m||0==t.length))return w[0]+b+w[1];if(0>o)return D(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var j;return j=m?p(e,t,o,y,a):a.map(function(r){return d(e,t,o,y,r,m)}),e.seen.pop(),f(j,b,w)}function c(e,t){if(A(t))return e.stylize("undefined","undefined");if(v(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return m(t)?e.stylize(""+t,"number"):y(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,r,o,n){for(var i=[],a=0,s=t.length;s>a;++a)B(t,String(a))?i.push(d(e,t,r,o,String(a),!0)):i.push("");return n.forEach(function(n){n.match(/^\d+$/)||i.push(d(e,t,r,o,n,!0))}),i}function d(e,t,r,o,n,i){var a,s,c;if(c=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]},c.get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special")),B(o,n)||(a="["+n+"]"),s||(e.seen.indexOf(c.value)<0?(s=g(r)?u(e,c.value,null):u(e,c.value,r-1),s.indexOf("\n")>-1&&(s=i?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n"))):s=e.stylize("[Circular]","special")),A(a)){if(i&&n.match(/^\d+$/))return s;a=JSON.stringify(""+n),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function f(e,t,r){var o=0,n=e.reduce(function(e,t){return o++,t.indexOf("\n")>=0&&o++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return n>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function h(e){return Array.isArray(e)}function y(e){return"boolean"==typeof e}function g(e){return null===e}function b(e){return null==e}function m(e){return"number"==typeof e}function v(e){return"string"==typeof e}function w(e){return"symbol"==typeof e}function A(e){return void 0===e}function D(e){return j(e)&&"[object RegExp]"===F(e)}function j(e){return"object"==typeof e&&null!==e}function x(e){return j(e)&&"[object Date]"===F(e)}function C(e){return j(e)&&("[object Error]"===F(e)||e instanceof Error)}function Z(e){return"function"==typeof e}function E(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function F(e){return Object.prototype.toString.call(e)}function O(e){return 10>e?"0"+e.toString(10):e.toString(10)}function S(){var e=new Date,t=[O(e.getHours()),O(e.getMinutes()),O(e.getSeconds())].join(":");return[e.getDate(),_[e.getMonth()],t].join(" ")}function B(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var I=/%[sdj%]/g;r.format=function(e){if(!v(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(n(arguments[r]));return t.join(" ")}for(var r=1,o=arguments,i=o.length,a=String(e).replace(I,function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(o[r++]);case"%d":return Number(o[r++]);case"%j":try{return JSON.stringify(o[r++])}catch(t){return"[Circular]"}default:return e}}),s=o[r];i>r;s=o[++r])a+=g(s)||!j(s)?" "+s:" "+n(s);return a},r.deprecate=function(e,n){function i(){if(!a){if(t.throwDeprecation)throw new Error(n);t.traceDeprecation?console.trace(n):console.error(n),a=!0}return e.apply(this,arguments)}if(A(o.process))return function(){return r.deprecate(e,n).apply(this,arguments)};if(t.noDeprecation===!0)return e;var a=!1;return i};var k,T={};r.debuglog=function(e){if(A(k)&&(k=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!T[e])if(new RegExp("\\b"+e+"\\b","i").test(k)){var o=t.pid;T[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,o,t)}}else T[e]=function(){};return T[e]},r.inspect=n,n.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},n.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=h,r.isBoolean=y,r.isNull=g,r.isNullOrUndefined=b,r.isNumber=m,r.isString=v,r.isSymbol=w,r.isUndefined=A,r.isRegExp=D,r.isObject=j,r.isDate=x,r.isError=C,r.isFunction=Z,r.isPrimitive=E,r.isBuffer=e("./support/isBuffer");var _=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",S(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!j(t))return e;for(var r=Object.keys(t),o=r.length;o--;)e[r[o]]=t[r[o]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":48,_process:44,inherits:38}],50:[function(e,t,r){"use strict";var o={};o.errorCallback=function(e){Z.error(e),Z.debug("ajax error callback",2),Z.debug("textStatus: "+e.textStatus,2),Z.debug("errorThrown: ",2),Z.debug(e.errorThrown,2),Z.debug(e.jqxhr,2)},o.error=o.errorCallback,o.activeRequests=[],o.apiRequestUrl=function(e){if(Z.debug("Zotero.Ajax.apiRequestUrl",4),Z.debug(e,4),Object.keys(e).forEach(function(t){var r=e[t];"string"==typeof r&&(r=r.split("#",1),e[t]=r[0]),Zotero.validator.validate(r,t)===!1&&(Zotero.warn("API argument failed validation: "+t+" cannot be "+r),Zotero.warn(e),delete e[t])}),!e.target)throw new Error("No target defined for api request");if("user"!=e.libraryType&&"group"!=e.libraryType&&""!==e.libraryType)throw new Error("Unexpected libraryType for api request "+JSON.stringify(e));if(e.libraryType&&!e.libraryID)throw new Error("No libraryID defined for api request");if("publications"==e.target&&"user"!=e.libraryType)throw new Error("publications is only valid for user libraries");var t,r=Zotero.config.baseApiUrl;if(""!==e.libraryType){if(t=r+"/"+e.libraryType+"s/"+e.libraryID,e.collectionKey){if("trash"==e.collectionKey)return t+="/items/trash";-1!==e.collectionKey.indexOf(",")||"collections"!=e.target&&(t+="/collections/"+e.collectionKey)}}else t=r;switch(e.target){case"items":t+="/items";break;case"item":t+=e.itemKey?"/items/"+e.itemKey:"/items";break;case"collections":t+="/collections";break;case"childCollections":t+="/collections";break;case"collection":break;case"tags":t+="/tags";break;case"children":t+="/items/"+e.itemKey+"/children";break;case"key":t=r+"/users/"+e.libraryID+"/keys/"+e.apiKey;break;case"deleted":t+="/deleted";break;case"userGroups":t=r+"/users/"+e.libraryID+"/groups";break;case"settings":t+="/settings/"+(e.settingsKey||"");break;case"publications":t+="/publications/items";break;default:return!1}switch(e.targetModifier){case"top":t+="/top";break;case"file":t+="/file";break;case"viewsnapshot":t+="/file/view"}return t},o.apiQueryString=function(e,t){if(Z.debug("Zotero.Ajax.apiQueryString",4),Z.debug(e,4),(null===t||"undefined"==typeof t)&&(t=!0),Object.keys(e).forEach(function(t){var r=e[t];"string"==typeof r&&(r=r.split("#",1),e[t]=r[0])}),e.hasOwnProperty("order")&&"creatorSummary"==e.order&&(e.order="creator"),e.hasOwnProperty("order")&&"year"==e.order&&(e.order="date"),t&&Zotero.config.sessionAuth){var r=Zotero.utils.readCookie(Zotero.config.sessionCookieName);e.session=r}else t&&Zotero.config.apiKey&&(e.key=Zotero.config.apiKey);e.hasOwnProperty("sort")&&"undefined"==e.sort&&(e.sort="asc"),Z.debug(e,4);var o="?",n=[],i=["start","limit","order","sort","content","include","format","q","fq","itemType","itemKey","collectionKey","searchKey","locale","tag","tagType","key","style","linkMode","linkwrap","session","newer","since"];i.sort();var a={};return i.forEach(function(t){e.hasOwnProperty(t)&&""!==e[t]&&(a[t]=e[t])}),e.hasOwnProperty("target")&&"items"!==e.target&&a.hasOwnProperty("itemKey")&&-1==a.itemKey.indexOf(",")&&delete a.itemKey,e.hasOwnProperty("target")&&"collections"!==e.target&&a.hasOwnProperty("collectionKey")&&-1===a.collectionKey.indexOf(",")&&delete a.collectionKey,Object.keys(a).forEach(function(e){var t=a[e];Array.isArray(t)?t.forEach(function(t){"tag"==e&&"-"==t[0]&&(t="\\"+t),n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}):("tag"==e&&"-"==t[0]&&(t="\\"+t),n.push(encodeURIComponent(e)+"="+encodeURIComponent(t)))}),o+=n.join("&")},o.apiRequestString=function(e){return o.apiRequestUrl(e)+o.apiQueryString(e)},o.proxyWrapper=function(e,t){return Zotero.config.proxy?(t||(t="GET"),Zotero.config.proxyPath+"?requestMethod="+t+"&requestUrl="+encodeURIComponent(e)):e},o.parseQueryString=function(e){},o.webUrl=function(e){},o.downloadBlob=function(e){return new Promise(function(t,r){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="blob",o.addEventListener("load",function(){200===o.status?(Z.debug("downloadBlob Image retrieved. resolving",3),t(o.response)):r(o.response)}),o.send()})},t.exports=o},{}],51:[function(e,t,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};t.exports=function(){this.instance="Zotero.ApiObject",this.version=0},t.exports.prototype.associateWithLibrary=function(e){var t=this;return t.owningLibrary=e,"object"==o(this.apiObj.library)&&(this.apiObj.library.type=e.type,this.apiObj.library.id=e.libraryID),t},t.exports.prototype.fieldComparer=function(e){if(Intl){var t=new Intl.Collator;return function(r,o){return t.compare(r.apiObj.data[e],o.apiObj.data[e])}}return function(t,r){return t.apiObj.data[e].toLowerCase()==r.apiObj.data[e].toLowerCase()?0:t.apiObj.data[e].toLowerCase()<r.apiObj.data[e].toLowerCase()?-1:1}}},{}],52:[function(e,t,r){"use strict";t.exports=function(e){Z.debug("Zotero.ApiResponse",3),this.totalResults=0,this.apiVersion=null,this.lastModifiedVersion=0,this.linkHeader="",this.links={},e&&(e.isError?this.isError=!0:this.isError=!1,this.data=e.data,this.parseResponse(e))},t.exports.prototype.parseResponse=function(e){Z.debug("parseResponse");var t=this;if(t.jqxhr=e.jqxhr,t.status=e.jqxhr.status,t.lastModifiedVersion=e.jqxhr.getResponseHeader("Last-Modified-Version"),t.apiVersion=e.jqxhr.getResponseHeader("Zotero-API-Version"),t.backoff=e.jqxhr.getResponseHeader("Backoff"),t.retryAfter=e.jqxhr.getResponseHeader("Retry-After"),t.contentType=e.jqxhr.getResponseHeader("Content-Type"),t.linkHeader=e.jqxhr.getResponseHeader("Link"),t.totalResults=e.jqxhr.getResponseHeader("Total-Results"),t.backoff&&(t.backoff=parseInt(t.backoff,10)),t.retryAfter&&(t.retryAfter=parseInt(t.retryAfter,10)),Z.debug("parse link header"),Z.debug(t.linkHeader),t.linkHeader){for(var r=t.linkHeader.split(","),o={},n=/^<([^>]+)>; rel="([^\"]*)"$/,i=0;i<r.length;i++){var a=n.exec(r[i].trim());a[2]&&(o[a[2]]=a[1])}t.parsedLinks=o}Z.debug("done parsing response")}},{}],53:[function(e,t,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},n={callbacks:{},ui:{callbacks:{},keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}},offline:{},temp:{},config:{librarySettings:{},baseApiUrl:"https://api.zotero.org",baseWebsiteUrl:"https://zotero.org",baseFeedUrl:"https://api.zotero.org",baseZoteroWebsiteUrl:"https://www.zotero.org",baseDownloadUrl:"https://www.zotero.org",nonparsedBaseUrl:"",debugLogEndpoint:"",storeDebug:!0,directDownloads:!0,proxyPath:"/proxyrequest",ignoreLoggedInStatus:!1,storePrefsRemote:!0,preferUrlItem:!0,sessionAuth:!1,proxy:!1,apiKey:"",apiVersion:3,locale:"en-US",cacheStoreType:"localStorage",preloadCachedLibrary:!0,sortOrdering:{dateAdded:"desc",dateModified:"desc",date:"desc",year:"desc",accessDate:"desc",title:"asc",creator:"asc"},defaultSortColumn:"title",defaultSortOrder:"asc",largeFields:{title:1,abstractNote:1,extra:1},richTextFields:{note:1},maxFieldSummaryLength:{title:60},exportFormats:["bibtex","bookmarks","mods","refer","rdf_bibliontology","rdf_dc","rdf_zotero","ris","wikipedia"],exportFormatsMap:{bibtex:"BibTeX",bookmarks:"Bookmarks",mods:"MODS",refer:"Refer/BibIX",rdf_bibliontology:"Bibliontology RDF",rdf_dc:"Unqualified Dublin Core RDF",rdf_zotero:"Zotero RDF",ris:"RIS",wikipedia:"Wikipedia Citation Templates"},defaultApiArgs:{order:"title",sort:"asc",limit:50,start:0}},debug:function(e,t){var r=3;n.config.storeDebug&&r>=t&&(n.debugstring+="DEBUG:"+e+"\n"),"undefined"!=typeof console&&("number"!=typeof t&&(t=1),void 0!==n.preferences&&(r=n.preferences.getPref("debug_level")),r>=t&&console.log(e))},warn:function(e){n.config.storeDebug&&(n.debugstring+="WARN:"+e+"\n"),"undefined"==typeof console||"undefined"==typeof console.warn?this.debug(e):console.warn(e)},error:function(e){n.config.storeDebug&&(n.debugstring+="ERROR:"+e+"\n"),"undefined"==typeof console||"undefined"==typeof console.error?this.debug(e):console.error(e)},submitDebugLog:function(){n.net.ajax({url:n.config.debugLogEndpoint,data:{debug_string:n.debugstring}}).then(function(e){var t=JSON.parse(e.responseText);t.logID?alert("ZoteroWWW debug logID:"+t.logID):t.error&&alert("Error submitting ZoteroWWW debug log:"+t.error)})},catchPromiseError:function(e){n.error(e)},libraries:{},validator:{patterns:{itemKey:/^.+$/,collectionKey:/^([A-Z0-9]{8,})|trash$/,libraryID:/^[0-9]+$/,libraryType:/^(user|group|)$/,target:/^(items?|collections?|tags|children|deleted|userGroups|key|settings|publications)$/,targetModifier:/^(top|file|file\/view)$/,sort:/^(asc|desc)$/,start:/^[0-9]*$/,limit:/^[0-9]*$/,order:/^\S*$/,content:/^((html|json|data|bib|none|bibtex|bookmarks|coins|csljson|mods|refer|rdf_bibliontology|rdf_dc|ris|tei|wikipedia),?)+$/,include:/^((html|json|data|bib|none|bibtex|bookmarks|coins|csljson|mods|refer|rdf_bibliontology|rdf_dc|ris|tei|wikipedia),?)+$/,q:/^.*$/,fq:/^\S*$/,itemType:/^\S*$/,locale:/^\S*$/,tag:/^.*$/,tagType:/^(0|1)$/,key:/^\S*/,format:/^(json|atom|bib|keys|versions|bibtex|bookmarks|mods|refer|rdf_bibliontology|rdf_dc|rdf_zotero|ris|wikipedia)$/,style:/^\S*$/,linkwrap:/^(0|1)*$/},validate:function(e,t){if(Z.debug("Zotero.validate",4),""===e)return null;if(null===e)return!0;Z.debug(e+" "+t,4);var r=this.patterns;return r.hasOwnProperty(t)?r[t].test(e):null}},_logEnabled:0,enableLogging:function(){n._logEnabled++,n._logEnabled>0},disableLogging:function(){n._logEnabled--,n._logEnabled<=0&&(n._logEnabled=0)},init:function(){var e;e="localStorage"==n.config.cacheStoreType&&"undefined"!=typeof localStorage?localStorage:"sessionStorage"==n.config.cacheStoreType&&"undefined"!=typeof sessionStorage?sessionStorage:{},n.store=e,n.cache=new n.Cache(e),n.preferences=new n.Preferences(n.store,"global");var t="en-US";n.config.locale&&(t=n.config.locale),t="en-US"}};n.ajaxRequest=function(e,t,r){Z.debug("Zotero.ajaxRequest ==== "+e,3),t||(t="GET"),r||(r={});var o={url:e,type:t};return o=Z.extend({},o,r),Z.debug(o,3),n.net.queueRequest(o)},n.eventmanager={callbacks:{}},n.trigger=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];r&&(Z.debug("filter is not false",3),e+="_"+r),n.debug("Triggering eventful "+e,3),Z.debug(t),t.zeventful=!0;try{if(n.eventmanager.callbacks.hasOwnProperty(e)){var o=n.eventmanager.callbacks[e];o.forEach(function(e){var r=Z.extend({},t,e.data),o={data:r};e.f(o)})}}catch(i){Z.error("failed triggering:"+e),Z.error(i)}},n.listen=function(e,t,r,o){Z.debug("Zotero.listen: "+e);var i=e.split(" ");if(i.length>0&&o)for(var a=0;a<i.length;a++)i[a]+="_"+o;i.forEach(function(e){n.eventmanager.callbacks.hasOwnProperty(e)?n.eventmanager.callbacks[e].push({data:r,f:t}):n.eventmanager.callbacks[e]=[{data:r,f:t}]})},n.extend=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];"object"==("undefined"==typeof r?"undefined":o(r))&&Object.keys(r).forEach(function(t){e[t]=r[t]})}return e},t.exports=n},{}],54:[function(e,t,r){"use strict";t.exports=function(e){this.store=e;var t=this.store._registry;(null===t||"undefined"==typeof t)&&(t={},this.store._registry=JSON.stringify(t))},t.exports.prototype.objectCacheString=function(e){var t=[];Object.keys(e).forEach(function(r){var o=e[r];o&&(Array.isArray(o)?o.forEach(function(e){t.push(r+"/"+encodeURIComponent(e))}):t.push(r+"/"+encodeURIComponent(o)))}),t.sort(),Z.debug(t,4);var r=t.join("/");return r},t.exports.prototype.save=function(e,t,r){Array.isArray(r)||(r=[]);var o=JSON.parse(this.store._registry);o||(o={});var n=this.objectCacheString(e);this.store[n]=JSON.stringify(t);var i={id:n,saved:Date.now(),cachetags:r};o[n]=i,this.store._registry=JSON.stringify(o)},t.exports.prototype.load=function(e){Z.debug("Zotero.Cache.load",3);var t=this.objectCacheString(e);Z.debug(t,4);try{var r=this.store[t];return r?JSON.parse(r):(Z.warn("No value found in cache store - "+t,3),null)}catch(o){return Z.error("Error parsing retrieved cache data: "+t+" : "+r),null}},t.exports.prototype.expireCacheTag=function(e){Z.debug("Zotero.Cache.expireCacheTag",3);var t=JSON.parse(this.store._registry),r=this.store;Object.keys(t).forEach(function(o){var n=t[o];-1!=n.cachetags.indexOf(e)&&(Z.debug("tag "+e+" found for item "+n.id+" : expiring",4),delete r[n.id],delete t[n.id])})},t.exports.prototype.clear=function(){"function"==typeof this.store.clear?this.store.clear():this.store={}}},{}],55:[function(e,t,r){"use strict";t.exports=function(e){this.instance="Zotero.Collection",this.libraryUrlIdentifier="",this.itemKeys=!1,this.key="",this.version=0,this.synced=!1,this.pristineData=null,this.apiObj={key:"",version:0,library:{},links:{},meta:{},data:{key:"",version:0,name:"",parentCollection:!1,relations:{}}},this.children=[],this.topLevel=!0,e&&this.parseJsonCollection(e)},t.exports.prototype=new Zotero.ApiObject,t.exports.prototype.instance="Zotero.Collection",t.exports.prototype.updateObjectKey=function(e){this.updateCollectionKey(e)},t.exports.prototype.updateCollectionKey=function(e){var t=this;return t.key=e,t.apiObj.key=e,t.apiObj.data.key=e,t},t.exports.prototype.parseJsonCollection=function(e){Z.debug("parseJsonCollection",4);var t=this;t.key=e.key,t.version=e.version,t.apiObj=Z.extend({},e),t.pristineData=Z.extend({},e.data),t.parentCollection=!1,t.topLevel=!0,t.synced=!0,t.initSecondaryData()},t.exports.prototype.initSecondaryData=function(){var e=this;e.apiObj.data.parentCollection?e.topLevel=!1:e.topLevel=!0,Zotero.config.librarySettings.libraryPathString?e.websiteCollectionLink=Zotero.config.librarySettings.libraryPathString+"/collectionKey/"+e.apiObj.key:e.websiteCollectionLink="",e.hasChildren=e.apiObj.meta.numCollections?!0:!1},t.exports.prototype.nestCollection=function(e){Z.debug("Zotero.Collection.nestCollection",4);var t=this,r=t.get("parentCollection");if(r!==!1&&e.hasOwnProperty(r)){var o=e[r];return o.children.push(t),o.hasChildren=!0,t.topLevel=!1,!0}return!1},t.exports.prototype.addItems=function(e){Z.debug("Zotero.Collection.addItems",3);var t=this,r={target:"items",libraryType:t.apiObj.library.type,libraryID:t.apiObj.library.id,collectionKey:t.key},o=e.join(" ");return Zotero.ajaxRequest(r,"POST",{data:o})},t.exports.prototype.getMemberItemKeys=function(){Z.debug("Zotero.Collection.getMemberItemKeys",3);var e=this,t={target:"items",libraryType:e.apiObj.library.type,libraryID:e.apiObj.library.id,collectionKey:e.key,format:"keys"};return Zotero.ajaxRequest(t,"GET",{processData:!1}).then(function(t){Z.debug("getMemberItemKeys proxied callback",3);var r=t.data,o=r.trim().split(/[\s]+/);return e.itemKeys=o,o})},t.exports.prototype.removeItem=function(e){var t=this,r={target:"item",libraryType:t.apiObj.library.type,libraryID:t.apiObj.library.id,collectionKey:t.key,itemKey:e};return Zotero.ajaxRequest(r,"DELETE",{processData:!1,cache:!1})},t.exports.prototype.update=function(e,t){var r=this;t||(t=!1);var o={target:"collection",libraryType:r.apiObj.library.type,libraryID:r.apiObj.library.id,collectionKey:r.key};r.set("name",e),r.set("parentCollection",t);var n=r.writeApiObj(),i=JSON.stringify(n);return Zotero.ajaxRequest(o,"PUT",{data:i,processData:!1,headers:{"If-Unmodified-Since-Version":r.version},cache:!1})},t.exports.prototype.writeApiObj=function(){var e=this,t=Z.extend({},e.pristineData,e.apiObj.data);return t},t.exports.prototype.remove=function(){Z.debug("Zotero.Collection.delete",3);var e=this,t=e.owningLibrary,r={target:"collection",libraryType:e.apiObj.library.type,libraryID:e.apiObj.library.id,collectionKey:e.key};return Zotero.ajaxRequest(r,"DELETE",{processData:!1,headers:{"If-Unmodified-Since-Version":e.version},cache:!1}).then(function(){Z.debug("done deleting collection. remove local copy.",3),t.collections.removeLocalCollection(e.key),t.trigger("libraryCollectionsUpdated")})},t.exports.prototype.get=function(e){var t=this;switch(e){case"title":case"name":return t.apiObj.data.name;case"collectionKey":case"key":return t.apiObj.key||t.key;case"collectionVersion":case"version":return t.apiObj.version;case"parentCollection":return t.apiObj.data.parentCollection}return e in t.apiObj.data?t.apiObj.data[e]:t.apiObj.meta.hasOwnProperty(e)?t.apiObj.meta[e]:t.hasOwnProperty(e)?t[e]:null},t.exports.prototype.set=function(e,t){var r=this;switch(e in r.apiObj.data&&(r.apiObj.data[e]=t),e){case"title":case"name":r.apiObj.data.name=t;break;case"collectionKey":case"key":r.key=t,r.apiObj.key=t,r.apiObj.data.key=t;break;case"parentCollection":r.apiObj.data.parentCollection=t;break;case"collectionVersion":case"version":r.version=t,r.apiObj.version=t,r.apiObj.data.version=t}r.hasOwnProperty(e)&&(r[e]=t)}},{}],56:[function(e,t,r){"use strict";t.exports=function(e){this.instance="Zotero.Collections",this.version=0,this.syncState={earliestVersion:null,latestVersion:null},this.collectionObjects={},this.collectionsArray=[],this.objectMap=this.collectionObjects,this.objectArray=this.collectionsArray,this.dirty=!1,this.loaded=!1,e&&(this.addCollectionsFromJson(e),this.initSecondaryData())},t.exports.prototype=new Zotero.Container,t.exports.prototype.initSecondaryData=function(){Z.debug("Zotero.Collections.initSecondaryData",3);var e=this;e.collectionsArray=[],Object.keys(e.collectionObjects).forEach(function(t){var r=e.collectionObjects[t];e.collectionsArray.push(r)}),e.collectionsArray.sort(Zotero.ApiObject.prototype.fieldComparer("name")),e.nestCollections(),e.assignDepths(0,e.collectionsArray)},t.exports.prototype.addCollection=function(e){return this.addObject(e),this},t.exports.prototype.addCollectionsFromJson=function(e){Z.debug("addCollectionsFromJson"),Z.debug(e);var t=this,r=[];return e.forEach(function(e){var o=new Zotero.Collection(e);t.addObject(o),r.push(o)}),r},t.exports.prototype.assignDepths=function(e,t){Z.debug("Zotero.Collections.assignDepths",3);var r=this,o=function n(e,t){t.forEach(function(t){t.nestingDepth=e,t.hasChildren&&n(e+1,t.children)})};r.collectionsArray.forEach(function(e){e.topLevel&&(e.nestingDepth=1,e.hasChildren&&o(2,e.children))})},t.exports.prototype.nestedOrderingArray=function(){Z.debug("Zotero.Collections.nestedOrderingArray",3);var e=this,t=[],r=function o(e,t){t.forEach(function(t){e.push(t),t.hasChildren&&o(e,t.children)})};return e.collectionsArray.forEach(function(e){e.topLevel&&(t.push(e),e.hasChildren&&r(t,e.children))}),Z.debug("Done with nestedOrderingArray",3),t},t.exports.prototype.getCollection=function(e){return this.getObject(e)},t.exports.prototype.remoteDeleteCollection=function(e){var t=this;return t.removeLocalCollection(e)},t.exports.prototype.removeLocalCollection=function(e){var t=this;return t.removeLocalCollections([e])},t.exports.prototype.removeLocalCollections=function(e){for(var t=this,r=0;r<e.length;r++)delete t.collectionObjects[e[r]];t.initSecondaryData()},t.exports.prototype.nestCollections=function(){var e=this;e.collectionsArray.forEach(function(e){e.children=[]}),e.collectionsArray.sort(Zotero.ApiObject.prototype.fieldComparer("name")),e.collectionsArray.forEach(function(t){t.nestCollection(e.collectionObjects)})},t.exports.prototype.writeCollections=function(e){Z.debug("Zotero.Collections.writeCollections",3);var t,r=this,o=r.owningLibrary,n={target:"collections",libraryType:r.owningLibrary.libraryType,libraryID:r.owningLibrary.libraryID},i=Zotero.ajax.apiRequestString(n);for(t=0;t<e.length;t++){var a=e[t],s=a.get("key");if(""===s||null===s){var u=Zotero.utils.getKey();a.set("key",u),a.set("version",0)}}var c=r.chunkObjectsArray(e),l=r.rawChunks(c),p=function(e){Z.debug("writeCollections successCallback",3);var t=this.library,r=this.writeChunk;t.collections.updateObjectsFromWriteResponse(this.writeChunk,e);for(var o=0;o<r.length;o++){var n=r[o];n.synced&&!n.writeFailure&&(t.collections.addCollection(n),Zotero.config.useIndexedDB&&(Z.debug("updating indexedDB collections"),t.idbLibrary.updateCollections(r)))}return e.returnCollections=r,e};Z.debug("collections.version: "+r.version,3),Z.debug("collections.libraryVersion: "+r.libraryVersion,3);var d=[];for(t=0;t<c.length;t++){var f={writeChunk:c[t],library:o},h=JSON.stringify(l[t]);d.push({url:i,type:"POST",data:h,processData:!1,headers:{},success:p.bind(f)})}return o.sequentialRequests(d).then(function(e){return Z.debug("Done with writeCollections sequentialRequests promise",3),r.initSecondaryData(),e.forEach(function(e){if(e.isError||e.data.hasOwnProperty("failed")&&Object.keys(e.data.failed).length>0)throw new Error("failure when writing collections")}),e})["catch"](function(e){throw Z.error(e),e})}},{}],57:[function(e,t,r){"use strict";t.exports=function(){},t.exports.prototype.initSecondaryData=function(){},t.exports.prototype.addObject=function(e){Zotero.debug("Zotero.Container.addObject",4);var t=this;return t.objectArray.push(e),t.objectMap[e.key]=e,t.owningLibrary&&e.associateWithLibrary(t.owningLibrary),t},t.exports.prototype.fieldComparer=function(e){if(Intl){var t=new Intl.Collator;return function(r,o){return t.compare(r.apiObj.data[e],o.apiObj.data[e])}}return function(t,r){return t.apiObj.data[e].toLowerCase()==r.apiObj.data[e].toLowerCase()?0:t.apiObj.data[e].toLowerCase()<r.apiObj.data[e].toLowerCase()?-1:1}},t.exports.prototype.getObject=function(e){var t=this;return t.objectMap.hasOwnProperty(e)?t.objectMap[e]:!1},t.exports.prototype.getObjects=function(e){
for(var t,r=this,o=[],n=0;n<e.length;n++)t=r.getObject(e[n]),t&&o.push(t);return o},t.exports.prototype.removeObject=function(e){var t=this;t.objectMap.hasOwnProperty(e)&&(delete t.objectmap[e],t.initSecondaryData())},t.exports.prototype.removeObjects=function(e){for(var t=this,r=0;r<e.length;r++)delete t.objectMap[e[r]];t.initSecondaryData()},t.exports.prototype.writeObjects=function(e){},t.exports.prototype.assignKeys=function(e){for(var t,r=0;r<e.length;r++){t=e[r];var o=t.get("key");if(!o){var n=Zotero.utils.getKey();t.set("key",n),t.set("version",0)}}return e},t.exports.prototype.chunkObjectsArray=function(e){for(var t=50,r=[],o=0;o<e.length;o+=t)r.push(e.slice(o,o+t));return r},t.exports.prototype.rawChunks=function(e){for(var t=[],r=0;r<e.length;r++){t[r]=[];for(var o=0;o<e[r].length;o++)t[r].push(e[r][o].writeApiObj())}return t},t.exports.prototype.updateSyncState=function(e){var t=this;if(Z.debug("updateSyncState: "+e,3),!t.hasOwnProperty("syncState"))throw Z.debug("no syncState property"),new Error("Attempt to update sync state of object with no syncState property");null===t.syncState.earliestVersion&&(t.syncState.earliestVersion=e),null===t.syncState.latestVersion&&(t.syncState.latestVersion=e),e<t.syncState.earliestVersion&&(t.syncState.earliestVersion=e),e>t.syncState.latestVersion&&(t.syncState.latestVersion=e),Z.debug("done updating sync state",3)},t.exports.prototype.updateSyncedVersion=function(e){var t=this;null!==t.syncState.earliestVersion&&t.syncState.earliestVersion==t.syncState.latestVersion?(t.version=t.syncState.latestVersion,t.synced=!0):null!==t.syncState.earliestVersion&&(t.version=t.syncState.earliestVersion)},t.exports.prototype.processDeletions=function(e){for(var t=this,r=0;r<e.length;r++){var o=t.get(e[r]);o!==!1&&o.synced===!0&&t.removeObjects([e[r]])}},t.exports.prototype.updateObjectsFromWriteResponse=function(e,t){Z.debug("Zotero.Container.updateObjectsFromWriteResponse",3),Z.debug("statusCode: "+t.status,3);var r=t.data;200==t.status?(Z.debug("newLastModifiedVersion: "+t.lastModifiedVersion,3),r.hasOwnProperty("success")&&Object.keys(r.success).forEach(function(o){var n=parseInt(o,10),i=r.success[o],a=e[n];if(""!==a.key&&a.key!==i)throw new Error("object key mismatch in multi-write response");""===a.key&&a.updateObjectKey(i),a.set("version",t.lastModifiedVersion),a.synced=!0,a.writeFailure=!1}),r.hasOwnProperty("failed")&&(Z.debug("updating objects with failed writes",3),Object.keys(r.failed).forEach(function(t){var o=r.failed[t];Z.error("failed write "+t+" - "+o);var n=parseInt(t,10),i=e[n];i.writeFailure=o}))):204==t.status&&(e[0].synced=!0)},t.exports.prototype.extractKey=function(e){return"string"==typeof e?e:e.get("key")}},{}],58:[function(e,t,r){"use strict";t.exports=function(e){this.instance="Zotero.Deleted","string"==typeof e?this.deletedData=JSON.parse(e):this.deletedData=e,this.untilVersion=null,this.sinceVersion=null,this.waitingPromises=[],this.pending=!1},t.exports.prototype.addWaiter=function(){}},{}],59:[function(e,t,r){"use strict";var o=e("spark-md5");t.exports={},t.exports.getFileInfo=function(e){return"undefined"==typeof FileReader?Promise.reject(new Error("FileReader not supported")):new Promise(function(t,r){var n={},i=new FileReader;i.onload=function(r){Z.debug("Zotero.file.getFileInfo onloadFunc",3);var i=r.target.result;Zotero.debug(i,3),n.md5=o.ArrayBuffer.hash(i),n.filename=e.name,n.filesize=e.size,n.mtime=Date.now(),n.contentType=e.type,n.filedata=i,t(n)},i.readAsArrayBuffer(e)})},t.exports.uploadFile=function(e,t){Z.debug("Zotero.file.uploadFile",3),Z.debug(e,4);var r=new FormData;Object.keys(e.params).forEach(function(t){var o=e.params[t];r.append(t,o)});var o=new Blob([t.filedata],{type:t.contentType});r.append("file",o);var n=new XMLHttpRequest;return n.open("POST",e.url,!0),new Promise(function(e,t){n.onload=function(r){Z.debug("uploadFile onload event",3),201==this.status?(Z.debug("successful upload - 201",3),e()):(Z.error("uploadFile failed - "+n.status),t({message:"Failure uploading file.",code:n.status,serverMessage:n.responseText}))},n.onprogress=function(e){Z.debug("progress event"),Z.debug(e)},n.send(r)})}},{"spark-md5":46}],60:[function(e,t,r){"use strict";t.exports=function(e){var t=this;t.instance="Zotero.Group",e&&this.parseJsonGroup(e)},t.exports.prototype=new Zotero.ApiObject,t.exports.prototype.parseJsonGroup=function(e){var t=this;t.apiObj=e},t.exports.prototype.get=function(e){var t=this;switch(e){case"title":case"name":return t.apiObj.data.name}return e in t.apiObj?t.apiObj[e]:e in t.apiObj.data?t.apiObj.data[e]:e in t.apiObj.meta?t.apiObj.meta[e]:t.hasOwnProperty(e)?t[e]:null},t.exports.prototype.isWritable=function(e){var t=this;switch(!0){case t.get("owner")==e:return!0;case t.apiObj.data.admins&&-1!=t.apiObj.data.admins.indexOf(e):return!0;case"members"==t.apiObj.data.libraryEditing&&t.apiObj.data.members&&-1!=t.apiObj.data.members.indexOf(e):return!0;default:return!1}},t.exports.prototype.typeMap={Private:"Private",PublicOpen:"Public, Open Membership",PublicClosed:"Public, Closed Membership"},t.exports.prototype.accessMap={all:{members:"Anyone can view, only members can edit",admins:"Anyone can view, only admins can edit"},members:{members:"Only members can view and edit",admins:"Only members can view, only admins can edit"},admins:{members:"Only admins can view, only members can edit",admins:"Only admins can view and edit"}}},{}],61:[function(e,t,r){"use strict";t.exports=function(){this.instance="Zotero.Groups",this.groupsArray=[]},t.exports.prototype.addGroupsFromJson=function(e){var t=this,r=[];return e.forEach(function(e){Z.debug(e,3);var o=new Zotero.Group(e);t.groupsArray.push(o),r.push(o)}),r},t.exports.prototype.fetchUserGroups=function(e,t){var r=this,o={target:"userGroups",libraryType:"user",libraryID:e,order:"title"};return t?o.key=t:r.owningLibrary&&(o.key=r.owningLibrary._apiKey),Zotero.ajaxRequest(o).then(function(e){Z.debug("fetchUserGroups proxied callback",3);var t=r.addGroupsFromJson(e.data);return e.fetchedGroups=t,e})}},{}],62:[function(e,t,r){"use strict";if("undefined"==typeof window){e("fake-indexeddb")}t.exports={},t.exports.Library=function(e){Z.debug("Zotero.Idb.Library",3),Z.debug("Initializing Zotero IDB",3),this.libraryString=e,this.owningLibrary=null,this.initialized=!1},t.exports.Library.prototype.init=function(){var e=this;return new Promise(function(t,r){var o=window.indexedDB;e.indexedDB=o,Z.debug("requesting indexedDb from browser",3);var n=o.open("Zotero_"+e.libraryString,4);n.onerror=function(e){Zotero.error("ERROR OPENING INDEXED DB"),r()};var i=function(t){Z.debug("Zotero.Idb onupgradeneeded or onsuccess",3);var r=t.oldVersion;Z.debug("oldVersion: "+t.oldVersion,3);var o=t.target.result;if(e.db=o,4>r){Z.debug("Existing object store names:",3),Z.debug(JSON.stringify(o.objectStoreNames),3),Z.debug("Deleting old object stores",3),o.objectStoreNames.items&&o.deleteObjectStore("items"),o.objectStoreNames.tags&&o.deleteObjectStore("tags"),o.objectStoreNames.collections&&o.deleteObjectStore("collections"),o.objectStoreNames.files&&o.deleteObjectStore("files"),o.objectStoreNames.versions&&o.deleteObjectStore("versions"),Z.debug("Existing object store names:",3),Z.debug(JSON.stringify(o.objectStoreNames),3);var n=o.createObjectStore("items",{keyPath:"key"}),i=o.createObjectStore("collections",{keyPath:"key"}),a=o.createObjectStore("tags",{keyPath:"tag"});o.createObjectStore("files"),o.createObjectStore("versions");Z.debug("itemStore index names:",3),Z.debug(JSON.stringify(n.indexNames),3),Z.debug("collectionStore index names:",3),Z.debug(JSON.stringify(i.indexNames),3),Z.debug("tagStore index names:",3),Z.debug(JSON.stringify(a.indexNames),3),Object.keys(Zotero.Item.prototype.fieldMap).forEach(function(e){Z.debug("Creating index on "+e,3),n.createIndex(e,"data."+e,{unique:!1})}),n.createIndex("collectionKeys","data.collections",{unique:!1,multiEntry:!0}),n.createIndex("itemTagStrings","_supplement.tagstrings",{unique:!1,multiEntry:!0}),n.createIndex("parentItemKey","data.parentItem",{unique:!1}),n.createIndex("libraryKey","libraryKey",{unique:!1}),n.createIndex("deleted","data.deleted",{unique:!1}),i.createIndex("name","data.name",{unique:!1}),i.createIndex("key","key",{unique:!1}),i.createIndex("parentCollection","data.parentCollection",{unique:!1}),a.createIndex("tag","tag",{unique:!1})}};n.onupgradeneeded=i,n.onsuccess=function(){Z.debug("IDB success",3),e.db=n.result,e.initialized=!0,t(e)}})},t.exports.Library.prototype.deleteDB=function(){var e=this;return e.db.close(),new Promise(function(t,r){var o=e.indexedDB.deleteDatabase("Zotero_"+e.libraryString);o.onerror=function(){Z.error("Error deleting indexedDB"),r()},o.onsuccess=function(){Z.debug("Successfully deleted indexedDB",2),t()}})},t.exports.Library.prototype.getObjectStore=function(e,t){var r=this,o=r.db.transaction(e,t);return o.objectStore(e)},t.exports.Library.prototype.clearObjectStore=function(e){var t=this,r=t.getObjectStore(e,"readwrite");return new Promise(function(e,t){var o=r.clear();o.onsuccess=function(t){Z.debug("Store cleared",3),e()},o.onerror=function(e){Z.error("clearObjectStore:",e.target.errorCode),t()}})},t.exports.Library.prototype.addItems=function(e){return this.addObjects(e,"item")},t.exports.Library.prototype.updateItems=function(e){return this.updateObjects(e,"item")},t.exports.Library.prototype.removeItems=function(e){return this.removeObjects(e,"item")},t.exports.Library.prototype.getItem=function(e){var t=this;return new Promise(function(r,o){var n=function(e){r(e.target.result)};t.db.transaction("items").objectStore(["items"],"readonly").get(e).onsuccess=n})},t.exports.Library.prototype.getAllItems=function(){return this.getAllObjects("item")},t.exports.Library.prototype.getOrderedItemKeys=function(e,t){var r=this;return Z.debug("Zotero.Idb.getOrderedItemKeys",3),Z.debug(""+e+" "+t,3),new Promise(function(o,n){var i=r.db.transaction(["items"],"readonly").objectStore("items"),a=i.index(e);if(!a)throw new Error("Index for requested field '"+e+"'' not found");var s="next";"desc"==t&&(s="prev");var u=a.openKeyCursor(null,s),c=[];u.onsuccess=function(e){var t=e.target.result;t?(c.push(t.primaryKey),t["continue"]()):(Z.debug("No more cursor: done. Resolving deferred.",3),o(c))}.bind(this),u.onfailure=function(e){n()}.bind(this)})},t.exports.Library.prototype.filterItems=function(e,t){var r=this;return Z.debug("Zotero.Idb.filterItems "+e+" - "+t,3),new Promise(function(o,n){var i=[],a=r.db.transaction(["items"],"readonly").objectStore("items"),s=a.index(e);if(!s)throw new Error("Index for requested field '"+e+"'' not found");var u="next",c=IDBKeyRange.only(t),l=s.openKeyCursor(c,u);l.onsuccess=function(e){var t=e.target.result;t?(i.push(t.primaryKey),t["continue"]()):(Z.debug("No more cursor: done. Resolving deferred.",3),o(i))}.bind(this),l.onfailure=function(e){n()}.bind(this)})},t.exports.Library.prototype.inferType=function(e){if(!e)return!1;if(!e.instance)return!1;switch(e.instance){case"Zotero.Item":return"item";case"Zotero.Collection":return"collection";case"Zotero.Tag":return"tag";default:return!1}},t.exports.Library.prototype.getTransactionAndStore=function(e,t){var r,o,n=this;switch(e){case"item":r=n.db.transaction(["items"],t),o=r.objectStore("items");break;case"collection":r=n.db.transaction(["collections"],t),o=r.objectStore("collections");break;case"tag":r=n.db.transaction(["tags"],t),o=r.objectStore("tags");break;default:return Promise.reject()}return[r,o]},t.exports.Library.prototype.addObjects=function(e,t){Z.debug("Zotero.Idb.Library.addObjects",3);var r=this;t||(t=r.inferType(e[0]));var o=r.getTransactionAndStore(t,"readwrite"),n=o[0],i=o[1];return new Promise(function(t,r){n.oncomplete=function(e){Zotero.debug("Add Objects transaction completed.",3),t()},n.onerror=function(e){Zotero.error("Add Objects transaction failed."),r()};var o=function(e){Zotero.debug("Added Object "+e.target.result,4)};for(var a in e){var s=i.add(e[a].apiObj);s.onsuccess=o}})},t.exports.Library.prototype.updateObjects=function(e,t){Z.debug("Zotero.Idb.Library.updateObjects",3);var r=this;t||(t=r.inferType(e[0]));var o=r.getTransactionAndStore(t,"readwrite"),n=o[0],i=o[1];return new Promise(function(t,r){n.oncomplete=function(e){Zotero.debug("Update Objects transaction completed.",3),t()},n.onerror=function(e){Zotero.error("Update Objects transaction failed."),r()};var o=function(e){Zotero.debug("Updated Object "+e.target.result,4)};for(var a in e){var s=i.put(e[a].apiObj);s.onsuccess=o}})},t.exports.Library.prototype.removeObjects=function(e,t){var r=this;t||(t=r.inferType(e[0]));var o=r.getTransactionAndStore(t,"readwrite"),n=o[0],i=o[1];return new Promise(function(t,r){n.oncomplete=function(e){Zotero.debug("Remove Objects transaction completed.",3),t()},n.onerror=function(e){Zotero.error("Remove Objects transaction failed."),r()};var o=function(e){Zotero.debug("Removed Object "+e.target.result,4)};for(var a in e){var s=i["delete"](e[a].key);s.onsuccess=o}})},t.exports.Library.prototype.getAllObjects=function(e){var t=this;return new Promise(function(r,o){var n=[],i=t.db.transaction(e+"s").objectStore(e+"s");i.openCursor().onsuccess=function(e){var t=e.target.result;t?(n.push(t.value),t["continue"]()):r(n)}})},t.exports.Library.prototype.addCollections=function(e){return this.addObjects(e,"collection")},t.exports.Library.prototype.updateCollections=function(e){return Z.debug("Zotero.Idb.Library.updateCollections",3),this.updateObjects(e,"collection")},t.exports.Library.prototype.getCollection=function(e){var t=this;return new Promise(function(r,o){var n=function(e){r(e.target.result)};t.db.transaction("collections").objectStore(["collections"],"readonly").get(e).onsuccess=n})},t.exports.Library.prototype.removeCollections=function(e){return Z.debug("Zotero.Idb.Library.removeCollections",3),this.removeObjects(e,"collection")},t.exports.Library.prototype.getAllCollections=function(){return Z.debug("Zotero.Idb.Library.getAllCollections",3),this.getAllObjects("collection")},t.exports.Library.prototype.addTags=function(e){return this.addObjects(e,"tag")},t.exports.Library.prototype.updateTags=function(e){return Z.debug("Zotero.Idb.Library.updateTags",3),this.updateObjects(e,"tag")},t.exports.Library.prototype.getAllTags=function(){return Z.debug("getAllTags",3),this.getAllObjects("tag")},t.exports.Library.prototype.setVersion=function(e,t){Z.debug("Zotero.Idb.Library.setVersion",3);var r=this;return new Promise(function(o,n){var i=r.db.transaction(["versions"],"readwrite");i.oncomplete=function(e){Zotero.debug("set version transaction completed.",3),o()},i.onerror=function(e){Zotero.error("set version transaction failed."),n()};var a=i.objectStore("versions"),s=function(e){Zotero.debug("Set Version"+e.target.result,3)},u=a.put(t,e);u.onsuccess=s})},t.exports.Library.prototype.getVersion=function(e){Z.debug("Zotero.Idb.Library.getVersion",3);var t=this;return new Promise(function(r,o){var n=function(e){Z.debug("done getting version"),r(e.target.result)};t.db.transaction(["versions"],"readonly").objectStore("versions").get(e).onsuccess=n})},t.exports.Library.prototype.setFile=function(e,t){Z.debug("Zotero.Idb.Library.setFile",3);var r=this;return new Promise(function(o,n){var i=r.db.transaction(["files"],"readwrite");i.oncomplete=function(e){Zotero.debug("set file transaction completed.",3),o()},i.onerror=function(e){Zotero.error("set file transaction failed."),n()};var a=i.objectStore("files"),s=function(e){Zotero.debug("Set File"+e.target.result,3)},u=a.put(t,e);u.onsuccess=s})},t.exports.Library.prototype.getFile=function(e){Z.debug("Zotero.Idb.Library.getFile",3);var t=this;return new Promise(function(r,o){var n=function(e){Z.debug("done getting file"),r(e.target.result)};t.db.transaction(["files"],"readonly").objectStore("files").get(e).onsuccess=n})},t.exports.Library.prototype.deleteFile=function(e){Z.debug("Zotero.Idb.Library.deleteFile",3);var t=this;return new Promise(function(r,o){var n=t.db.transaction(["files"],"readwrite");n.oncomplete=function(e){Zotero.debug("delete file transaction completed.",3),r()},n.onerror=function(e){Zotero.error("delete file transaction failed."),o()};var i=n.objectStore("files"),a=function(e){Zotero.debug("Deleted File"+e.target.result,4)},s=i["delete"](e);s.onsuccess=a})},t.exports.Library.prototype.intersect=function(e,t){for(var r=[],o=0;o<e.length;o++)-1!==t.indexOf(e[o])&&r.push(e[o]);return r},t.exports.Library.prototype.intersectAll=function(e){for(var t=this,r=e[0],o=0;o<e.length-1;o++)r=t.intersect(r,e[o+1]);return r}},{"fake-indexeddb":5}],63:[function(e,t,r){"use strict";var o=e("striptags"),n=e("./ItemMaps.js"),i=function(e){this.instance="Zotero.Item",this.version=0,this.key="",this.synced=!1,this.apiObj={},this.pristineData=null,this.childItemKeys=[],this.writeErrors=[],this.notes=[],e?this.parseJsonItem(e):this.parseJsonItem(this.emptyJsonItem()),this.initSecondaryData()};i.prototype=new Zotero.ApiObject,i.prototype.parseJsonItem=function(e){Z.debug("parseJsonItem",3);var t=this;t.version=e.version,t.key=e.key,t.apiObj=Z.extend({},e),t.pristineData=Z.extend({},e.data),t.apiObj._supplement||(t.apiObj._supplement={})},i.prototype.emptyJsonItem=function(){return{key:"",version:0,library:{},links:{},data:{key:"",version:0,title:"",creators:[],collections:[],tags:[],relations:{}},meta:{},_supplement:{}}},i.prototype.initSecondaryData=function(){Z.debug("initSecondaryData",3);var e=this;e.version=e.apiObj.version,"attachment"==e.apiObj.data.itemType&&(e.mimeType=e.apiObj.data.contentType,e.translatedMimeType=Zotero.utils.translateMimeType(e.mimeType)),"linkMode"in e.apiObj&&(e.linkMode=e.apiObj.data.linkMode),e.attachmentDownloadUrl=Zotero.url.attachmentDownloadUrl(e),e.apiObj.meta.parsedDate?e.parsedDate=new Date(e.apiObj.meta.parsedDate):e.parsedDate=!1,e.synced=!1,e.updateTagStrings(),Z.debug("done with initSecondaryData",3)},i.prototype.updateTagStrings=function(){for(var e=this,t=[],r=0;r<e.apiObj.data.tags.length;r++)t.push(e.apiObj.data.tags[r].tag);e.apiObj._supplement.tagstrings=t},i.prototype.initEmpty=function(e,t){var r=this;return r.getItemTemplate(e,t).then(function(e){return r.initEmptyFromTemplate(e),r})},i.prototype.initEmptyNote=function(){var e=this;e.version=0;var t={itemType:"note",note:"",tags:[],collections:[],relations:{}};return e.initEmptyFromTemplate(t),e},i.prototype.initEmptyFromTemplate=function(e){var t=this;return t.version=0,t.key="",t.pristineData=Z.extend({},e),t.apiObj={key:"",version:0,library:{},links:{},data:e,meta:{},_supplement:{}},t.initSecondaryData(),t},i.prototype.isSupplementaryItem=function(){var e=this,t=e.get("itemType");return"attachment"==t||"note"==t?!0:!1},i.prototype.isSnapshot=function(){var e=this;if(e.apiObj.links.enclosure){var t=e.apiObj.links.enclosure.type;if(!e.apiObj.links.enclosure.length&&"text/html"==t)return!0}return!1},i.prototype.updateObjectKey=function(e){return this.updateItemKey(e)},i.prototype.updateItemKey=function(e){var t=this;return t.key=e,t.apiObj.key=e,t.apiObj.data.key=e,t.pristineData.key=e,t},i.prototype.writeItem=function(){var e=this;if(!e.owningLibrary)throw new Error("Item must be associated with a library");return e.owningLibrary.items.writeItems([e])},i.prototype.writeApiObj=function(){var e=this;if(e.apiObj.data.creators){var t=e.apiObj.data.creators.filter(function(e){return e.name||e.firstName||e.lastName?!0:!1});e.apiObj.data.creators=t}var r=Z.extend({},e.pristineData,e.apiObj.data);return r},i.prototype.createChildNotes=function(e){var t=this,r=[],o=[];return e.forEach(function(e){var n=new i,a=n.initEmpty("note").then(function(o){o.set("note",e.note),o.set("parentItem",t.key),r.push(o)});o.push(a)}),Promise.all(o).then(function(){return t.owningLibrary.writeItems(r)})},i.prototype.writePatch=function(){},i.prototype.getChildren=function(e){Z.debug("Zotero.Item.getChildren");var t=this;return Promise.resolve().then(function(){if(!t.apiObj.meta.numChildren)return[];var r={url:{target:"children",libraryType:t.apiObj.library.type,libraryID:t.apiObj.library.id,itemKey:t.key}};return Zotero.net.queueRequest(r).then(function(t){Z.debug("getChildren proxied callback",4);for(var r=e.items,o=r.addItemsFromJson(t.data),n=o.length-1;n>=0;n--)o[n].associateWithLibrary(e);return o})})},i.prototype.getItemTypes=function(e){Z.debug("Zotero.Item.prototype.getItemTypes",3),e||(e="en-US"),e="en-US";var t=Zotero.cache.load({locale:e,target:"itemTypes"});if(t)return Z.debug("have itemTypes in localStorage",3),void(i.prototype.itemTypes=t);var r=Zotero.ajax.apiQueryString({locale:e}),o=Zotero.config.baseApiUrl+"/itemTypes"+r;Zotero.net.ajax({url:Zotero.ajax.proxyWrapper(o,"GET"),type:"GET"}).then(function(t){Z.debug("got itemTypes response",3),Z.debug(t.response,4),i.prototype.itemTypes=JSON.parse(t.responseText),Zotero.cache.save({locale:e,target:"itemTypes"},i.prototype.itemTypes)})},i.prototype.getItemFields=function(e){Z.debug("Zotero.Item.prototype.getItemFields",3),e||(e="en-US"),e="en-US";var t=Zotero.cache.load({locale:e,target:"itemFields"});if(t)return Z.debug("have itemFields in localStorage",3),i.prototype.itemFields=t,void Object.keys(i.prototype.itemFields).forEach(function(e){var t=i.prototype.itemFields[e];Zotero.localizations.fieldMap[t.field]=t.localized});var r=Zotero.ajax.apiQueryString({locale:e}),o=Zotero.config.baseApiUrl+"/itemFields"+r;Zotero.net.ajax({url:Zotero.ajax.proxyWrapper(o),type:"GET"}).then(function(t){Z.debug("got itemTypes response",4);var r=JSON.parse(t.responseText);i.prototype.itemFields=r,Zotero.cache.save({locale:e,target:"itemFields"},r),Object.keys(i.prototype.itemFields).forEach(function(e){var t=i.prototype.itemFields[e];Zotero.localizations.fieldMap[t.field]=t.localized})})},i.prototype.getItemTemplate=function(){var e=arguments.length<=0||void 0===arguments[0]?"document":arguments[0],t=arguments.length<=1||void 0===arguments[1]?"":arguments[1];if(Z.debug("Zotero.Item.prototype.getItemTemplate",3),"attachment"==e&&""==t)throw new Error("attachment template requested with no linkMode");var r=Zotero.ajax.apiQueryString({itemType:e,linkMode:t}),o=Zotero.config.baseApiUrl+"/items/new"+r,n={itemType:e,target:"itemTemplate"},i=Zotero.cache.load(n);if(i){Z.debug("have itemTemplate in localStorage",3);var a=i;return Promise.resolve(a)}return Zotero.ajaxRequest(o,"GET",{dataType:"json"}).then(function(e){return Z.debug("got itemTemplate response",3),Zotero.cache.save(n,e.data),e.data})},i.prototype.getUploadAuthorization=function(e){Z.debug("Zotero.Item.getUploadAuthorization",3);var t=this,r={target:"item",targetModifier:"file",libraryType:t.owningLibrary.type,libraryID:t.owningLibrary.libraryID,itemKey:t.key},o={"Content-Type":"application/x-www-form-urlencoded"},n=t.get("md5");return n?o["If-Match"]=n:o["If-None-Match"]="*",Zotero.ajaxRequest(r,"POST",{processData:!0,data:e,headers:o})},i.prototype.registerUpload=function(e){Z.debug("Zotero.Item.registerUpload",3);var t=this,r={target:"item",targetModifier:"file",libraryType:t.owningLibrary.type,libraryID:t.owningLibrary.libraryID,itemKey:t.key},o={"Content-Type":"application/x-www-form-urlencoded"},n=t.get("md5");return n?o["If-Match"]=n:o["If-None-Match"]="*",Zotero.ajaxRequest(r,"POST",{processData:!0,data:{upload:e},headers:o})},i.prototype.fullUpload=function(e){},i.prototype.creatorTypes={},i.prototype.getCreatorTypes=function(e){Z.debug("Zotero.Item.prototype.getCreatorTypes: "+e,3),e||(e="document");var t=Zotero.cache.load({target:"creatorTypes"});if(t&&(Z.debug("have creatorTypes in localStorage",3),i.prototype.creatorTypes=t),i.prototype.creatorTypes[e])return Z.debug("creatorTypes of requested itemType available in localStorage",3),Z.debug(i.prototype.creatorTypes,4),Promise.resolve(i.prototype.creatorTypes[e]);Z.debug("sending request for creatorTypes",3);var r=Zotero.ajax.apiQueryString({itemType:e}),o=Zotero.config.baseApiUrl+"/itemTypeCreatorTypes"+r;return Zotero.ajaxRequest(o,"GET",{dataType:"json"}).then(function(t){return Z.debug("got creatorTypes response",4),i.prototype.creatorTypes[e]=t.data,Zotero.cache.save({target:"creatorTypes"},i.prototype.creatorTypes),i.prototype.creatorTypes[e]})},i.prototype.getCreatorFields=function(e){Z.debug("Zotero.Item.prototype.getCreatorFields",3);var t=Zotero.cache.load({target:"creatorFields"});if(t)return Z.debug("have creatorFields in localStorage",3),i.prototype.creatorFields=t,Promise.resolve(t);var r=Zotero.config.baseApiUrl+"/creatorFields";return Zotero.ajaxRequest(r,"GET",{dataType:"json"}).then(function(e){Z.debug("got itemTypes response",4),i.prototype.creatorFields=e.data,Zotero.cache.save({target:"creatorFields"},e.data)})},i.prototype.addItemTypes=function(e,t){},i.prototype.addItemFields=function(e,t){},i.prototype.addCreatorTypes=function(e,t){},i.prototype.addCreatorFields=function(e,t){},i.prototype.addItemTemplates=function(e){},i.prototype.itemTypeImageClass=function(){var e=this;if("attachment"!=e.apiObj.data.itemType)return e.apiObj.data.itemType;switch(e.apiObj.data.linkMode){case"imported_file":return"pdf"==e.translatedMimeType?e.itemTypeImageSrc.attachmentPdf:e.itemTypeImageSrc.attachmentFile;case"imported_url":return"pdf"==e.translatedMimeType?e.itemTypeImageSrc.attachmentPdf:e.itemTypeImageSrc.attachmentSnapshot;case"linked_file":return e.itemTypeImageSrc.attachmentLink;case"linked_url":return e.itemTypeImageSrc.attachmentWeblink;default:return e.itemTypeImageSrc.attachment}},i.prototype.itemTypeIconClass=function(){var e=this,t="fa fa-file-text-o";switch(e.apiObj.data.itemType){case"attachment":switch(e.apiObj.data.linkMode){case"imported_file":return"pdf"==e.translatedMimeType?"fa fa-file-pdf-o":"glyphicons glyphicons-file";case"imported_url":return"pdf"==e.translatedMimeType?"fa fa-file-pdf-o":"glyphicons glyphicons-file";case"linked_file":return"glyphicons glyphicons-link";case"linked_url":return"glyphicons glyphicons-link";default:return"glyphicons glyphicons-paperclip"}return"glyphicons file";case"artwork":return"glyphicons glyphicons-picture";case"audioRecording":return"glyphicons glyphicons-microphone";case"bill":return t;case"blogPost":return"glyphicons glyphicons-blog";case"book":return"glyphicons glyphicons-book";case"bookSection":return"glyphicons glyphicons-book-open";case"case":return t;case"computerProgram":return"glyphicons glyphicons-floppy-disk";case"conferencePaper":return t;case"dictionaryEntry":return"glyphicons glyphicons-translate";case"document":return"glyphicons glyphicons-file";case"email":return"glyphicons glyphicons-envelope";case"encyclopediaArticle":return"glyphicons glyphicons-bookmark";case"film":return"glyphicons glyphicons-film";case"forumPost":return"glyphicons glyphicons-bullhorn";case"hearing":return"fa fa-gavel";case"instantMessage":return"fa fa-comment-o";case"interview":return"fa fa-comments-o";case"journalArticle":return"fa fa-file-text-o";case"letter":return"glyphicons glyphicons-message-full";case"magazineArticle":return t;case"manuscript":return"glyphicons glyphicons-pen";case"map":return"glyphicons glyphicons-google-maps";case"newspaperArticle":return"fa fa-newspaper-o";case"note":return"glyphicons glyphicons-notes noteyellow";case"patent":return"glyphicons glyphicons-lightbulb";case"podcast":return"glyphicons glyphicons-ipod";case"presentation":return"glyphicons glyphicons-keynote";case"radioBroadcast":return"glyphicons glyphicons-wifi-alt";case"report":return"glyphicons glyphicons-notes-2";case"statue":return"glyphicons glyphicons-bank";case"thesis":return"fa fa-graduation-cap";case"tvBroadcast":return"glyphicons glyphicons-display";case"videoRecording":return"glyphicons glyphicons-facetime-video";case"webpage":return"glyphicons glyphicons-embed-close";default:return"glyphicons file"}},i.prototype.get=function(e){var t=this;switch(e){case"title":;return"note"==t.apiObj.data.itemType?t.noteTitle(t.apiObj.data.note):t.apiObj.data.title;case"creatorSummary":case"creator":return"undefined"!=typeof t.apiObj.meta.creatorSummary?t.apiObj.meta.creatorSummary:"";case"year":return t.parsedDate?t.parsedDate.getFullYear():""}return e in t.apiObj.data?t.apiObj.data[e]:e in t.apiObj.meta?t.apiObj.meta[e]:t.hasOwnProperty(e)?t[e]:null},i.prototype.set=function(e,t){var r=this;switch(e in r.apiObj&&(r.apiObj[e]=t),e in r.apiObj.data&&(r.apiObj.data[e]=t),e in r.apiObj.meta&&(r.apiObj.meta[e]=t),e){case"itemKey":case"key":r.key=t,r.apiObj.data.key=t;break;case"itemVersion":case"version":r.version=t,r.apiObj.data.version=t;break;case"itemType":r.itemType=t;break;case"linkMode":break;case"deleted":r.apiObj.data.deleted=t;break;case"parentItem":""===t&&(t=!1),r.apiObj.data.parentItem=t}return r},i.prototype.noteTitle=function(e){var t=120,r=o(e),n=r.indexOf("\n");return-1!=n&&t>n?r.substr(0,n):r.substr(0,t)},i.prototype.setParent=function(e){var t=this;return"string"!=typeof e&&e.hasOwnProperty("instance")&&"Zotero.Item"==e.instance&&(e=e.key),t.set("parentItem",e),t},i.prototype.addToCollection=function(e){var t=this;"string"!=typeof e&&"Zotero.Collection"==e.instance&&(e=e.key),-1===t.apiObj.data.collections.indexOf(e)&&t.apiObj.data.collections.push(e)},i.prototype.removeFromCollection=function(e){var t=this;"string"!=typeof e&&"Zotero.Collection"==e.instance&&(e=e.key);var r=t.apiObj.data.collections.indexOf(e);-1!=r&&t.apiObj.data.collections.splice(r,1)},i.prototype.uploadChildAttachment=function(e,t,r){var o=this;return Z.debug("uploadChildAttachment",3),o.owningLibrary?(e.set("parentItem",o.key),e.associateWithLibrary(o.owningLibrary),e.writeItem().then(function(n){return o.numChildren++,e.uploadFile(t,r)},function(e){throw{message:"Failure during attachmentItem write.",code:e.status,serverMessage:e.jqxhr.responseText,response:e}})):Promise.reject(new Error("Item must be associated with a library"))},i.prototype.uploadFile=function(e,t){var r=this;Z.debug("Zotero.Item.uploadFile",3);var o={md5:e.md5,filename:r.get("title"),filesize:e.filesize,mtime:e.mtime,contentType:e.contentType,params:1};return""===e.contentType&&(o.contentType="application/octet-stream"),r.getUploadAuthorization(o).then(function(t){Z.debug("uploadAuth callback",3);var o;return o="string"==typeof t.data?JSON.parse(t.data):t.data,1==o.exists?{message:"File Exists"}:Zotero.file.uploadFile(o,e).then(function(){return r.registerUpload(o.uploadKey).then(function(e){if(e.isError){var t={message:"Failed to register uploaded file.",code:e.status,serverMessage:e.jqxhr.responseText,response:e};throw Z.error(t),t}return{message:"Upload Successful"}})})})["catch"](function(e){throw Z.debug("Failure caught during upload",3),Z.debug(e,3),{message:"Failure during upload.",code:e.status,serverMessage:e.jqxhr.responseText,response:e}})},i.prototype.cslItem=function(){var e=this,t=e.get("itemType"),r=e.cslTypeMap.hasOwnProperty(t)?e.cslTypeMap[t]:!1;r||(r="article");var o=(e.get("accessDate")||e.get("url"))&&t in{journalArticle:1,newspaperArticle:1,magazineArticle:1}&&e.get("pages")&&e.citePaperJournalArticleURL,n={type:r};e.owningLibrary?n.id=e.apiObj.library.id+"/"+e.get("key"):n.id=Zotero.utils.getKey(),Object.keys(e.cslFieldMap).forEach(function(t){var r=e.cslFieldMap[t];"URL"==t&&o||r.forEach(function(r){var o=e.get(r);o&&(n[t]=o)})});var i=e.get("creators");return i.forEach(function(e){var t=e.creatorType;if(t){var r;r=e.hasOwnProperty("name")?{literal:e.name}:{family:e.lastName,given:e.firstName},n.hasOwnProperty(t)?n[t].push(r):n[t]=[r]}}),Object.keys(e.cslDateMap).forEach(function(t){var r=e.cslDateMap[t],o=e.get(r);o&&(n[t]={raw:o})}),n},Object.keys(n).forEach(function(e){i.prototype[e]=n[e]}),t.exports=i},{"./ItemMaps.js":64,striptags:47}],64:[function(e,t,r){"use strict";var o={};o.fieldMap={itemType:"Item Type",title:"Title",dateAdded:"Date Added",dateModified:"Date Modified",source:"Source",notes:"Notes",tags:"Tags",attachments:"Attachments",related:"Related",url:"URL",rights:"Rights",series:"Series",volume:"Volume",issue:"Issue",edition:"Edition",place:"Place",publisher:"Publisher",pages:"Pages",
ISBN:"ISBN",publicationTitle:"Publication",ISSN:"ISSN",date:"Date",year:"Year",section:"Section",callNumber:"Call Number",archive:"Archive",archiveLocation:"Loc. in Archive",libraryCatalog:"Library Catalog",distributor:"Distributor",extra:"Extra",journalAbbreviation:"Journal Abbr",DOI:"DOI",accessDate:"Accessed",seriesTitle:"Series Title",seriesText:"Series Text",seriesNumber:"Series Number",institution:"Institution",reportType:"Report Type",code:"Code",session:"Session",legislativeBody:"Legislative Body",history:"History",reporter:"Reporter",court:"Court",numberOfVolumes:"# of Volumes",committee:"Committee",assignee:"Assignee",patentNumber:"Patent Number",priorityNumbers:"Priority Numbers",issueDate:"Issue Date",references:"References",legalStatus:"Legal Status",codeNumber:"Code Number",artworkMedium:"Medium",number:"Number",artworkSize:"Artwork Size",repository:"Repository",videoRecordingType:"Recording Type",interviewMedium:"Medium",letterType:"Type",manuscriptType:"Type",mapType:"Type",scale:"Scale",thesisType:"Type",websiteType:"Website Type",audioRecordingType:"Recording Type",label:"Label",presentationType:"Type",meetingName:"Meeting Name",studio:"Studio",runningTime:"Running Time",network:"Network",postType:"Post Type",audioFileType:"File Type",versionNumber:"Version Number",system:"System",company:"Company",conferenceName:"Conference Name",encyclopediaTitle:"Encyclopedia Title",dictionaryTitle:"Dictionary Title",language:"Language",programmingLanguage:"Language",university:"University",abstractNote:"Abstract",websiteTitle:"Website Title",reportNumber:"Report Number",billNumber:"Bill Number",codeVolume:"Code Volume",codePages:"Code Pages",dateDecided:"Date Decided",reporterVolume:"Reporter Volume",firstPage:"First Page",documentNumber:"Document Number",dateEnacted:"Date Enacted",publicLawNumber:"Public Law Number",country:"Country",applicationNumber:"Application Number",forumTitle:"Forum/Listserv Title",episodeNumber:"Episode Number",blogTitle:"Blog Title",caseName:"Case Name",nameOfAct:"Name of Act",subject:"Subject",proceedingsTitle:"Proceedings Title",bookTitle:"Book Title",shortTitle:"Short Title",docketNumber:"Docket Number",numPages:"# of Pages",note:"Note",numChildren:"# of Children",addedBy:"Added By",creator:"Creator"},o.typeMap={note:"Note",attachment:"Attachment",book:"Book",bookSection:"Book Section",journalArticle:"Journal Article",magazineArticle:"Magazine Article",newspaperArticle:"Newspaper Article",thesis:"Thesis",letter:"Letter",manuscript:"Manuscript",interview:"Interview",film:"Film",artwork:"Artwork",webpage:"Web Page",report:"Report",bill:"Bill","case":"Case",hearing:"Hearing",patent:"Patent",statute:"Statute",email:"E-mail",map:"Map",blogPost:"Blog Post",instantMessage:"Instant Message",forumPost:"Forum Post",audioRecording:"Audio Recording",presentation:"Presentation",videoRecording:"Video Recording",tvBroadcast:"TV Broadcast",radioBroadcast:"Radio Broadcast",podcast:"Podcast",computerProgram:"Computer Program",conferencePaper:"Conference Paper",document:"Document",encyclopediaArticle:"Encyclopedia Article",dictionaryEntry:"Dictionary Entry"},o.creatorMap={author:"Author",contributor:"Contributor",editor:"Editor",translator:"Translator",seriesEditor:"Series Editor",interviewee:"Interview With",interviewer:"Interviewer",director:"Director",scriptwriter:"Scriptwriter",producer:"Producer",castMember:"Cast Member",sponsor:"Sponsor",counsel:"Counsel",inventor:"Inventor",attorneyAgent:"Attorney/Agent",recipient:"Recipient",performer:"Performer",composer:"Composer",wordsBy:"Words By",cartographer:"Cartographer",programmer:"Programmer",reviewedAuthor:"Reviewed Author",artist:"Artist",commenter:"Commenter",presenter:"Presenter",guest:"Guest",podcaster:"Podcaster"},o.hideFields=["mimeType","linkMode","charset","md5","mtime","version","key","collections","relations","parentItem","contentType","filename","tags"],o.noEditFields=["accessDate","modified","filename","dateAdded","dateModified"],o.itemTypeImageSrc={note:"note",attachment:"attachment-pdf",attachmentPdf:"attachment-pdf",attachmentWeblink:"attachment-web-link",attachmentSnapshot:"attachment-snapshot",attachmentFile:"attachment-file",attachmentLink:"attachment-link",book:"book",bookSection:"book_open",journalArticle:"page_white_text",magazineArticle:"layout",newspaperArticle:"newspaper",thesis:"report",letter:"email_open",manuscript:"script",interview:"comments",film:"film",artwork:"picture",webpage:"page",report:"report",bill:"page_white","case":"page_white",hearing:"page_white",patent:"page_white",statute:"page_white",email:"email",map:"map",blogPost:"layout",instantMessage:"page_white",forumPost:"page",audioRecording:"ipod",presentation:"page_white",videoRecording:"film",tvBroadcast:"television",radioBroadcast:"transmit",podcast:"ipod_cast",computerProgram:"page_white_code",conferencePaper:"treeitem-conferencePaper",document:"page_white",encyclopediaArticle:"page_white",dictionaryEntry:"page_white"},o.cslNameMap={author:"author",editor:"editor",bookAuthor:"container-author",composer:"composer",interviewer:"interviewer",recipient:"recipient",seriesEditor:"collection-editor",translator:"translator"},o.cslFieldMap={title:["title"],"container-title":["publicationTitle","reporter","code"],"collection-title":["seriesTitle","series"],"collection-number":["seriesNumber"],publisher:["publisher","distributor"],"publisher-place":["place"],authority:["court"],page:["pages"],volume:["volume"],issue:["issue"],"number-of-volumes":["numberOfVolumes"],"number-of-pages":["numPages"],edition:["edition"],versionNumber:["version"],section:["section"],genre:["type","artworkSize"],medium:["medium","system"],archive:["archive"],archive_location:["archiveLocation"],event:["meetingName","conferenceName"],"event-place":["place"],"abstract":["abstractNote"],URL:["url"],DOI:["DOI"],ISBN:["ISBN"],"call-number":["callNumber"],note:["extra"],number:["number"],references:["history"],shortTitle:["shortTitle"],journalAbbreviation:["journalAbbreviation"],language:["language"]},o.cslDateMap={issued:"date",accessed:"accessDate"},o.cslTypeMap={book:"book",bookSection:"chapter",journalArticle:"article-journal",magazineArticle:"article-magazine",newspaperArticle:"article-newspaper",thesis:"thesis",encyclopediaArticle:"entry-encyclopedia",dictionaryEntry:"entry-dictionary",conferencePaper:"paper-conference",letter:"personal_communication",manuscript:"manuscript",interview:"interview",film:"motion_picture",artwork:"graphic",webpage:"webpage",report:"report",bill:"bill","case":"legal_case",hearing:"bill",patent:"patent",statute:"bill",email:"personal_communication",map:"map",blogPost:"webpage",instantMessage:"personal_communication",forumPost:"webpage",audioRecording:"song",presentation:"speech",videoRecording:"motion_picture",tvBroadcast:"broadcast",radioBroadcast:"broadcast",podcast:"song",computerProgram:"book"},o.citePaperJournalArticleURL=!1,t.exports=o},{}],65:[function(e,t,r){"use strict";t.exports=function(e){this.instance="Zotero.Items",this.itemsVersion=0,this.syncState={earliestVersion:null,latestVersion:null},this.itemObjects={},this.objectMap=this.itemObjects,this.objectArray=[],this.unsyncedItemKeys=[],e&&this.addItemsFromJson(e)},t.exports.prototype=new Zotero.Container,t.exports.prototype.getItem=function(e){return this.getObject(e)},t.exports.prototype.getItems=function(e){return this.getObjects(e)},t.exports.prototype.addItem=function(e){return this.addObject(e),this},t.exports.prototype.addItemsFromJson=function(e){Z.debug("addItemsFromJson",3);var t=this,r=e,o=[];return Z.debug("looping"),r.forEach(function(e){Z.debug("creating new Item");var r=new Zotero.Item(e);t.addItem(r),o.push(r)}),o},t.exports.prototype.removeLocalItem=function(e){return this.removeObject(e)},t.exports.prototype.removeLocalItems=function(e){return this.removeObjects(e)},t.exports.prototype.deleteItem=function(e){Z.debug("Zotero.Items.deleteItem",3);var t,r=this;if(!e)return!1;e=r.extractKey(e),t=r.getItem(e);var o={target:"item",libraryType:r.owningLibrary.libraryType,libraryID:r.owningLibrary.libraryID,itemKey:t.key},n={url:Zotero.ajax.apiRequestString(o),type:"DELETE",headers:{"If-Unmodified-Since-Version":t.get("version")}};return Zotero.net.ajaxRequest(n)},t.exports.prototype.deleteItems=function(e,t){Z.debug("Zotero.Items.deleteItems",3);var r,o=this,n=[];t||0===o.itemsVersion||(t=o.itemsVersion);var i;for(r=0;r<e.length;r++)e[r]&&(i=o.extractKey(e[r]),i&&n.push(i));var a=o.chunkObjectsArray(n),s=[];for(r=0;r<a.length;r++){var u=a[r].join(","),c={target:"items",libraryType:o.owningLibrary.libraryType,libraryID:o.owningLibrary.libraryID,itemKey:u},l={url:c,type:"DELETE"};s.push(l)}return Zotero.net.queueRequest(s)},t.exports.prototype.trashItems=function(e){var t,r=this;for(t=0;t<e.length;t++){var o=e[t];o.set("deleted",1)}return r.writeItems(e)},t.exports.prototype.untrashItems=function(e){var t,r=this;for(t=0;t<e.length;t++){var o=e[t];o.set("deleted",0)}return r.writeItems(e)},t.exports.prototype.findItems=function(e){var t=this,r=[];return Object.keys(t.itemObjects).forEach(function(o){var n=n.itemObjects[o];e.collectionKey&&-1===n.apiObj.collections.indexOf(e.collectionKey)||r.push(t.itemObjects[o])}),r},t.exports.prototype.atomizeItems=function(e){for(var t,r=[],o=0;o<e.length;o++){t=e[o];var n=t.get("key");if(""===n||null===n){var i=Zotero.utils.getKey();t.set("key",i),t.set("version",0)}if(r.push(t),t.hasOwnProperty("notes")&&t.notes.length>0){for(var a=0;a<t.notes.length;a++)t.notes[a].set("parentItem",t.get("key"));r=r.concat(t.notes)}if(t.hasOwnProperty("attachments")&&t.attachments.length>0){for(var s=0;s<t.attachments.length;s++)t.attachments[s].set("parentItem",t.get("key"));r=r.concat(t.attachments)}}return r},t.exports.prototype.writeItems=function(e){var t,r=this,o=r.owningLibrary,n=r.atomizeItems(e),i={target:"items",libraryType:r.owningLibrary.libraryType,libraryID:r.owningLibrary.libraryID},a=Zotero.ajax.apiRequestString(i),s=r.chunkObjectsArray(n),u=r.rawChunks(s),c=function(e){return Z.debug("writeItem successCallback",3),r.updateObjectsFromWriteResponse(this.writeChunk,e),Zotero.config.useIndexedDB&&this.library.idbLibrary.updateItems(this.writeChunk),Zotero.trigger("itemsChanged",{library:this.library}),e.returnItems=this.writeChunk,e};Z.debug("items.itemsVersion: "+r.itemsVersion,3),Z.debug("items.libraryVersion: "+r.libraryVersion,3);var l=[];for(t=0;t<s.length;t++){var p={writeChunk:s[t],library:o},d=JSON.stringify(u[t]);l.push({url:a,type:"POST",data:d,processData:!1,success:c.bind(p)})}return o.sequentialRequests(l).then(function(e){return Z.debug("Done with writeItems sequentialRequests promise",3),e})}},{}],66:[function(e,t,r){"use strict";var o=function(e,t,r,o){Z.debug("Zotero.Library constructor",3),Z.debug("Library Constructor: "+e+" "+t+" ",3);var n=this;if(Z.debug(r,4),n.instance="Zotero.Library",n.libraryVersion=0,n.syncState={earliestVersion:null,latestVersion:null},n._apiKey=o||"",Zotero.config.librarySettings?n.libraryBaseWebsiteUrl=Zotero.config.librarySettings.libraryPathString:(n.libraryBaseWebsiteUrl=Zotero.config.baseWebsiteUrl,"group"==e&&(n.libraryBaseWebsiteUrl+="groups/"),r?this.libraryBaseWebsiteUrl+=r+"/items":Z.warn("no libraryUrlIdentifier specified")),n.items=new Zotero.Items,n.items.owningLibrary=n,n.itemKeys=[],n.collections=new Zotero.Collections,n.collections.libraryUrlIdentifier=n.libraryUrlIdentifier,n.collections.owningLibrary=n,n.tags=new Zotero.Tags,n.searches=new Zotero.Searches,n.searches.owningLibrary=n,n.groups=new Zotero.Groups,n.groups.owningLibrary=n,n.deleted=new Zotero.Deleted,n.deleted.owningLibrary=n,!e)return void Z.warn("No type specified for library");n.type=e,n.libraryType=e,n.libraryID=t,n.libraryString=Zotero.utils.libraryString(n.libraryType,n.libraryID),n.libraryUrlIdentifier=r,n.preferences=new Zotero.Preferences(Zotero.store,n.libraryString);var i=navigator.userAgent.indexOf("Chrome")>-1,a=(navigator.userAgent.indexOf("MSIE")>-1,navigator.userAgent.indexOf("Firefox")>-1,navigator.userAgent.indexOf("Safari")>-1),s=navigator.userAgent.toLowerCase().indexOf("op")>-1;if(i&&a&&(a=!1),i&&s&&(i=!1),a&&(Zotero.config.useIndexedDB=!1,Zotero.warn("Safari detected; disabling indexedDB")),Zotero.config.useIndexedDB===!0){Z.debug("Library Constructor: indexedDB init",3);var u=new Zotero.Idb.Library(n.libraryString);u.owningLibrary=this,n.idbLibrary=u,u.init().then(function(){if(Z.debug("Library Constructor: idbInitD Done",3),Zotero.config.preloadCachedLibrary===!0){Z.debug("Library Constructor: preloading cached library",3);var e=n.loadIndexedDBCache();e.then(function(){Z.debug("Library Constructor: Library.items.itemsVersion: "+n.items.itemsVersion,3),Z.debug("Library Constructor: Library.collections.collectionsVersion: "+n.collections.collectionsVersion,3),Z.debug("Library Constructor: Library.tags.tagsVersion: "+n.tags.tagsVersion,3),Z.debug("Library Constructor: Triggering cachedDataLoaded",3),n.trigger("cachedDataLoaded")},function(e){throw Z.error("Error loading cached library"),Z.error(e),new Error("Error loading cached library")})}else n.trigger("cachedDataLoaded")},function(){Zotero.config.useIndexedDB=!1,n.trigger("indexedDBError"),n.trigger("cachedDataLoaded"),Z.error("Error initializing indexedDB. Promise rejected.")})}n.dirty=!1,n.tagsChanged=function(){},n.collectionsChanged=function(){},n.itemsChanged=function(){}};o.prototype.sortableColumns=["title","creator","itemType","date","year","publisher","publicationTitle","journalAbbreviation","language","accessDate","libraryCatalog","callNumber","rights","dateAdded","dateModified","addedBy"],o.prototype.displayableColumns=["title","creator","itemType","date","year","publisher","publicationTitle","journalAbbreviation","language","accessDate","libraryCatalog","callNumber","rights","dateAdded","dateModified","numChildren","addedBy"],o.prototype.groupOnlyColumns=["addedBy"],o.prototype.comparer=function(){return Intl?(new Intl.Collator).compare:function(e,t){return e.toLocaleLowerCase()==t.toLocaleLowerCase()?0:e.toLocaleLowerCase()<t.toLocaleLowerCase()?-1:1}},o.prototype.ajaxRequest=function(e,t,r){Z.debug("Library.ajaxRequest",3),t||(t="GET"),r||(r={});var o={url:e,type:t};return o=Z.extend({},o,r),Z.debug(o,3),Zotero.net.queueRequest(o)},o.prototype.sequentialRequests=function(e){Z.debug("Zotero.Library.sequentialRequests",3);return Zotero.net.queueRequest(e)},o.prototype.websiteUrl=function(e){Z.debug("Zotero.library.websiteUrl",3),Z.debug(e,4);var t=this,r=[];Object.keys(e).forEach(function(t){var o=e[t];""!==o&&r.push(t+"/"+o)}),r.sort(),Z.debug(r,4);var o=r.join("/");return t.libraryBaseWebsiteUrl+"/"+o},o.prototype.synchronize=function(){},o.prototype.loadUpdatedItems=function(){Z.debug("Zotero.Library.loadUpdatedItems",3);var e=this,t=e.libraryVersion?e.libraryVersion:e.items.itemsVersion;return Promise.resolve(e.updatedVersions("items",t)).then(function(t){Z.debug("itemVersions resolved",3),Z.debug("items Last-Modified-Version: "+t.lastModifiedVersion,3),e.items.updateSyncState(t.lastModifiedVersion);var r=t.data;e.itemVersions=r;var o=[];return Object.keys(r).forEach(function(t){var n=r[t],i=e.items.getItem(t);i&&i.apiObj.key==n||o.push(t)}),e.loadItemsFromKeys(o)}).then(function(t){Z.debug("loadItemsFromKeys resolved",3),e.items.updateSyncedVersion();var r=Zotero.state.getUrlVars();if(e.buildItemDisplayView(r),Zotero.config.useIndexedDB){e.idbLibrary.updateItems(e.items.objectArray)}})},o.prototype.loadUpdatedCollections=function(){Z.debug("Zotero.Library.loadUpdatedCollections",3);var e=this;Z.debug("library.collections.collectionsVersion:"+e.collections.collectionsVersion);var t=e.libraryVersion?e.libraryVersion:e.collections.collectionsVersion;return e.updatedVersions("collections",t).then(function(t){Z.debug("collectionVersions finished",3),Z.debug("Collections Last-Modified-Version: "+t.lastModifiedVersion,3),e.collections.updateSyncState(t.lastModifiedVersion);var r=t.data;e.collectionVersions=r;var o=[];return Object.keys(r).forEach(function(t){var n=r[t],i=e.collections.getCollection(t);i&&i.apiObj.version==n||o.push(t)}),0===o.length?(Z.debug("No collectionKeys need updating. resolving",3),t):(Z.debug("fetching collections by key",3),e.loadCollectionsFromKeys(o).then(function(){var t=e.collections;t.initSecondaryData(),Z.debug("All updated collections loaded",3),e.collections.updateSyncedVersion();Zotero.state.getUrlVars();return Z.debug("loadUpdatedCollections complete - saving collections to cache before resolving",3),Z.debug("collectionsVersion: "+e.collections.collectionsVersion,3),Zotero.config.useIndexedDB?e.idbLibrary.updateCollections(t.collectionsArray):void 0}))}).then(function(){return Z.debug("done getting collection data. requesting deleted data",3),e.getDeleted(e.libraryVersion)}).then(function(t){Z.debug("got deleted collections data: removing local copies",3),Z.debug(e.deleted),e.deleted.deletedData.collections&&e.deleted.deletedData.collections.length>0&&e.collections.removeLocalCollections(e.deleted.deletedData.collections)})},o.prototype.loadUpdatedTags=function(){Z.debug("Zotero.Library.loadUpdatedTags",3);var e=this;return Z.debug("tagsVersion: "+e.tags.tagsVersion,3),Promise.resolve(e.loadAllTags({since:e.tags.tagsVersion})).then(function(){return Z.debug("done getting tags, request deleted tags data",3),e.getDeleted(e.libraryVersion)}).then(function(t){if(Z.debug("got deleted tags data"),e.deleted.deletedData.tags&&e.deleted.deletedData.tags.length>0&&e.tags.removeTags(e.deleted.deletedData.tags),Zotero.config.useIndexedDB){Z.debug("saving updated tags to IDB",3);e.idbLibrary.updateTags(e.tags.tagsArray)}})},o.prototype.getDeleted=function(e){Z.debug("Zotero.Library.getDeleted",3);var t=this,r={target:"deleted",libraryType:t.libraryType,libraryID:t.libraryID,since:e};return t.deleted.pending?(Z.debug("getDeleted resolving with previously pending promise"),Promise.resolve(t.deleted.pendingPromise)):(Z.debug("version:"+e),Z.debug("sinceVersion:"+t.deleted.sinceVersion),Z.debug("untilVersion:"+t.deleted.untilVersion),t.deleted.untilVersion&&e>=t.deleted.sinceVersion?(Z.debug("deletedVersion matches requested: immediately resolving"),Promise.resolve(t.deleted.deletedData)):(t.deleted.pending=!0,t.deleted.pendingPromise=t.ajaxRequest(r).then(function(r){Z.debug("got deleted response"),t.deleted.deletedData=r.data,Z.debug("Deleted Last-Modified-Version:"+r.lastModifiedVersion,3),t.deleted.untilVersion=r.lastModifiedVersion,t.deleted.sinceVersion=e}).then(function(e){Z.debug("cleaning up deleted pending"),t.deleted.pending=!1,t.deleted.pendingPromise=!1}),t.deleted.pendingPromise))},o.prototype.processDeletions=function(e){var t=this;t.collections.processDeletions(e.collections),t.items.processDeletions(e.items)},o.prototype.loadFullBib=function(e,t){var r=this,o=e.join(","),n={target:"items",libraryType:r.libraryType,libraryID:r.libraryID,itemKey:o,format:"bib",linkwrap:"1"};1==e.length&&(n.target="item"),t&&(n.style=t);var i=r.ajaxRequest(n).then(function(e){return e.data});return i},o.prototype.loadItemBib=function(e,t){Z.debug("Zotero.Library.loadItemBib",3);var r=this,o={target:"item",libraryType:r.libraryType,libraryID:r.libraryID,itemKey:e,content:"bib"};t&&(o.style=t);var n=r.ajaxRequest(o).then(function(e){var t=new Zotero.Item(e.data),r=t.apiObj.bib;return r});return n},o.prototype.loadSettings=function(){Z.debug("Zotero.Library.loadSettings",3);var e=this,t={target:"settings",libraryType:e.libraryType,libraryID:e.libraryID};return e.ajaxRequest(t).then(function(t){var r;if(r="string"==typeof t.data?JSON.parse(t.data):t.data,e.preferences.setPref("settings",r),r.tagColors){var o=r.tagColors.value;e.preferences.setPref("tagColors",o)}return e.trigger("settingsLoaded"),e.preferences})},o.prototype.matchColoredTags=function(e){var t,r=this,o=r.preferences.getPref("tagColors");if(!o)return[];var n={};for(t=0;t<o.length;t++)n[o[t].name.toLowerCase()]=o[t].color;var i=[];for(t=0;t<e.length;t++)n.hasOwnProperty(e[t])&&i.push(n[e[t]]);return i},o.prototype.sendToLibrary=function(e,t){for(var r=[],o=0;o<e.length;o++){var n=e[o],i=n.emptyJsonItem();i.data=Z.extend({},e[o].apiObj.data),i.data.key="",i.data.version=0,i.data.collections=[],delete i.data.dateModified,delete i.data.dateAdded;var a=new Zotero.Item(i);a.pristine=Z.extend({},a.apiObj),a.initSecondaryData(),a.apiObj.data.relations||(a.apiObj.data.relations={}),a.apiObj.data.relations["owl:sameAs"]=Zotero.url.relationUrl(n.owningLibrary.libraryType,n.owningLibrary.libraryID,n.key),r.push(a)}return t.items.writeItems(r)},o.prototype.updatedVersions=function(){var e=arguments.length<=0||void 0===arguments[0]?"items":arguments[0],t=arguments.length<=1||void 0===arguments[1]?this.libraryVersion:arguments[1];Z.debug("Library.updatedVersions",3);var r=this,o={target:e,format:"versions",libraryType:r.libraryType,libraryID:r.libraryID,since:t};return r.ajaxRequest(o)},o.prototype.loadItemsFromKeys=function(e){Zotero.debug("Zotero.Library.loadItemsFromKeys",3);var t=this;return t.loadFromKeys(e,"items")},o.prototype.loadCollectionsFromKeys=function(e){Zotero.debug("Zotero.Library.loadCollectionsFromKeys",3);var t=this;return t.loadFromKeys(e,"collections")},o.prototype.loadSeachesFromKeys=function(e){Zotero.debug("Zotero.Library.loadSearchesFromKeys",3);var t=this;return t.loadFromKeys(e,"searches")},o.prototype.loadFromKeys=function(e,t){Zotero.debug("Zotero.Library.loadFromKeys",3),t||(t="items");for(var r=this,o=[];e.length>0;)o.push(e.splice(0,50));var n=[];o.forEach(function(e){var o=e.join(",");switch(t){case"items":n.push({url:{target:"items",targetModifier:null,itemKey:o,limit:50,libraryType:r.libraryType,libraryID:r.libraryID},type:"GET",success:r.processLoadedItems.bind(r)});break;case"collections":n.push({url:{target:"collections",targetModifier:null,collectionKey:o,limit:50,libraryType:r.libraryType,libraryID:r.libraryID},type:"GET",success:r.processLoadedCollections.bind(r)});break;case"searches":n.push({url:{target:"searches",targetModifier:null,searchKey:o,limit:50,libraryType:r.libraryType,libraryID:r.libraryID},type:"GET"})}});for(var i=[],a=0;a<n.length;a++)i.push(Zotero.net.queueRequest(n[a]));return Promise.all(i)},o.prototype.buildItemDisplayView=function(e){Z.debug("Zotero.Library.buildItemDisplayView",3),Z.debug(e,4);var t=this;if(!t.idbLibrary.db)return Promise.resolve([]);var r=[];e.collectionKey?"trash"==e.collectionKey?r.push(t.idbLibrary.filterItems("deleted",1)):r.push(t.idbLibrary.filterItems("collectionKeys",e.collectionKey)):r.push(t.idbLibrary.getOrderedItemKeys("title"));var o=e.tag||[];"string"==typeof o&&(o=[o]);for(var n=0;n<o.length;n++)Z.debug("adding selected tag filter",3),r.push(t.idbLibrary.filterItems("itemTagStrings",o[n]));return Promise.all(r).then(function(r){var o;for(o=0;o<r.length;o++)Z.debug("result from filterPromise: "+r[o].length,3),Z.debug(r[o],3);var n=t.idbLibrary.intersectAll(r),i=t.items.getItems(n);Z.debug("All filters applied - Down to "+i.length+" items displayed",3),Z.debug("remove child items and, if not viewing trash, deleted items",3);var a=[];for(o=0;o<i.length;o++)i[o].apiObj.data.parentItem||"trash"!=e.collectionKey&&i[o].apiObj.deleted||a.push(i[o]);var s=e.order||"title",u=e.sort||"asc";Z.debug("Sorting by "+s+" - "+u,3);var c=Zotero.Library.prototype.comparer();return a.sort(function(e,t){var r=e.get(s),o=t.get(s);return c(r,o)}),"desc"==u&&(Z.debug("sort is desc - reversing array",4),a.reverse()),Z.debug("triggering publishing displayedItemsUpdated",3),t.trigger("displayedItemsUpdated"),a})},o.prototype.trigger=function(e,t){var r=this;Zotero.trigger(e,t,r.libraryString)},o.prototype.listen=function(e,t,r){var o=this,n=o.libraryString;Zotero.listen(e,t,r,n)},o.prototype.processLoadedCollections=function(e){Z.debug("processLoadedCollections",3);var t=this;Z.debug("adding collections to library.collections");for(var r=t.collections.addCollectionsFromJson(e.data),o=0;o<r.length;o++)r[o].associateWithLibrary(t);return t.collections.updateSyncState(e.lastModifiedVersion),Zotero.trigger("loadedCollectionsProcessed",{library:t,collectionsAdded:r}),e},o.prototype.addCollection=function(e,t){Z.debug("Zotero.Library.addCollection",3);var r=this,o=new Zotero.Collection;return o.associateWithLibrary(r),o.set("name",e),o.set("parentCollection",t),r.collections.writeCollections([o])},o.prototype.fetchItemKeys=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];Z.debug("Zotero.Library.fetchItemKeys",3);var t=this,r=Z.extend(!0,{target:"items",libraryType:this.libraryType,libraryID:this.libraryID,format:"keys"},e);return t.ajaxRequest(r)},o.prototype.getTrashKeys=function(){Z.debug("Zotero.Library.getTrashKeys",3);var e=this,t={target:"items",libraryType:e.libraryType,libraryID:e.libraryID,format:"keys",collectionKey:"trash"};return e.ajaxRequest(t)},o.prototype.emptyTrash=function(){Z.debug("Zotero.Library.emptyTrash",3);var e=this;return e.getTrashKeys().then(function(t){var r=t.data.split("\n");return e.items.deleteItems(r,t.lastModifiedVersion)})},o.prototype.loadItemKeys=function(e){Z.debug("Zotero.Library.loadItemKeys",3);var t=this;return this.fetchItemKeys(e).then(function(e){Z.debug("loadItemKeys proxied callback",3);var r=e.data.split(/[\s]+/);t.itemKeys=r})},o.prototype.loadItems=function(e){Z.debug("Zotero.Library.loadItems",3);var t=this;e||(e={});var r={target:"items",targetModifier:"top",start:0,limit:25,order:Zotero.config.defaultSortColumn,sort:Zotero.config.defaultSortOrder},o=Z.extend({},r,e),n=Z.extend({target:"items",libraryType:t.libraryType,libraryID:t.libraryID},o),i=Zotero.ajax.apiRequestString(n);return t.ajaxRequest(i).then(function(e){Z.debug("loadItems proxied callback",3);var r=t.items,o=r.addItemsFromJson(e.data);Z.debug("Looping over loadedItemsArray");for(var n=0;n<o.length;n++)o[n].associateWithLibrary(t);return e.loadedItems=o,Zotero.trigger("itemsChanged",{library:t}),e})},o.prototype.loadPublications=function(e){Z.debug("Zotero.Library.loadPublications",3);var t=this;e||(e={});var r={target:"publications",start:0,limit:50,order:Zotero.config.defaultSortColumn,sort:Zotero.config.defaultSortOrder,include:"bib"},o=Z.extend({},r,e),n=Z.extend({target:"publications",libraryType:t.libraryType,libraryID:t.libraryID},o),i=Zotero.ajax.apiRequestString(n);return t.ajaxRequest(i).then(function(e){Z.debug("loadPublications proxied callback",3);var t=[],r=e.data;return r.forEach(function(e){var r=new Zotero.Item(e);t.push(r)}),e.publicationItems=t,e})},o.prototype.processLoadedItems=function(e){Z.debug("processLoadedItems",3);for(var t=this,r=t.items,o=r.addItemsFromJson(e.data),n=0;n<o.length;n++)o[n].associateWithLibrary(t);return t.items.updateSyncState(e.lastModifiedVersion),Zotero.trigger("itemsChanged",{library:t,loadedItems:o}),e},o.prototype.loadItem=function(e){Z.debug("Zotero.Library.loadItem",3);var t=this;if(!r)var r={};var o={target:"item",libraryType:t.libraryType,libraryID:t.libraryID,itemKey:e};return t.ajaxRequest(o).then(function(e){Z.debug("Got loadItem response");var r=new Zotero.Item(e.data);return r.owningLibrary=t,t.items.itemObjects[r.key]=r,Zotero.trigger("itemsChanged",{library:t}),r},function(e){Z.debug("Error loading Item")})},o.prototype.trashItem=function(e){var t=this;return t.items.trashItems([t.items.getItem(e)])},o.prototype.untrashItem=function(e){if(Z.debug("Zotero.Library.untrashItem",3),!e)return!1;var t=this.items.getItem(e);return t.apiObj.deleted=0,t.writeItem()},o.prototype.deleteItem=function(e){Z.debug("Zotero.Library.deleteItem",3);var t=this;return t.items.deleteItem(e)},o.prototype.deleteItems=function(e){Z.debug("Zotero.Library.deleteItems",3);var t=this;return t.items.deleteItems(e)},o.prototype.addNote=function(e,t){Z.debug("Zotero.Library.prototype.addNote",3);var r=this,o={target:"children",libraryType:r.libraryType,libraryID:r.libraryID,itemKey:e},n=Zotero.ajax.apiRequestString(o);this.items.getItem(e);return r.ajaxRequest(n,"POST",{processData:!1})},o.prototype.fetchGlobalItems=function(e){Z.debug("Zotero.Library.fetchGlobalItems",3);var t=this;e||(e={});var r={target:"items",start:0,limit:25},o=Z.extend({},r,e),n=Z.extend({target:"items",libraryType:""},o),i=Zotero.ajax.apiRequestString(n);return t.ajaxRequest(i,"GET",{dataType:"json"}).then(function(e){return Z.debug("globalItems callback",3),e.data})},o.prototype.fetchGlobalItem=function(e){Z.debug("Zotero.Library.fetchGlobalItem",3),Z.debug(e);var t=this,r={target:"item"},o=Z.extend({},r),n=Z.extend({target:"item",libraryType:"",itemKey:e},o),i=Zotero.ajax.apiRequestString(n);return t.ajaxRequest(i,"GET",{dataType:"json"}).then(function(e){return Z.debug("globalItem callback",3),e.data})},o.prototype.fetchTags=function(e){Z.debug("Zotero.Library.fetchTags",3);var t={target:"tags",order:"title",sort:"asc",limit:100},r=Z.extend({},t,e),o=Z.extend({target:"tags",libraryType:this.libraryType,libraryID:this.libraryID},r);return Zotero.ajaxRequest(o)},o.prototype.loadTags=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];Z.debug("Zotero.Library.loadTags",3);var t=this;return e.showAutomaticTags&&e.collectionKey&&delete e.collectionKey,t.tags.displayTagsArray=[],t.fetchTags(e).then(function(e){Z.debug("loadTags proxied callback",3);var r=e.lastModifiedVersion;t.tags.updateSyncState(r);t.tags.addTagsFromJson(e.data);return t.tags.updateTagsVersion(r),t.tags.rebuildTagsArray(),e.parsedLinks.hasOwnProperty("next")?(t.tags.hasNextLink=!0,t.tags.nextLink=e.parsedLinks.next):(t.tags.hasNextLink=!1,t.tags.nextLink=null),t.trigger("tagsChanged",{library:t}),t.tags})},o.prototype.loadAllTags=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];Z.debug("Zotero.Library.loadAllTags",3);var t=this,r={target:"tags",order:"title",sort:"asc",limit:100,libraryType:t.libraryType,libraryID:t.libraryID},n=Z.extend({},r,e),i=Z.extend({},n),a=Zotero.ajax.apiRequestString(i),s=t.tags,u=(Z.extend({},r,s.loadedConfig),s.loadedRequestUrl);return Z.debug("requestUrl: "+a,4),Z.debug("loadedConfigRequestUrl: "+u,4),new Promise(function(r,n){var s=function u(r){Z.debug("loadAllTags continueLoadingCallback",3);var n=Zotero.Tags.prototype.plainTagsList(r.tagsArray);if(n.sort(o.prototype.comparer()),r.plainList=n,r.hasNextLink){Z.debug("still has next link.",3),r.tagsArray.sort(Zotero.Tag.prototype.tagComparer()),n=Zotero.Tags.prototype.plainTagsList(r.tagsArray),n.sort(o.prototype.comparer()),r.plainList=n;var i=r.nextLink,s=Zotero.utils.parseQuery(Zotero.utils.querystring(i)),c=Z.extend({},e);return c.start=s.start,c.limit=s.limit,t.loadTags(c).then(u)}Z.debug("no next in tags link",3),r.updateSyncedVersion(),r.tagsArray.sort(Zotero.Tag.prototype.tagComparer()),n=Zotero.Tags.prototype.plainTagsList(r.tagsArray),n.sort(o.prototype.comparer()),r.plainList=n,Z.debug("resolving loadTags deferred",3),t.tagsLoaded=!0,t.tags.loaded=!0,r.loadedConfig=e,r.loadedRequestUrl=a;for(var l=0;l<t.tags.tagsArray.length;l++)r.tagsArray[l].apiObj.version=r.tagsVersion;return t.trigger("tagsChanged",{library:t}),r};r(t.loadTags(i).then(s))})},o.prototype.loadIndexedDBCache=function(){Zotero.debug("Zotero.Library.loadIndexedDBCache",3);var e=this,t=e.idbLibrary.getAllItems(),r=e.idbLibrary.getAllCollections(),o=e.idbLibrary.getAllTags();return t.then(function(t){Z.debug("loadIndexedDBCache itemsD done",3);for(var r=0,o=0;o<t.length;o++){var n=new Zotero.Item(t[o]);e.items.addItem(n),n.version>r&&(r=n.version)}e.items.itemsVersion=r,e.items.loaded=!0,Z.debug("Done loading indexedDB items promise into library",3)}),r.then(function(t){Z.debug("loadIndexedDBCache collectionsD done",3);for(var r=0,o=0;o<t.length;o++){var n=new Zotero.Collection(t[o]);e.collections.addCollection(n),n.version>r&&(r=n.version)}e.collections.collectionsVersion=r,e.collections.initSecondaryData(),e.collections.loaded=!0}),o.then(function(t){Z.debug("loadIndexedDBCache tagsD done",3),Z.debug(t);for(var r=0,o=0,n=0;n<t.length;n++){var i=new Zotero.Tag(t[n]);e.tags.addTag(i),
t[n].version>r&&(r=t[n].version)}o=r,e.tags.tagsVersion=o,e.tags.loaded=!0}),Promise.all([t,r,o])},o.prototype.saveIndexedDB=function(){var e=this,t=e.idbLibrary.updateItems(e.items.itemsArray),r=e.idbLibrary.updateCollections(e.collections.collectionsArray),o=e.idbLibrary.updateTags(e.tags.tagsArray);return Promise.all([t,r,o])},t.exports=o},{}],67:[function(e,t,r){"use strict";var o=e("./ItemMaps.js");t.exports.fieldMap=o.fieldMap,t.exports.typeMap=o.typeMap,t.exports.creatorMap=o.creatorMap},{"./ItemMaps.js":64}],68:[function(e,t,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},n=e("deferred-js");t.exports=function(){this.deferredQueue=[],this.numRunning=0,this.numConcurrent=3,this.backingOff=!1},t.exports.prototype.queueDeferred=function(){var e=this,t=new n;return e.deferredQueue.push(t),Promise.resolve(t)},t.exports.prototype.queueRequest=function(e){Z.debug("Zotero.Net.queueRequest",3);var t,r=this;return t=Array.isArray(e)?r.queueDeferred().then(function(){return Z.debug("running sequential after queued deferred resolved",4),r.runSequential(e)}).then(function(e){return Z.debug("runSequential done",3),r.queuedRequestDone(),e}):r.queueDeferred().then(function(){return Z.debug("running concurrent after queued deferred resolved",4),r.runConcurrent(e)}).then(function(e){return Z.debug("done with queuedRequest"),r.queuedRequestDone(),e}),r.runNext(),t["catch"](function(e){Z.error("Error before leaving Zotero.Net"),Z.error(e)})},t.exports.prototype.runConcurrent=function(e){return Z.debug("Zotero.Net.runConcurrent",3),this.ajaxRequest(e).then(function(e){return Z.debug("done with runConcurrent request"),e})},t.exports.prototype.runSequential=function(e){Z.debug("Zotero.Net.runSequential",3);for(var t=this,r=[],o=Promise.resolve(),n=0;n<e.length;n++){var i=e[n];o=o.then(function(){var e=t.ajaxRequest(i).then(function(e){Z.debug("pushing sequential response into result array"),r.push(e)});return e})}return o.then(function(){return Z.debug("done with sequential aggregator promise - returning responses"),r})},t.exports.prototype.individualRequestDone=function(e){Z.debug("Zotero.Net.individualRequestDone",3);var t=this,r=t.checkDelay(e);if(r>0){var o=1e3*r;t.backingOff=!0;var n=Date.now()+o;n>t.waitingExpires&&(t.waitingExpires=n),setTimeout(t.runNext,o)}return e},t.exports.prototype.queuedRequestDone=function(e){Z.debug("queuedRequestDone",3);var t=this;return t.numRunning--,t.runNext(),e},t.exports.prototype.runNext=function(){Z.debug("Zotero.Net.runNext",3);var e=this,t=Date.now();if(e.backingOff&&e.waitingExpires>t-100){Z.debug("currently backing off",3);var r=e.waitingExpires-t;return void setTimeout(e.runNext,r)}for(e.backingOff&&e.waitingExpires<=t-100&&(e.backingOff=!1),Z.debug(e.numRunning+"/"+e.numConcurrent+" Running. "+e.deferredQueue.length+" queued.",3);e.deferredQueue.length>0&&e.numRunning<e.numConcurrent;){e.numRunning++;var o=e.deferredQueue.shift();o.resolve(),Z.debug(e.numRunning+"/"+e.numConcurrent+" Running. "+e.deferredQueue.length+" queued.",3)}},t.exports.prototype.checkDelay=function(e){Z.debug("Zotero.Net.checkDelay"),Z.debug(e);var t=this,r=0;if(Array.isArray(e))for(var o=0;o<e.length;o++){var n=t.checkDelay(e[o]);n>r&&(r=n)}else 429==e.status?r=e.retryAfter:e.backoff&&(r=e.backoff);return r},t.exports.prototype.ajaxRequest=function(e){Z.debug("Zotero.Net.ajaxRequest",3);var t=this,r={type:"GET",headers:{"Zotero-API-Version":Zotero.config.apiVersion,"Content-Type":"application/json"},success:function(e){return e},error:function(e){return Z.error("ajaxRequest rejected:"+e.jqxhr.status+" - "+e.jqxhr.responseText),e}},n=Z.extend({},r.headers,e.headers),i=Z.extend({},r,e);if(i.headers=n,"object"==o(i.url)&&(i.url=Zotero.ajax.apiRequestString(i.url)),i.url=Zotero.ajax.proxyWrapper(i.url,i.type),!i.url)throw"No url specified in Zotero.Net.ajaxRequest";i.zsuccess=i.success,i.zerror=i.error,delete i.success,delete i.error,Z.debug("AJAX config"),Z.debug(i);var a=new Promise(function(e,r){t.ajax(i).then(function(t){var r;switch(t.responseType){case"json":case"":try{r=JSON.parse(t.response)}catch(o){r=t.response}break;case"text":default:r=t.response}var n=new Zotero.ApiResponse({jqxhr:t,data:r,textStatus:t.responseText});e(n)},function(e){var t=new Zotero.ApiResponse({jqxhr:e,textStatus:e.responseText,isError:!0});r(t)})}).then(t.individualRequestDone.bind(t)).then(function(e){if(e.isError)throw Z.error("re-throwing ApiResponse that was a rejection"),e;return e}).then(i.zsuccess,i.zerror);return a},t.exports.prototype.ajax=function(e){e=Zotero.extend({type:"GET"},e);var t=new Promise(function(t,r){var o=new XMLHttpRequest,n=e.url;o.open(e.type,n),e.headers&&Object.keys(e.headers).forEach(function(t){var r=e.headers[t];o.setRequestHeader(t,r)}),o.send(e.data),o.onload=function(){Z.debug("XMLHttpRequest done"),Z.debug(o),o.status>=200&&o.status<300?(Z.debug("200-300 response: resolving Net.ajax promise"),t(o)):(Z.debug("not 200-300 response: rejecting Net.ajax promise"),r(o))},o.onerror=function(){r(o)}});return t}},{"deferred-js":4}],69:[function(e,t,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};t.exports=function(e,t){this.store=e,this.idString=t,this.preferencesObject={},this.defaults={debug_level:3,debug_log:!0,debug_mock:!1,listDisplayedFields:["title","creator","dateModified"],showAutomaticTags:!1,itemsPerPage:25,order:"title",title:"asc"},this.load()},t.exports.prototype.setPref=function(e,t){var r=this;r.preferencesObject[e]=t,r.persist()},t.exports.prototype.setPrefs=function(e){var t=this;if("object"!=("undefined"==typeof e?"undefined":o(e)))throw new Error("Preferences must be an object");t.preferencesObject=e,t.persist()},t.exports.prototype.getPref=function(e){var t=this;return t.preferencesObject[e]?t.preferencesObject[e]:t.defaults[e]?t.defaults[e]:null},t.exports.prototype.getPrefs=function(){var e=this;return e.preferencesObject},t.exports.prototype.persist=function(){var e=this,t="preferences_"+e.idString;e.store[t]=JSON.stringify(e.preferencesObject)},t.exports.prototype.load=function(){var e=this,t="preferences_"+e.idString,r=e.store[t];r?e.preferencesObject=JSON.parse(r):e.preferencesObject={}}},{}],70:[function(e,t,r){"use strict";t.exports=function(){this.instance="Zotero.Search",this.searchObject={}}},{}],71:[function(e,t,r){"use strict";t.exports=function(){this.instance="Zotero.Searches",this.searchObjects={},this.syncState={earliestVersion:null,latestVersion:null}}},{}],72:[function(e,t,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};t.exports=function(e){this.instance="Zotero.Tag",this.color=null,this.version=0,"object"==("undefined"==typeof e?"undefined":o(e))?this.parseJsonTag(e):"string"==typeof e?this.parseJsonTag(this.templateApiObj(e)):this.parseJsonTag(this.tamplateApiObj(""))},t.exports.prototype=new Zotero.ApiObject,t.exports.prototype.parseJsonTag=function(e){var t=this;t.apiObj=Z.extend({},e),t.urlencodedtag=encodeURIComponent(t.apiObj.tag),t.version=t.apiObj.version},t.exports.prototype.templateApiObj=function(e){return{tag:e,links:{},meta:{type:0,numItems:1}}},t.exports.prototype.tagComparer=function(){if(Intl){var e=new Intl.Collator;return function(t,r){return e.compare(t.apiObj.tag,r.apiObj.tag)}}return function(e,t){return e.apiObj.tag.toLocaleLowerCase()==t.apiObj.tag.toLocaleLowerCase()?0:e.apiObj.tag.toLocaleLowerCase()<t.apiObj.tag.toLocaleLowerCase()?-1:1}},t.exports.prototype.set=function(e,t){var r=this;switch(e in r.apiObj&&(r.apiObj[e]=t),e in r.apiObj.meta&&(r.apiObj.meta[e]=t),e){case"tagVersion":case"version":r.version=t,r.apiObj.version=t}return r}},{}],73:[function(e,t,r){"use strict";t.exports=function(e){this.instance="Zotero.Tags",this.tagsVersion=0,this.syncState={earliestVersion:null,latestVersion:null},this.displayTagsArray=[],this.displayTagsUrl="",this.tagObjects={},this.tagsArray=[],this.loaded=!1,e&&this.addTagsFromJson(e)},t.exports.prototype=new Zotero.Container,t.exports.prototype.addTag=function(e){var t=this;t.tagObjects[e.apiObj.tag]=e,t.tagsArray.push(e),t.owningLibrary&&e.associateWithLibrary(t.owningLibrary)},t.exports.prototype.getTag=function(e){var t=this;return t.tagObjects.hasOwnProperty(e)?this.tagObjects[e]:null},t.exports.prototype.removeTag=function(e){var t=this;delete t.tagObjects[e],t.updateSecondaryData()},t.exports.prototype.removeTags=function(e){var t=this;e.forEach(function(e){delete t.tagObjects[e]}),t.updateSecondaryData()},t.exports.prototype.plainTagsList=function(e){Z.debug("Zotero.Tags.plainTagsList",3);var t=[];return e.forEach(function(e){t.push(e.apiObj.tag)}),t},t.exports.prototype.clear=function(){Z.debug("Zotero.Tags.clear",3),this.tagsVersion=0,this.syncState.earliestVersion=null,this.syncState.latestVersion=null,this.displayTagsArray=[],this.displayTagsUrl="",this.tagObjects={},this.tagsArray=[]},t.exports.prototype.updateSecondaryData=function(){Z.debug("Zotero.Tags.updateSecondaryData",3);var e=this;e.tagsArray=[],Object.keys(e.tagObjects).forEach(function(t){var r=e.tagObjects[t];e.tagsArray.push(r)}),e.tagsArray.sort(Zotero.Tag.prototype.tagComparer());var t=e.plainTagsList(e.tagsArray);t.sort(Zotero.Library.prototype.comparer()),e.plainList=t},t.exports.prototype.updateTagsVersion=function(e){var t=this;Object.keys(t.tagObjects).forEach(function(r){var o=t.tagObjects[r];o.set("version",e)})},t.exports.prototype.rebuildTagsArray=function(){var e=this;e.tagsArray=[],Object.keys(e.tagObjects).forEach(function(t){var r=e.tagObjects[t];e.tagsArray.push(r)})},t.exports.prototype.addTagsFromJson=function(e){Z.debug("Zotero.Tags.addTagsFromJson",3);var t=this,r=[];return e.forEach(function(e){var o=new Zotero.Tag(e);t.addTag(o),r.push(o)}),r}},{}],74:[function(e,t,r){"use strict";var o={};o.itemHref=function(e){var t="";return t+=Zotero.config.librarySettings.libraryPathString+"/itemKey/"+e.get("key")},o.attachmentDownloadLink=function(e){var t="",r=e.attachmentDownloadUrl;e.get("contentType");if(e.apiObj.links&&e.apiObj.links.enclosure){if(e.apiObj.links.enclosure.length||!e.isSnapshot()){var o=Zotero.utils.translateMimeType(e.apiObj.links.enclosure.type),n=e.apiObj.links.enclosure,i=parseInt(n.length,10),a=""+i+" B";return i>1073741824?a=""+(i/1073741824).toFixed(1)+" GB":i>1048576?a=""+(i/1048576).toFixed(1)+" MB":i>1024&&(a=""+(i/1024).toFixed(1)+" KB"),Z.debug(o,3),t+='<a href="'+r+'">',t+="undefined"==o||""===o||"undefined"==typeof o?a+"</a>":o+", "+a+"</a>"}t+='<a href="'+r+'">View Snapshot</a>'}return t},o.attachmentDownloadUrl=function(e){return e.apiObj.links&&e.apiObj.links.enclosure?Zotero.config.proxyDownloads?o.wwwDownloadUrl(e):o.apiDownloadUrl(e):!1},o.apiDownloadUrl=function(e){return e.apiObj.links.enclosure?e.apiObj.links.enclosure.href:!1},o.proxyDownloadUrl=function(e){return e.apiObj.links.enclosure?Zotero.config.proxyDownloads?Zotero.config.baseDownloadUrl+"?itemkey="+e.get("key"):o.apiDownloadUrl(e):!1},o.wwwDownloadUrl=function(e){return e.apiObj.links.enclosure?Zotero.config.baseZoteroWebsiteUrl+Zotero.config.librarySettings.libraryPathString+"/"+e.get("key")+"/file/view":!1},o.publicationsDownloadUrl=function(e){return e.apiObj.links.enclosure?e.apiObj.links.enclosure.href:!1},o.attachmentFileDetails=function(e){if(!e.apiObj.links.enclosure)return"";var t=Zotero.utils.translateMimeType(e.apiObj.links.enclosure.type),r=e.apiObj.links.enclosure,o="";if(r.length){var n=parseInt(r.length,10);return o=""+n+" B",n>1073741824?o=""+(n/1073741824).toFixed(1)+" GB":n>1048576?o=""+(n/1048576).toFixed(1)+" MB":n>1024&&(o=""+(n/1024).toFixed(1)+" KB"),"("+t+", "+o+")"}return"("+t+")"},o.userWebLibrary=function(e){return[Zotero.config.baseWebsiteUrl,e,"items"].join("/")},o.groupWebLibrary=function(e){return"Private"==e.type?[Zotero.config.baseWebsiteUrl,"groups",e.get("id"),"items"].join("/"):[Zotero.config.baseWebsiteUrl,"groups",Zotero.utils.slugify(e.get("name")),"items"].join("/")},o.exportUrls=function(e){Z.debug("Zotero.url.exportUrls",3);var t={},r={};return Zotero.config.exportFormats.forEach(function(o){r=Z.extend(e,{format:o}),t[o]=Zotero.ajax.apiRequestUrl(r)+Zotero.ajax.apiQueryString({format:o,limit:"25"})}),t},o.relationUrl=function(e,t,r){return"http://zotero.org/"+e+"s/"+t+"/items/"+r},t.exports=o},{}],75:[function(e,t,r){"use strict";t.exports=function(){this.instance="Zotero.User"},t.exports.prototype=new Zotero.ApiObject,t.exports.prototype.loadObject=function(e){this.title=e.title,this.author=e.author,this.tagID=e.tagID,this.published=e.published,this.updated=e.updated,this.links=e.links,this.numItems=e.numItems,this.items=e.items,this.tagType=e.tagType,this.modified=e.modified,this.added=e.added,this.key=e.key},t.exports.prototype.parseXmlUser=function(e){this.parseXmlEntry(e);var t=e.find("content>tag");0!==t.length&&(this.tagKey=t.attr("key"),this.libraryID=t.attr("libraryID"),this.tagName=t.attr("name"),this.dateAdded=t.attr("dateAdded"),this.dateModified=t.attr("dateModified"))}},{}],76:[function(e,t,r){"use strict";var o={randomString:function(e,t){t||(t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),e||(e=8);for(var r="",o=0;e>o;o++){var n=Math.floor(Math.random()*t.length);r+=t.substring(n,n+1)}return r},getKey:function(){var e="23456789ABCDEFGHIJKMNPQRSTUVWXZ";return o.randomString(8,e)},slugify:function(e){var t=e.trim();return t=t.toLowerCase(),t=t.replace(/[^a-z0-9 ._-]/g,""),t=t.replace(/\s/g,"_")},prependAutocomplete:function(e,t){Z.debug("Zotero.utils.prependAutocomplete",3),Z.debug("prepend match: "+e);var r;if(t||Z.debug("source is not defined"),""===e)return r=t.slice(0);var o=e.length,n=e.toLowerCase();return r=t.map(function(e){return e.substr(0,o).toLowerCase()==n?e:null})},matchAnyAutocomplete:function(e,t){Z.debug("Zotero.utils.matchAnyAutocomplete",3),Z.debug("matchAny match: "+e);var r;if(t||Z.debug("source is not defined"),""===e)return r=t.slice(0);var o=(e.length,e.toLowerCase());return r=t.map(function(e){return-1!=e.toLowerCase().indexOf(o)?e:null})},libraryString:function(e,t){var r="";return"user"==e?r="u":"group"==e&&(r="g"),r+=t},parseLibString:function(e){var t,r;if("u"==e.charAt(0))t="user";else{if("g"!=e.charAt(0))throw new Error("unexpected type character in libraryString");t="group"}return r=parseInt(e.substring(1)),{libraryType:t,libraryID:r}},stale:function(e,t){var r=Date.now(),o=r.getTime()-e.getTime();return o/6e4>t?!0:!1},entityify:function(e){var t={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"};return e.replace(/[<>&"]/g,function(e){return t[e]})},parseApiDate:function(e,t){var r=/([0-9]+)-([0-9]+)-([0-9]+)T([0-9]+):([0-9]+):([0-9]+)Z/,o=r.exec(e);return null===o?(Z.error("error parsing api date: "+e),null):t=new Date(Date.UTC(o[1],o[2]-1,o[3],o[4],o[5],o[6]))},readCookie:function(e){for(var t=e+"=",r=document.cookie.split(";"),o=0;o<r.length;o++){for(var n=r[o];" "==n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return null},translateMimeType:function(e){switch(e){case"text/html":return"html";case"application/pdf":case"application/x-pdf":case"application/acrobat":case"applications/vnd.pdf":case"text/pdf":case"text/x-pdf":return"pdf";case"image/jpg":case"image/jpeg":return"jpg";case"image/gif":return"gif";case"application/msword":case"application/doc":case"application/vnd.msword":case"application/vnd.ms-word":case"application/winword":case"application/word":case"application/x-msw6":case"application/x-msword":return"doc";case"application/vnd.oasis.opendocument.text":case"application/x-vnd.oasis.opendocument.text":return"odt";case"video/flv":case"video/x-flv":return"flv";case"image/tif":case"image/tiff":case"image/x-tif":case"image/x-tiff":case"application/tif":case"application/x-tif":case"application/tiff":case"application/x-tiff":return"tiff";case"application/zip":case"application/x-zip":case"application/x-zip-compressed":case"application/x-compress":case"application/x-compressed":case"multipart/x-zip":return"zip";case"video/quicktime":case"video/x-quicktime":return"mov";case"video/avi":case"video/msvideo":case"video/x-msvideo":return"avi";case"audio/wav":case"audio/x-wav":case"audio/wave":return"wav";case"audio/aiff":case"audio/x-aiff":case"sound/aiff":return"aiff";case"text/plain":return"plain text";case"application/rtf":return"rtf";default:return e}},getKeyPermissions:function(e,t){if(!e)return!1;if(!t)return!1;var r={target:"key",libraryType:"user",libraryID:e,apiKey:t},o=Zotero.ajax.apiRequestString(r);return Zotero.ajaxRequest(o).then(function(e){var t=JSON.parse(e.data);return t})},parseQuery:function(e){for(var t,r={},o=/\+/g,n=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(o," "))};t=n.exec(e);)r[i(t[1])]=i(t[2]);return r},querystring:function(e){var t=-1!=e.indexOf("#")?e.indexOf("#"):void 0,r=e.substring(e.indexOf("?")+1,t);return r}};t.exports=o},{}]},{},[1])(1)});