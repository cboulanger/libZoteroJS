!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Zotero=e()}}(function(){var e;return function t(e,r,o){function i(s,a){if(!r[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(n)return n(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[s]={exports:{}};e[s][0].call(l.exports,function(t){var r=e[s][1][t];return i(r?r:t)},l,l.exports,t,e,r,o)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,r){},{}],2:[function(e,t,r){"use strict";var o,i=e("es5-ext/object/assign"),n=e("es5-ext/object/normalize-options"),s=e("es5-ext/object/is-callable"),a=e("es5-ext/string/#/contains");o=t.exports=function(e,t){var r,o,s,c,u;return arguments.length<2||"string"!=typeof e?(c=t,t=e,e=null):c=arguments[2],null==e?(r=s=!0,o=!1):(r=a.call(e,"c"),o=a.call(e,"e"),s=a.call(e,"w")),u={value:t,configurable:r,enumerable:o,writable:s},c?i(n(c),u):u},o.gs=function(e,t,r){var o,c,u,l;return"string"!=typeof e?(u=r,r=t,t=e,e=null):u=arguments[3],null==t?t=void 0:s(t)?null==r?r=void 0:s(r)||(u=r,r=void 0):(u=t,t=r=void 0),null==e?(o=!0,c=!1):(o=a.call(e,"c"),c=a.call(e,"e")),l={get:t,set:r,configurable:o,enumerable:c},u?i(n(u),l):l}},{"es5-ext/object/assign":59,"es5-ext/object/is-callable":64,"es5-ext/object/normalize-options":70,"es5-ext/string/#/contains":74}],3:[function(e,t,r){"use strict";var o,i,n,s=e("es5-ext/object/valid-callable"),a=e("d"),c=e("es5-ext/object/is-callable"),u=e("event-emitter"),l=e("./is-promise"),p=Object.create,d=Object.defineProperty;t.exports=r=function(e,t,o,i){e=String(e),s(i)&&(null==o||s(o))&&s(t),d(r._unresolved,e,a(t)),r._onresolve[e]=o,d(r._resolved,e,a(i)),r._names.push(e)},r._names=["done","then","valueOf"],r._unresolved=u(p(Function.prototype,{then:a(function(e,t){var r;return this.pending||(this.pending=[]),r=o(),this.pending.push("then",[e,t,r.resolve,r.reject]),r.promise}),done:a(function(e,t){null==e||s(e),null==t||s(t),this.pending||(this.pending=[]),this.pending.push("done",arguments)}),resolved:a(!1),returnsPromise:a(!0),valueOf:a(function(){return this})})),r._onresolve={then:function(e,t,r,o){var i,n=this.failed?t:e;if(null==n)return void(this.failed?o(this.value):r(this.value));if(c(n)){if(l(n))return n.resolved?void(n.failed?o(n.value):r(n.value)):void n.done(r,o);try{i=n(this.value)}catch(s){return void o(s)}return void r(i)}r(n)},done:function(e,t){if(this.failed){if(t)return void t(this.value);throw this.value}e&&e(this.value)}},r._resolved=u(p(Function.prototype,{then:a(function(e,t){var r,o=this.failed?t:e;if(null==o)return this;if(c(o)){if(l(o))return o;try{r=o(this.value)}catch(s){return n(s)}return i(r)}return i(o)}),done:a(function(e,t){if(null==e||s(e),null==t||s(t),this.failed){if(t)return void t(this.value);throw this.value}e&&e(this.value)}),resolved:a(!0),returnsPromise:a(!0),valueOf:a(function(){return this.value})})),o=e("./deferred"),i=o.resolve,n=o.reject,o.extend=r},{"./deferred":5,"./is-promise":32,d:2,"es5-ext/object/is-callable":64,"es5-ext/object/valid-callable":71,"event-emitter":88}],4:[function(e,t,r){"use strict";var o=e("es5-ext/object/is-object"),i=e("./is-promise"),n=e("./deferred"),s=e("next-tick"),a=Object.getPrototypeOf;t.exports=function c(e){var t,r,u,l,p;if(!e)return e;try{t=e.then}catch(d){return e}if("function"!=typeof t)return e;if(i(e))return e;if(!o(e))return e;if(!a(e))return e;try{r=e.done}catch(f){}if(u=n(),l=function(e){u.resolve(c(e))},p=function(e){u.reject(e)},"function"==typeof r){try{r.call(e,l,p)}catch(d){return u.reject(d)}return u.promise}try{t.call(e,function(e){s(function(){l(e)})},function(e){s(function(){p(e)})})}catch(d){return u.reject(d)}return u.promise}},{"./deferred":5,"./is-promise":32,"es5-ext/object/is-object":65,"next-tick":90}],5:[function(e,t,r){"use strict";var o,i,n,s,a,c,u,l=e("es5-ext/error/is-error"),p=e("es5-ext/function/noop"),d=e("./is-promise"),f=Array.prototype.every,y=Array.prototype.push,h=0,g=Boolean(d.__proto__);s=function(e){a._names.forEach(function(t){e[t]=function(){return e.__proto__[t].apply(e,arguments)}}),e.returnsPromise=!0,e.resolved=e.__proto__.resolved},c=function(e,t){var r=function(e,t){return r.then(e,t)};return r.value=e,r.failed=t,r.__proto__=a._resolved,g||s(r),i._profile&&i._profile(!0),r},o=function(){var e=function(t,r){return e.then(t,r)};h||(n=setTimeout(p,1e9)),++h,i._monitor&&(e.monitor=i._monitor()),e.__proto__=a._unresolved,g||s(e),i._profile&&i._profile(),this.promise=e,this.resolve=this.resolve.bind(this),this.reject=this.reject.bind(this)},o.prototype={resolved:!1,_settle:function(e){var t,r,o,i,n,s;for(this.promise.value=e,this.promise.__proto__=a._resolved,g||(this.promise.resolved=!0),i=this.promise.dependencies,delete this.promise.dependencies;i;){for(t=0;n=i[t];++t)n.value=e,n.failed=this.failed,n.__proto__=a._resolved,g||(n.resolved=!0),delete n.pending,n.dependencies&&(s?y.apply(s,n.dependencies):s=n.dependencies,delete n.dependencies);i=s,s=null}if(o=this.promise.pending){for(t=0;r=o[t];++t)a._onresolve[r].apply(this.promise,o[++t]);delete this.promise.pending}return this.promise},resolve:function(e){if(this.resolved)return this.promise;if(this.resolved=!0,--h||clearTimeout(n),this.promise.monitor&&clearTimeout(this.promise.monitor),e=u(e),d(e)){if(!e.resolved)return e.dependencies||(e.dependencies=[]),e.dependencies.push(this.promise),this.promise.pending?e.pending?(y.apply(e.pending,this.promise.pending),this.promise.pending=e.pending,this.promise.dependencies&&this.promise.dependencies.forEach(function t(r){r.pending=e.pending,r.dependencies&&r.dependencies.forEach(t)})):e.pending=this.promise.pending:e.pending?this.promise.pending=e.pending:this.promise.pending=e.pending=[],this.promise;this.promise.failed=e.failed,e=e.value}return this._settle(e)},reject:function(e){return this.resolved?this.promise:(this.resolved=!0,--h||clearTimeout(n),this.promise.monitor&&clearTimeout(this.promise.monitor),this.promise.failed=!0,this._settle(e))}},t.exports=i=function(e){var t,r,i,n,s=arguments.length;return s?s>1?(t=new o,r=0,n=new Array(s),f.call(arguments,function(e,o){return e=u(e),d(e)?e.resolved?e.failed?(t.reject(e.value),!1):(n[o]=e.value,!0):(++r,e.done(function(e){n[o]=e,!--r&&i&&t.resolve(n)},t.reject),!0):(n[o]=e,!0)}),i=!0,r||t.resolve(n),t.promise):(e=u(e),d(e)?e:c(e,l(e))):new o},i.Deferred=o,i.reject=function(e){return c(e,!0)},i.resolve=function(e){return e=u(e),d(e)?e:c(e,!1)},a=e("./_ext"),u=e("./assimilate")},{"./_ext":3,"./assimilate":4,"./is-promise":32,"es5-ext/error/is-error":44,"es5-ext/function/noop":50}],6:[function(e,t,r){"use strict";var o,i=e("es5-ext/array/from"),n=e("es5-ext/iterable/validate-object"),s=e("es5-ext/object/assign"),a=e("./deferred"),c=e("./is-promise"),u=e("./assimilate");t.exports=o=function(e){return this instanceof o?(e=i(n(e)),s(this,a()),e.every(this.add,this),this.waiting?void(this.initialized=!0):void this.resolve()):new o(e)},o.prototype={waiting:0,initialized:!1,add:function(e){if(this.promise.resolved)throw new Error("Queue was already resolved");if(++this.waiting,e=u(e),c(e)){if(!e.resolved)return e.done(this._processValue.bind(this),this.reject),!0;if(e.failed)return this.reject(e.value),!1}return this._processValue()},_processValue:function(){return this.promise.resolved?void 0:(!--this.waiting&&this.initialized&&this.resolve(),!0)}}},{"./assimilate":4,"./deferred":5,"./is-promise":32,"es5-ext/array/from":37,"es5-ext/iterable/validate-object":52,"es5-ext/object/assign":59}],7:[function(e,t,r){"use strict";var o=e("es5-ext/array/of"),i=e("../deferred"),n=e("../is-promise"),s=e("../assimilate"),a=Array.prototype.push,c=Array.prototype.slice;t.exports=function(e,t){var r,u,l;for(null!=t&&e.length!==t&&(e=c.call(e,0,t),e.length<t&&a.apply(e,new Array(t-e.length))),r=0,u=e.length;u>r;++r)if(l=s(e[r]),n(l)){if(!l.resolved)return u>1?i.apply(null,e):l(o);if(l.failed)return l;e[r]=l.value}return e}},{"../assimilate":4,"../deferred":5,"../is-promise":32,"es5-ext/array/of":40}],8:[function(e,t,r){"use strict";t.exports=e("../../lib/some-every")(!1)},{"../../lib/some-every":33}],9:[function(e,t,r){"use strict";var o,i=e("es5-ext/object/assign"),n=e("es5-ext/object/valid-value"),s=e("es5-ext/object/valid-callable"),a=e("../../deferred"),c=e("../../is-promise"),u=e("../../assimilate"),l=Function.prototype.call,p=a.resolve;o=function(e,t,r){for(this.list=e,this.cb=t,this.context=r,this.length=e.length>>>0;this.current<this.length;){if(this.current in e)return i(this,a()),this.processCb=this.processCb.bind(this),this.process(),this.promise;++this.current}return p(void 0)},o.prototype={current:0,process:function(){var e=u(this.list[this.current]);if(c(e)){if(!e.resolved)return void e.done(this.processCb,this.reject);if(e.failed)return void this.reject(e.value);e=e.value}this.processCb(e)},processCb:function(e){var t;if(this.cb){try{t=l.call(this.cb,this.context,e,this.current,this.list)}catch(r){return void this.reject(r)}if(t=u(t),c(t)){if(!t.resolved)return void t.done(this.processValue.bind(this,e),this.reject);if(t.failed)return void this.reject(t.value);t=t.value}}else t=e;this.processValue(e,t)},processValue:function(e,t){if(t)return void this.resolve(e);for(;++this.current<this.length;)if(this.current in this.list)return void this.process();this.resolve(void 0)}},t.exports=function(e){return n(this),null==e||s(e),new o(this,e,arguments[1])}},{"../../assimilate":4,"../../deferred":5,"../../is-promise":32,"es5-ext/object/assign":59,"es5-ext/object/valid-callable":71,"es5-ext/object/valid-value":73}],10:[function(e,t,r){"use strict";var o,i=e("es5-ext/object/assign"),n=e("es5-ext/object/valid-value"),s=e("es5-ext/object/valid-callable"),a=e("../../deferred"),c=e("../../is-promise"),u=e("../../assimilate"),l=Array.prototype.every,p=Function.prototype.call;o=function(e,t,r){return this.list=e,this.cb=t,this.context=r,this.result=new Array(e.length>>>0),i(this,a()),l.call(e,this.process,this),this.waiting?(this.initialized=!0,this.promise):this.resolve(this.result)},o.prototype={waiting:0,initialized:!1,process:function(e,t){if(++this.waiting,e=u(e),c(e)){if(!e.resolved)return e.done(this.processCb.bind(this,t),this.reject),!0;if(e.failed)return this.reject(e.value),!1;e=e.value}return this.processCb(t,e)},processCb:function(e,t){if(this.promise.resolved)return!1;if(this.cb){try{t=p.call(this.cb,this.context,t,e,this.list)}catch(r){return this.reject(r),!1}if(t=u(t),c(t)){if(!t.resolved)return t.done(this.processValue.bind(this,e),this.reject),!0;if(t.failed)return this.reject(t.value),!1;t=t.value}}return this.processValue(e,t),!0},processValue:function(e,t){this.promise.resolved||(this.result[e]=t,!--this.waiting&&this.initialized&&this.resolve(this.result))}},t.exports=function(e){return n(this),null==e||s(e),new o(this,e,arguments[1])}},{"../../assimilate":4,"../../deferred":5,"../../is-promise":32,"es5-ext/object/assign":59,"es5-ext/object/valid-callable":71,"es5-ext/object/valid-value":73}],11:[function(e,t,r){"use strict";var o,i=e("es5-ext/object/assign"),n=e("es5-ext/object/valid-value"),s=e("es5-ext/object/valid-callable"),a=e("../../deferred"),c=e("../../is-promise"),u=e("../../assimilate"),l=Function.prototype.call,p=Object.prototype.hasOwnProperty,d=a.resolve;o=function(e,t,r,o){if(this.list=e,this.cb=t,this.initialized=o,this.length=e.length>>>0,r=u(r),c(r)){if(!r.resolved)return i(this,a()),r.done(function(e){this.value=e,this.init()}.bind(this),this.reject),this.promise;if(this.value=r.value,r.failed)return r}else this.value=r;return this.init()},o.prototype={current:0,state:!1,init:function(){for(;this.current<this.length&&!p.call(this.list,this.current);)++this.current;if(this.current===this.length){if(!this.initialized)throw new Error("Reduce of empty array with no initial value");return this.resolve?this.resolve(this.value):d(this.value)}return this.promise||i(this,a()),this.processCb=this.processCb.bind(this),this.processValue=this.processValue.bind(this),this["continue"](),this.promise},"continue":function(){for(var e;!this.state&&(e=this.process(),"cb"===this.state)&&(e=this.processCb(e),"value"===this.state);)this.processValue(e)},process:function(){var e=u(this.list[this.current]);if(c(e)){if(!e.resolved)return void e.done(function(e){e=this.processCb(e),"value"===this.state&&(this.processValue(e),this.state||this["continue"]())}.bind(this),this.reject);if(e.failed)return void this.reject(e.value);e=e.value}return this.state="cb",e},processCb:function(e){if(!this.initialized)return this.initialized=!0,this.state="value",e;if(this.cb){try{e=l.call(this.cb,void 0,this.value,e,this.current,this.list)}catch(t){return void this.reject(t)}if(e=u(e),c(e)){if(!e.resolved)return void e.done(function(e){this.state="value",this.processValue(e),this.state||this["continue"]()}.bind(this),this.reject);if(e.failed)return void this.reject(e.value);e=e.value}}return this.state="value",e},processValue:function(e){for(this.value=e;++this.current<this.length;)if(p.call(this.list,this.current))return void(this.state=!1);this.resolve(this.value)}},t.exports=function(e){return n(this),null==e||s(e),new o(this,e,arguments[1],arguments.length>1)}},{"../../assimilate":4,"../../deferred":5,"../../is-promise":32,"es5-ext/object/assign":59,"es5-ext/object/valid-callable":71,"es5-ext/object/valid-value":73}],12:[function(e,t,r){"use strict";t.exports=e("../../lib/some-every")(!0)},{"../../lib/some-every":33}],13:[function(e,t,r){"use strict";var o,i,n=e("es5-ext/array/to-array"),s=e("es5-ext/object/valid-callable"),a=e("../../deferred"),c=e("../../is-promise"),u=e("../_process-arguments"),l=Array.prototype.slice,p=Function.prototype.apply;o=function(e,t,r){t=n(t),p.call(e,this,t.concat(function(e,t){null==e?r.resolve(arguments.length>2?l.call(arguments,1):t):r.reject(e)}))},i=function(e,t,r,i){var n;if(i=u(i,t),c(i))return i.failed?i:(n=a(),i.done(function(t){if(e.returnsPromise)return p.call(e,r,t);try{o.call(r,e,t,n)}catch(i){n.reject(i)}},n.reject),n.promise);if(e.returnsPromise)return p.call(e,r,i);n=a();try{o.call(r,e,i,n)}catch(s){throw n.reject(s),s}return n.promise},t.exports=r=function(e){return i(s(this),null,e,l.call(arguments,1))},Object.defineProperty(r,"_base",{configurable:!0,enumerable:!1,writable:!0,value:i})},{"../../deferred":5,"../../is-promise":32,"../_process-arguments":7,"es5-ext/array/to-array":43,"es5-ext/object/valid-callable":71}],14:[function(e,t,r){"use strict";var o,i=e("es5-ext/object/valid-callable"),n=e("next-tick"),s=e("timers-ext/valid-timeout"),a=e("../../deferred"),c=Function.prototype.apply;o=function(e,t,r,o){var i;try{i=c.call(e,this,t)}catch(n){return void o(n)}r(i)},t.exports=function(e){var t,r,c;return t=i(this),null==e?c=n:(e=s(e),c=setTimeout),r=function(){var r=a();return c(o.bind(this,t,arguments,r.resolve,r.reject),e),r.promise},r.returnsPromise=!0,r}},{"../../deferred":5,"es5-ext/object/valid-callable":71,"next-tick":90,"timers-ext/valid-timeout":95}],15:[function(e,t,r){"use strict";var o,i=e("es5-ext/number/to-pos-integer"),n=e("es5-ext/object/valid-callable"),s=e("event-emitter/unify"),a=e("../../deferred"),c=e("../../is-promise"),u=e("../../assimilate"),l=a.resolve,p=a.reject,d=Function.prototype.apply,f=Math.max;e("../promise/finally"),o=function(){var e=new Error("Too many calls");return e.type="deferred-gate-rejected",p(e)},t.exports=function(e,t){var r,y,h,g,b,m,v;return r=n(this),e=f(i(e),1),t=null==t||isNaN(t)?1/0:i(t),y=0,b=[],m=function(e,t,o){var i;try{i=d.call(r,e,t)}catch(n){return o?(o.reject(n),void g()):p(n)}if(i=u(i),c(i)){if(o&&s(o.promise,i),!i.resolved)return++y,o&&o.resolve(i),i["finally"](h);i=i.value}return o?(o.resolve(i),void g()):l(i)},h=function(){--y,g()},g=function(){var e;(e=b.shift())&&m.apply(null,e)},v=function(){var r;return y>=e?b.length<t?(r=a(),b.push([this,arguments,r]),r.promise):o():m(this,arguments)},v.returnsPromise=!0,v}},{"../../assimilate":4,"../../deferred":5,"../../is-promise":32,"../promise/finally":22,"es5-ext/number/to-pos-integer":57,"es5-ext/object/valid-callable":71,"event-emitter/unify":89}],16:[function(e,t,r){"use strict";var o,i=e("es5-ext/object/valid-callable"),n=e("../../deferred"),s=e("../../is-promise"),a=e("../_process-arguments"),c=Function.prototype.apply;o=function(e,t,r,o){var i;try{i=c.call(e,this,t)}catch(n){return void o(n)}r(i)},t.exports=function(e){var t,r;return t=i(this),t.returnsPromise?t:(null!=e&&(e>>>=0),r=function(){var r,i;if(r=a(arguments,e),s(r)){if(r.failed)return r;i=n(),r.done(function(e){o.call(this,t,e,i.resolve,i.reject)}.bind(this),i.reject)}else i=n(),o.call(this,t,r,i.resolve,i.reject);return i.promise},r.returnsPromise=!0,r)}},{"../../deferred":5,"../../is-promise":32,"../_process-arguments":7,"es5-ext/object/valid-callable":71}],17:[function(e,t,r){"use strict";var o=e("es5-ext/object/valid-callable"),i=e("./call-async")._base;t.exports=function(e){var t,r;return t=o(this),t.returnsPromise?t:(null!=e&&(e>>>=0),r=function(){return i(t,e,this,arguments)},r.returnsPromise=!0,r)}},{"./call-async":13,"es5-ext/object/valid-callable":71}],18:[function(e,t,r){"use strict";var o=e("es5-ext/object/valid-callable"),i=e("../../deferred"),n=i.reject;t.exports=function(e,t){i.extend(e,function(t){var r;return null==t||o(t),this.pending||(this.pending=[]),r=i(),this.pending.push(e,[arguments,r.resolve,r.reject]),r.promise},function(e,r,o){var i;if(this.failed)return void o(this.value);try{i=t.apply(this.value,e)}catch(n){return void o(n)}r(i)},function(e){if(null==e||o(e),this.failed)return this;try{return t.apply(this.value,arguments)}catch(r){return n(r)}})}},{"../../deferred":5,"es5-ext/object/valid-callable":71}],19:[function(e,t,r){"use strict";var o=e("es5-ext/object/valid-callable"),i=e("../../deferred");i.extend("aside",function(e,t){return null==e||o(e),null==t||o(t),(e||t)&&(this.pending||(this.pending=[]),this.pending.push("aside",arguments)),this},function(e,t){var r=this.failed?t:e;r&&r(this.value)},function(e,t){var r;return null==e||o(e),null==t||o(t),r=this.failed?t:e,r&&r(this.value),this})},{"../../deferred":5,"es5-ext/object/valid-callable":71}],20:[function(e,t,r){"use strict";var o=e("es5-ext/object/is-callable"),i=e("es5-ext/object/valid-value"),n=e("../../deferred"),s=e("../../is-promise"),a=n.resolve,c=n.reject;n.extend("catch",function(e){var t;return i(e),this.pending||(this.pending=[]),t=n(),this.pending.push("catch",[e,t.resolve,t.reject]),t.promise},function(e,t,r){var i;if(!this.failed)return void t(this.value);if(o(e)){if(s(e))return void(e.resolved?e.failed?r(e.value):t(e.value):e.done(t,r));try{i=e(this.value)}catch(n){return void r(n)}return void t(i)}t(e)},function(e){var t;if(i(e),!this.failed)return this;if(o(e)){if(s(e))return e;try{t=e(this.value)}catch(r){return c(r)}return a(t)}return a(e)})},{"../../deferred":5,"../../is-promise":32,"es5-ext/object/is-callable":64,"es5-ext/object/valid-value":73}],21:[function(e,t,r){"use strict";var o=e("es5-ext/object/valid-callable"),i=e("next-tick"),n=e("../../deferred");n.extend("cb",function(e){return null==e?this:(o(e),i(function(){this.resolved?this.failed?e(this.value):e(null,this.value):(this.pending||(this.pending=[]),this.pending.push("cb",[e]))}.bind(this)),this)},function(e){this.failed?e(this.value):e(null,this.value)},function(e){return null==e?this:(o(e),i(function(){this.failed?e(this.value):e(null,this.value)}.bind(this)),this)})},{"../../deferred":5,"es5-ext/object/valid-callable":71,"next-tick":90}],22:[function(e,t,r){"use strict";var o=e("es5-ext/object/valid-callable"),i=e("../../deferred");i.extend("finally",function(e){return o(e),this.pending||(this.pending=[]),this.pending.push("finally",arguments),this},function(e){e()},function(e){return o(e)(),this})},{"../../deferred":5,"es5-ext/object/valid-callable":71}],23:[function(e,t,r){"use strict";var o=e("es5-ext/object/valid-value"),i=e("../../deferred"),n=Array.prototype.reduce,s=i.resolve,a=i.reject;i.extend("get",function(){var e;return this.pending||(this.pending=[]),e=i(),this.pending.push("get",[arguments,e.resolve,e.reject]),e.promise},function(e,t,r){var i;this.failed&&r(this.value);try{i=n.call(e,function(e,t){return o(e)[String(t)]},this.value)}catch(s){return void r(s)}t(i)},function(){var e;if(this.failed)return this;try{e=n.call(arguments,function(e,t){return o(e)[String(t)]},this.value)}catch(t){return a(t)}return s(e)})},{"../../deferred":5,"es5-ext/object/valid-value":73}],24:[function(e,t,r){"use strict";var o,i=e("es5-ext/array/to-array"),n=e("es5-ext/object/is-callable"),s=e("../../deferred"),a=e("../../is-promise"),c=e("../_process-arguments"),u=Array.prototype.slice,l=Function.prototype.apply,p=s.reject;o=function(e,t,r,o){var n;if(e.returnsPromise){try{n=l.call(e,this,t)}catch(s){return void o(s)}return r(n)}t=i(t).concat(function(e,t){null==e?r(arguments.length>2?u.call(arguments,1):t):o(e)});try{l.call(e,this,t)}catch(a){o(a)}},s.extend("invokeAsync",function(e){var t;return this.pending||(this.pending=[]),t=s(),this.pending.push("invokeAsync",[arguments,t.resolve,t.reject]),t.promise},function(e,t,r){var i;if(this.failed)return void r(this.value);if(null==this.value)return void r(new TypeError("Cannot use null or undefined"));if(i=e[0],!n(i)){if(i=String(i),!n(this.value[i]))return void r(new TypeError(i+" is not a function"));i=this.value[i]}if(e=c(u.call(e,1)),a(e)){if(e.failed)return void r(e.value);e.done(function(e){o.call(this,i,e,t,r)}.bind(this.value),r)}else o.call(this.value,i,e,t,r)},function(e){var t,r;if(this.failed)return this;if(null==this.value)return p(new TypeError("Cannot use null or undefined"));if(!n(e)){if(e=String(e),!n(this.value[e]))return p(new TypeError(e+" is not a function"));e=this.value[e]}if(t=c(u.call(arguments,1)),a(t)){if(t.failed)return t;r=s(),t.done(function(t){o.call(this,e,t,r.resolve,r.reject)}.bind(this.value),r.reject)}else{if(e.returnsPromise)return o.call(this.value,e,t,s,p);r=s(),o.call(this.value,e,t,r.resolve,r.reject)}return r.promise})},{"../../deferred":5,"../../is-promise":32,"../_process-arguments":7,"es5-ext/array/to-array":43,"es5-ext/object/is-callable":64}],25:[function(e,t,r){"use strict";var o,i=e("es5-ext/object/is-callable"),n=e("../../deferred"),s=e("../../is-promise"),a=e("../_process-arguments"),c=Array.prototype.slice,u=Function.prototype.apply,l=n.reject;o=function(e,t,r,o){var i;try{i=u.call(e,this,t)}catch(n){return o(n)}return r(i)},n.extend("invoke",function(e){var t;return this.pending||(this.pending=[]),t=n(),this.pending.push("invoke",[arguments,t.resolve,t.reject]),t.promise},function(e,t,r){var n;if(this.failed)return void r(this.value);if(null==this.value)return void r(new TypeError("Cannot use null or undefined"));if(n=e[0],!i(n)){if(n=String(n),!i(this.value[n]))return void r(new TypeError(n+" is not a function"));n=this.value[n]}if(e=a(c.call(e,1)),s(e)){if(e.failed)return void r(e.value);e.done(function(e){o.call(this,n,e,t,r)}.bind(this.value),r)}else o.call(this.value,n,e,t,r)},function(e){var t,r;if(this.failed)return this;if(null==this.value)return l(new TypeError("Cannot use null or undefined"));if(!i(e)){if(e=String(e),!i(this.value[e]))return l(new TypeError(e+" is not a function"));e=this.value[e]}return t=a(c.call(arguments,1)),s(t)?t.failed?t:(r=n(),t.done(function(t){o.call(this,e,t,r.resolve,r.reject)}.bind(this.value),r.reject),r.promise):o.call(this.value,e,t,n,l)})},{"../../deferred":5,"../../is-promise":32,"../_process-arguments":7,"es5-ext/object/is-callable":64}],26:[function(e,t,r){"use strict";e("./_array")("map",e("../array/map"))},{"../array/map":10,"./_array":18}],27:[function(e,t,r){"use strict";e("./_array")("reduce",e("../array/reduce"))},{"../array/reduce":11,"./_array":18}],28:[function(e,t,r){"use strict";e("./_array")("some",e("../array/some"))},{"../array/some":12,"./_array":18}],29:[function(e,t,r){"use strict";var o=e("es5-ext/function/#/spread"),i=e("es5-ext/object/valid-callable"),n=e("es5-ext/object/is-callable"),s=e("../../is-promise"),a=e("../../deferred"),c=a.resolve,u=a.reject;a.extend("spread",function(e,t){var r;return null==e||i(e),e||null!=t?(this.pending||(this.pending=[]),r=a(),this.pending.push("spread",[e,t,r.resolve,r.reject]),r.promise):this},function(e,t,r,i){var a,c;if(a=this.failed?t:e,null==a&&(this.failed?i(this.value):r(this.value)),n(a)){if(s(a))return void(a.resolved?a.failed?i(a.value):r(a.value):a.done(r,i));this.failed||(a=o.call(a));try{c=a(this.value)}catch(u){return void i(u)}r(c)}else r(a)},function(e,t){var r,i;if(r=this.failed?t:e,null==r)return this;if(n(r)){if(s(r))return r;this.failed||(r=o.call(r));try{i=r(this.value)}catch(a){return u(a)}return c(i)}return c(r)})},{"../../deferred":5,"../../is-promise":32,"es5-ext/function/#/spread":46,"es5-ext/object/is-callable":64,"es5-ext/object/valid-callable":71}],30:[function(e,t,r){"use strict";var o=Function.prototype.call,i=e("es5-ext/object/assign");t.exports=i(e("./deferred"),{invokeAsync:e("./invoke-async"),isPromise:e("./is-promise"),dynamicQueue:e("./dynamic-queue"),validPromise:e("./valid-promise"),callAsync:o.bind(e("./ext/function/call-async")),delay:o.bind(e("./ext/function/delay")),gate:o.bind(e("./ext/function/gate")),monitor:e("./monitor"),promisify:o.bind(e("./ext/function/promisify")),promisifySync:o.bind(e("./ext/function/promisify-sync")),every:o.bind(e("./ext/array/every")),find:o.bind(e("./ext/array/find")),map:o.bind(e("./ext/array/map")),reduce:o.bind(e("./ext/array/reduce")),some:o.bind(e("./ext/array/some"))},e("./profiler")),e("./ext/promise/aside"),e("./ext/promise/catch"),e("./ext/promise/cb"),e("./ext/promise/finally"),e("./ext/promise/get"),e("./ext/promise/invoke"),e("./ext/promise/invoke-async"),e("./ext/promise/map"),e("./ext/promise/spread"),e("./ext/promise/some"),e("./ext/promise/reduce")},{"./deferred":5,"./dynamic-queue":6,"./ext/array/every":8,"./ext/array/find":9,"./ext/array/map":10,"./ext/array/reduce":11,"./ext/array/some":12,"./ext/function/call-async":13,"./ext/function/delay":14,"./ext/function/gate":15,"./ext/function/promisify":17,"./ext/function/promisify-sync":16,"./ext/promise/aside":19,"./ext/promise/catch":20,"./ext/promise/cb":21,"./ext/promise/finally":22,"./ext/promise/get":23,"./ext/promise/invoke":25,"./ext/promise/invoke-async":24,"./ext/promise/map":26,"./ext/promise/reduce":27,"./ext/promise/some":28,"./ext/promise/spread":29,"./invoke-async":31,"./is-promise":32,"./monitor":34,"./profiler":35,"./valid-promise":36,"es5-ext/object/assign":59}],31:[function(e,t,r){"use strict";var o=e("es5-ext/object/is-callable"),i=e("es5-ext/object/valid-callable"),n=e("es5-ext/object/valid-value"),s=e("./ext/function/call-async")._base,a=Array.prototype.slice;t.exports=function(e,t){return n(e),o(t)||(t=i(e[t])),s(t,null,e,a.call(arguments,2))}},{"./ext/function/call-async":13,"es5-ext/object/is-callable":64,"es5-ext/object/valid-callable":71,"es5-ext/object/valid-value":73}],32:[function(e,t,r){"use strict";t.exports=function(e){return"function"==typeof e&&"function"==typeof e.then&&e.end!==e.done}},{}],33:[function(e,t,r){"use strict";var o=e("es5-ext/object/assign"),i=e("es5-ext/object/valid-value"),n=e("es5-ext/object/valid-callable"),s=e("../deferred"),a=e("../is-promise"),c=e("../assimilate"),u=Function.prototype.call,l=s.resolve;t.exports=function(e){var t=function(t,r,i){for(this.list=t,this.cb=r,this.context=i,this.length=t.length>>>0;this.current<this.length;){if(this.current in t)return o(this,s()),this.processCb=this.processCb.bind(this),this.processValue=this.processValue.bind(this),this["continue"](),this.promise;++this.current}return l(!e)};return t.prototype={current:0,state:!1,"continue":function(){for(var e;!this.state&&(e=this.process(),"cb"===this.state)&&(e=this.processCb(e),"value"===this.state);)this.processValue(e)},process:function(){var e=c(this.list[this.current]);if(a(e)){if(!e.resolved)return void e.done(function(e){e=this.processCb(e),"value"===this.state&&(this.processValue(e),this.state||this["continue"]())}.bind(this),this.reject);if(e.failed)return void this.reject(e.value);e=e.value}return this.state="cb",e},processCb:function(e){if(this.cb){try{e=u.call(this.cb,this.context,e,this.current,this.list)}catch(t){return void this.reject(t)}if(e=c(e),a(e)){if(!e.resolved)return void e.done(function(e){this.state="value",this.processValue(e),this.state||this["continue"]()}.bind(this),this.reject);if(e.failed)return void this.reject(e.value);e=e.value}}return this.state="value",e},processValue:function(t){if(Boolean(t)===e)return void this.resolve(e);for(;++this.current<this.length;)if(this.current in this.list)return void(this.state=!1);this.resolve(!e)}},function(e){return i(this),null==e||n(e),new t(this,e,arguments[1])}}},{"../assimilate":4,"../deferred":5,"../is-promise":32,"es5-ext/object/assign":59,"es5-ext/object/valid-callable":71,"es5-ext/object/valid-value":73}],34:[function(e,t,r){"use strict";var o=Math.max,i=e("es5-ext/object/valid-callable"),n=e("es5-ext/object/is-callable"),s=e("es5-ext/number/to-pos-integer"),a=e("./deferred");r=t.exports=function(e,t){return e===!1?(delete a._monitor,delete r.timeout,void delete r.callback):(r.timeout=e=o(s(e)||5e3,50),null==t?"undefined"!=typeof console&&console&&n(console.error)&&(t=function(e){console.error(e.stack&&e.stack.toString()||"Unresolved promise: no stack available")}):i(t),r.callback=t,void(a._monitor=function(){var r=new Error("Unresolved promise");return setTimeout(function(){t&&t(r)},e)}))}},{"./deferred":5,"es5-ext/number/to-pos-integer":57,"es5-ext/object/is-callable":64,"es5-ext/object/valid-callable":71}],35:[function(e,t,r){"use strict";var o,i,n,s,a,c=e("es5-ext/function/#/partial"),u=e("es5-ext/object/for-each"),l=e("es5-ext/string/#/pad"),p=e("./deferred");r.profile=function(){o=0,i={},n=0,s={},p._profile=a},a=function(e){var t,r;e?(++o,r=i):(++n,r=s),t=(new Error).stack,t.split("\n").slice(3).some(function(e){return-1===e.search(/[\/\\]deferred[\/\\]/)&&-1===e.search(/[\/\\]es5-ext[\/\\]/)&&-1===e.indexOf(" (native)")?(e=e.replace(/\n/g,"\\n").trim(),r[e]||(r[e]={count:0}),++r[e].count,!0):void 0})||(r.unknown||(r.unknown={count:0,stack:t}),++r.unknown.count)},r.profileEnd=function(){var e,t,r="";if(!p._profile)throw new Error("Deferred profiler was not initialized");return delete p._profile,r+="------------------------------------------------------------\n",r+="Deferred usage statistics:\n\n",e=String(o+n),t=c.call(l," ",e.length),r+=e+" Total promises initialized\n",r+=t.call(n)+" Initialized as Unresolved\n",r+=t.call(o)+" Initialized as Resolved\n",n&&(r+="\nUnresolved promises were initialized at:\n",u(s,function(e,o){r+=t.call(e.count)+" "+o+"\n"},null,function(e,t){return this[t].count-this[e].count})),o&&(r+="\nResolved promises were initialized at:\n",u(i,function(e,o){r+=t.call(e.count)+" "+o+"\n"},null,function(e,t){return this[t].count-this[e].count})),r+="------------------------------------------------------------\n",{log:r,resolved:{count:o,stats:i},unresolved:{count:n,stats:s}}}},{"./deferred":5,"es5-ext/function/#/partial":45,"es5-ext/object/for-each":62,"es5-ext/string/#/pad":77}],36:[function(e,t,r){"use strict";var o=e("./is-promise");t.exports=function(e){if(!o(e))throw new TypeError(e+" is not a promise object");return e}},{"./is-promise":32}],37:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Array.from:e("./shim")},{"./is-implemented":38,"./shim":39}],38:[function(e,t,r){"use strict";t.exports=function(){var e,t,r=Array.from;return"function"!=typeof r?!1:(e=["raz","dwa"],t=r(e),Boolean(t&&t!==e&&"dwa"===t[1]))}},{}],39:[function(e,t,r){"use strict";var o=e("es6-symbol").iterator,i=e("../../function/is-arguments"),n=e("../../function/is-function"),s=e("../../number/to-pos-integer"),a=e("../../object/valid-callable"),c=e("../../object/valid-value"),u=e("../../string/is-string"),l=Array.isArray,p=Function.prototype.call,d={
configurable:!0,enumerable:!0,writable:!0,value:null},f=Object.defineProperty;t.exports=function(e){var t,r,y,h,g,b,m,v,j,x,w=arguments[1],O=arguments[2];if(e=Object(c(e)),null!=w&&a(w),this&&this!==Array&&n(this))t=this;else{if(!w){if(i(e))return g=e.length,1!==g?Array.apply(null,e):(h=new Array(1),h[0]=e[0],h);if(l(e)){for(h=new Array(g=e.length),r=0;g>r;++r)h[r]=e[r];return h}}h=[]}if(!l(e))if(void 0!==(j=e[o])){for(m=a(j).call(e),t&&(h=new t),v=m.next(),r=0;!v.done;)x=w?p.call(w,O,v.value,r):v.value,t?(d.value=x,f(h,r,d)):h[r]=x,v=m.next(),++r;g=r}else if(u(e)){for(g=e.length,t&&(h=new t),r=0,y=0;g>r;++r)x=e[r],g>r+1&&(b=x.charCodeAt(0),b>=55296&&56319>=b&&(x+=e[++r])),x=w?p.call(w,O,x,y):x,t?(d.value=x,f(h,y,d)):h[y]=x,++y;g=y}if(void 0===g)for(g=s(e.length),t&&(h=new t(g)),r=0;g>r;++r)x=w?p.call(w,O,e[r],r):e[r],t?(d.value=x,f(h,r,d)):h[r]=x;return t&&(d.value=null,h.length=g),h}},{"../../function/is-arguments":48,"../../function/is-function":49,"../../number/to-pos-integer":57,"../../object/valid-callable":71,"../../object/valid-value":73,"../../string/is-string":81,"es6-symbol":83}],40:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Array.of:e("./shim")},{"./is-implemented":41,"./shim":42}],41:[function(e,t,r){"use strict";t.exports=function(){var e,t=Array.of;return"function"!=typeof t?!1:(e=t("foo","bar"),Boolean(e&&"bar"===e[1]))}},{}],42:[function(e,t,r){"use strict";var o=e("../../function/is-function"),i=Array.prototype.slice,n=Object.defineProperty,s={configurable:!0,enumerable:!0,writable:!0,value:null};t.exports=function(){var e,t,r;if(!this||this===Array||!o(this))return i.call(arguments);for(e=new this(r=arguments.length),t=0;r>t;++t)s.value=arguments[t],n(e,t,s);return s.value=null,e.length=r,e}},{"../../function/is-function":49}],43:[function(e,t,r){"use strict";var o=e("./from"),i=Array.isArray;t.exports=function(e){return i(e)?e:o(e)}},{"./from":37}],44:[function(e,t,r){"use strict";var o=Object.prototype.toString,i=o.call(new Error);t.exports=function(e){return e&&(e instanceof Error||o.call(e)===i)||!1}},{}],45:[function(e,t,r){"use strict";var o=e("../../object/valid-callable"),i=e("../../array/from"),n=e("../_define-length"),s=Function.prototype.apply;t.exports=function(){var e=o(this),t=i(arguments);return n(function(){return s.call(e,this,t.concat(i(arguments)))},e.length-t.length)}},{"../../array/from":37,"../../object/valid-callable":71,"../_define-length":47}],46:[function(e,t,r){"use strict";var o=e("../../object/valid-callable"),i=Function.prototype.apply;t.exports=function(){var e=o(this);return function(t){return i.call(e,this,t)}}},{"../../object/valid-callable":71}],47:[function(e,t,r){"use strict";var o,i,n,s,a=e("../number/to-pos-integer"),c=function(e,t){};try{Object.defineProperty(c,"length",{configurable:!0,writable:!1,enumerable:!1,value:1})}catch(u){}1===c.length?(o={configurable:!0,writable:!1,enumerable:!1},i=Object.defineProperty,t.exports=function(e,t){return t=a(t),e.length===t?e:(o.value=t,i(e,"length",o))}):(s=e("../object/mixin"),n=function(){var e=[];return function(t){var r,o=0;if(e[t])return e[t];for(r=[];t--;)r.push("a"+(++o).toString(36));return new Function("fn","return function ("+r.join(", ")+") { return fn.apply(this, arguments); };")}}(),t.exports=function(e,t){var r;if(t=a(t),e.length===t)return e;r=n(t)(e);try{s(r,e)}catch(o){}return r})},{"../number/to-pos-integer":57,"../object/mixin":69}],48:[function(e,t,r){"use strict";var o=Object.prototype.toString,i=o.call(function(){return arguments}());t.exports=function(e){return o.call(e)===i}},{}],49:[function(e,t,r){"use strict";var o=Object.prototype.toString,i=o.call(e("./noop"));t.exports=function(e){return"function"==typeof e&&o.call(e)===i}},{"./noop":50}],50:[function(e,t,r){"use strict";t.exports=function(){}},{}],51:[function(e,t,r){"use strict";var o=e("es6-symbol").iterator,i=e("../object/is-array-like");t.exports=function(e){return null==e?!1:"function"==typeof e[o]?!0:i(e)}},{"../object/is-array-like":63,"es6-symbol":83}],52:[function(e,t,r){"use strict";var o=e("../object/is-object"),i=e("./is");t.exports=function(e){if(i(e)&&o(e))return e;throw new TypeError(e+" is not an iterable or array-like object")}},{"../object/is-object":65,"./is":51}],53:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Math.sign:e("./shim")},{"./is-implemented":54,"./shim":55}],54:[function(e,t,r){"use strict";t.exports=function(){var e=Math.sign;return"function"!=typeof e?!1:1===e(10)&&-1===e(-20)}},{}],55:[function(e,t,r){"use strict";t.exports=function(e){return e=Number(e),isNaN(e)||0===e?e:e>0?1:-1}},{}],56:[function(e,t,r){"use strict";var o=e("../math/sign"),i=Math.abs,n=Math.floor;t.exports=function(e){return isNaN(e)?0:(e=Number(e),0!==e&&isFinite(e)?o(e)*n(i(e)):e)}},{"../math/sign":53}],57:[function(e,t,r){"use strict";var o=e("./to-integer"),i=Math.max;t.exports=function(e){return i(0,o(e))}},{"./to-integer":56}],58:[function(e,t,r){"use strict";var o=e("./valid-callable"),i=e("./valid-value"),n=Function.prototype.bind,s=Function.prototype.call,a=Object.keys,c=Object.prototype.propertyIsEnumerable;t.exports=function(e,t){return function(r,u){var l,p=arguments[2],d=arguments[3];return r=Object(i(r)),o(u),l=a(r),d&&l.sort("function"==typeof d?n.call(d,r):void 0),"function"!=typeof e&&(e=l[e]),s.call(e,l,function(e,o){return c.call(r,e)?s.call(u,p,r[e],e,r,o):t})}}},{"./valid-callable":71,"./valid-value":73}],59:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.assign:e("./shim")},{"./is-implemented":60,"./shim":61}],60:[function(e,t,r){"use strict";t.exports=function(){var e,t=Object.assign;return"function"!=typeof t?!1:(e={foo:"raz"},t(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},{}],61:[function(e,t,r){"use strict";var o=e("../keys"),i=e("../valid-value"),n=Math.max;t.exports=function(e,t){var r,s,a,c=n(arguments.length,2);for(e=Object(i(e)),a=function(o){try{e[o]=t[o]}catch(i){r||(r=i)}},s=1;c>s;++s)t=arguments[s],o(t).forEach(a);if(void 0!==r)throw r;return e}},{"../keys":66,"../valid-value":73}],62:[function(e,t,r){"use strict";t.exports=e("./_iterate")("forEach")},{"./_iterate":58}],63:[function(e,t,r){"use strict";var o=e("../function/is-function"),i=e("./is-object");t.exports=function(e){return null!=e&&"number"==typeof e.length&&(i(e)&&!o(e)||"string"==typeof e)||!1}},{"../function/is-function":49,"./is-object":65}],64:[function(e,t,r){"use strict";t.exports=function(e){return"function"==typeof e}},{}],65:[function(e,t,r){"use strict";var o={"function":!0,object:!0};t.exports=function(e){return null!=e&&o[typeof e]||!1}},{}],66:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.keys:e("./shim")},{"./is-implemented":67,"./shim":68}],67:[function(e,t,r){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},{}],68:[function(e,t,r){"use strict";var o=Object.keys;t.exports=function(e){return o(null==e?e:Object(e))}},{}],69:[function(e,t,r){"use strict";var o=e("./valid-value"),i=Object.defineProperty,n=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames;t.exports=function(e,t){var r;if(e=Object(o(e)),s(Object(o(t))).forEach(function(o){try{i(e,o,n(t,o))}catch(s){r=s}}),void 0!==r)throw r;return e}},{"./valid-value":73}],70:[function(e,t,r){"use strict";var o=Array.prototype.forEach,i=Object.create,n=function(e,t){var r;for(r in e)t[r]=e[r]};t.exports=function(e){var t=i(null);return o.call(arguments,function(e){null!=e&&n(Object(e),t)}),t}},{}],71:[function(e,t,r){"use strict";t.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},{}],72:[function(e,t,r){"use strict";var o=e("./is-object");t.exports=function(e){if(!o(e))throw new TypeError(e+" is not an Object");return e}},{"./is-object":65}],73:[function(e,t,r){"use strict";t.exports=function(e){if(null==e)throw new TypeError("Cannot use null or undefined");return e}},{}],74:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?String.prototype.contains:e("./shim")},{"./is-implemented":75,"./shim":76}],75:[function(e,t,r){"use strict";var o="razdwatrzy";t.exports=function(){return"function"!=typeof o.contains?!1:o.contains("dwa")===!0&&o.contains("foo")===!1}},{}],76:[function(e,t,r){"use strict";var o=String.prototype.indexOf;t.exports=function(e){return o.call(this,e,arguments[1])>-1}},{}],77:[function(e,t,r){"use strict";var o=e("../../number/to-integer"),i=e("../../object/valid-value"),n=e("./repeat"),s=Math.abs,a=Math.max;t.exports=function(e){var t=String(i(this)),r=t.length,c=arguments[1];return c=isNaN(c)?1:o(c),e=n.call(String(e),s(c)),c>=0?e.slice(0,a(0,c-r))+t:t+(r+c>=0?"":e.slice(c+r))}},{"../../number/to-integer":56,"../../object/valid-value":73,"./repeat":78}],78:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?String.prototype.repeat:e("./shim")},{"./is-implemented":79,"./shim":80}],79:[function(e,t,r){"use strict";var o="foo";t.exports=function(){return"function"!=typeof o.repeat?!1:"foofoo"===o.repeat(2)}},{}],80:[function(e,t,r){"use strict";var o=e("../../../object/valid-value"),i=e("../../../number/to-integer");t.exports=function(e){var t,r=String(o(this));if(e=i(e),0>e)throw new RangeError("Count must be >= 0");if(!isFinite(e))throw new RangeError("Count must be < ∞");if(t="",!e)return t;for(;;){if(1&e&&(t+=r),e>>>=1,0>=e)break;r+=r}return t}},{"../../../number/to-integer":56,"../../../object/valid-value":73}],81:[function(e,t,r){"use strict";var o=Object.prototype.toString,i=o.call("");t.exports=function(e){return"string"==typeof e||e&&"object"==typeof e&&(e instanceof String||o.call(e)===i)||!1}},{}],82:[function(t,r,o){(function(o,i){(function(){"use strict";function n(e){return"function"==typeof e||"object"==typeof e&&null!==e}function s(e){return"function"==typeof e}function a(e){H=e}function c(e){Y=e}function u(){return function(){o.nextTick(y)}}function l(){return function(){W(y)}}function p(){var e=0,t=new re(y),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function d(){var e=new MessageChannel;return e.port1.onmessage=y,function(){e.port2.postMessage(0)}}function f(){return function(){setTimeout(y,1)}}function y(){for(var e=0;X>e;e+=2){var t=ne[e],r=ne[e+1];t(r),ne[e]=void 0,ne[e+1]=void 0}X=0}function h(){try{var e=t,r=e("vertx");return W=r.runOnLoop||r.runOnContext,l()}catch(o){return f()}}function g(e,t){var r=this,o=new this.constructor(m);void 0===o[ce]&&q(o);var i=r._state;if(i){var n=arguments[i-1];Y(function(){P(i,o,n,r._result)})}else _(r,o,e,t);return o}function b(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(m);return I(r,e),r}function m(){}function v(){return new TypeError("You cannot resolve a promise with itself")}function j(){return new TypeError("A promises callback cannot return that same promise.")}function x(e){try{return e.then}catch(t){return de.error=t,de}}function w(e,t,r,o){try{e.call(t,r,o)}catch(i){return i}}function O(e,t,r){Y(function(e){var o=!1,i=w(r,t,function(r){o||(o=!0,t!==r?I(e,r):S(e,r))},function(t){o||(o=!0,C(e,t))},"Settle: "+(e._label||" unknown promise"));!o&&i&&(o=!0,C(e,i))},e)}function T(e,t){t._state===le?S(e,t._result):t._state===pe?C(e,t._result):_(t,void 0,function(t){I(e,t)},function(t){C(e,t)})}function k(e,t,r){t.constructor===e.constructor&&r===se&&constructor.resolve===ae?T(e,t):r===de?C(e,de.error):void 0===r?S(e,t):s(r)?O(e,t,r):S(e,t)}function I(e,t){e===t?C(e,v()):n(t)?k(e,t,x(t)):S(e,t)}function L(e){e._onerror&&e._onerror(e._result),Z(e)}function S(e,t){e._state===ue&&(e._result=t,e._state=le,0!==e._subscribers.length&&Y(Z,e))}function C(e,t){e._state===ue&&(e._state=pe,e._result=t,Y(L,e))}function _(e,t,r,o){var i=e._subscribers,n=i.length;e._onerror=null,i[n]=t,i[n+le]=r,i[n+pe]=o,0===n&&e._state&&Y(Z,e)}function Z(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var o,i,n=e._result,s=0;s<t.length;s+=3)o=t[s],i=t[s+r],o?P(r,o,i,n):i(n);e._subscribers.length=0}}function A(){this.error=null}function D(e,t){try{return e(t)}catch(r){return fe.error=r,fe}}function P(e,t,r,o){var i,n,a,c,u=s(r);if(u){if(i=D(r,o),i===fe?(c=!0,n=i.error,i=null):a=!0,t===i)return void C(t,j())}else i=o,a=!0;t._state!==ue||(u&&a?I(t,i):c?C(t,n):e===le?S(t,i):e===pe&&C(t,i))}function E(e,t){try{t(function(t){I(e,t)},function(t){C(e,t)})}catch(r){C(e,r)}}function R(){return ye++}function q(e){e[ce]=ye++,e._state=void 0,e._result=void 0,e._subscribers=[]}function V(e){return new ve(this,e).promise}function F(e){var t=this;return new t(Q(e)?function(r,o){for(var i=e.length,n=0;i>n;n++)t.resolve(e[n]).then(r,o)}:function(e,t){t(new TypeError("You must pass an array to race."))})}function M(e){var t=this,r=new t(m);return C(r,e),r}function N(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function K(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function U(e){this[ce]=R(),this._result=this._state=void 0,this._subscribers=[],m!==e&&("function"!=typeof e&&N(),this instanceof U?E(this,e):K())}function B(e,t){this._instanceConstructor=e,this.promise=new e(m),this.promise[ce]||q(this.promise),Q(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&S(this.promise,this._result))):C(this.promise,z())}function z(){return new Error("Array Methods must be provided an Array")}function J(){var e;if("undefined"!=typeof i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var r=e.Promise;(!r||"[object Promise]"!==Object.prototype.toString.call(r.resolve())||r.cast)&&(e.Promise=me)}var G;G=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var W,H,$,Q=G,X=0,Y=function(e,t){ne[X]=e,ne[X+1]=t,X+=2,2===X&&(H?H(y):$())},ee="undefined"!=typeof window?window:void 0,te=ee||{},re=te.MutationObserver||te.WebKitMutationObserver,oe="undefined"==typeof self&&"undefined"!=typeof o&&"[object process]"==={}.toString.call(o),ie="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ne=new Array(1e3);$=oe?u():re?p():ie?d():void 0===ee&&"function"==typeof t?h():f();var se=g,ae=b,ce=Math.random().toString(36).substring(16),ue=void 0,le=1,pe=2,de=new A,fe=new A,ye=0,he=V,ge=F,be=M,me=U;U.all=he,U.race=ge,U.resolve=ae,U.reject=be,U._setScheduler=a,U._setAsap=c,U._asap=Y,U.prototype={constructor:U,then:se,"catch":function(e){return this.then(null,e)}};var ve=B;B.prototype._enumerate=function(){for(var e=this.length,t=this._input,r=0;this._state===ue&&e>r;r++)this._eachEntry(t[r],r)},B.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,o=r.resolve;if(o===ae){var i=x(e);if(i===se&&e._state!==ue)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(r===me){var n=new r(m);k(n,e,i),this._willSettleAt(n,t)}else this._willSettleAt(new r(function(t){t(e)}),t)}else this._willSettleAt(o(e),t)},B.prototype._settledAt=function(e,t,r){var o=this.promise;o._state===ue&&(this._remaining--,e===pe?C(o,r):this._result[t]=r),0===this._remaining&&S(o,this._result)},B.prototype._willSettleAt=function(e,t){var r=this;_(e,void 0,function(e){r._settledAt(le,t,e)},function(e){r._settledAt(pe,t,e)})};var je=J,xe={Promise:me,polyfill:je};"function"==typeof e&&e.amd?e(function(){return xe}):"undefined"!=typeof r&&r.exports?r.exports=xe:"undefined"!=typeof this&&(this.ES6Promise=xe),je()}).call(this)}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:91}],83:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Symbol:e("./polyfill")},{"./is-implemented":84,"./polyfill":86}],84:[function(e,t,r){"use strict";t.exports=function(){var e;if("function"!=typeof Symbol)return!1;e=Symbol("test symbol");try{String(e)}catch(t){return!1}return"symbol"==typeof Symbol.iterator?!0:"object"!=typeof Symbol.isConcatSpreadable?!1:"object"!=typeof Symbol.iterator?!1:"object"!=typeof Symbol.toPrimitive?!1:"object"!=typeof Symbol.toStringTag?!1:"object"!=typeof Symbol.unscopables?!1:!0}},{}],85:[function(e,t,r){"use strict";t.exports=function(e){return e&&("symbol"==typeof e||"Symbol"===e["@@toStringTag"])||!1}},{}],86:[function(e,t,r){"use strict";var o,i,n,s=e("d"),a=e("./validate-symbol"),c=Object.create,u=Object.defineProperties,l=Object.defineProperty,p=Object.prototype,d=c(null);"function"==typeof Symbol&&(o=Symbol);var f=function(){var e=c(null);return function(t){for(var r,o,i=0;e[t+(i||"")];)++i;return t+=i||"",e[t]=!0,r="@@"+t,l(p,r,s.gs(null,function(e){o||(o=!0,l(this,r,s(e)),o=!1)})),r}}();n=function(e){if(this instanceof n)throw new TypeError("TypeError: Symbol is not a constructor");return i(e)},t.exports=i=function y(e){var t;if(this instanceof y)throw new TypeError("TypeError: Symbol is not a constructor");return t=c(n.prototype),e=void 0===e?"":String(e),u(t,{__description__:s("",e),__name__:s("",f(e))})},u(i,{"for":s(function(e){return d[e]?d[e]:d[e]=i(String(e))}),keyFor:s(function(e){var t;a(e);for(t in d)if(d[t]===e)return t}),hasInstance:s("",o&&o.hasInstance||i("hasInstance")),isConcatSpreadable:s("",o&&o.isConcatSpreadable||i("isConcatSpreadable")),iterator:s("",o&&o.iterator||i("iterator")),match:s("",o&&o.match||i("match")),replace:s("",o&&o.replace||i("replace")),search:s("",o&&o.search||i("search")),species:s("",o&&o.species||i("species")),split:s("",o&&o.split||i("split")),toPrimitive:s("",o&&o.toPrimitive||i("toPrimitive")),toStringTag:s("",o&&o.toStringTag||i("toStringTag")),unscopables:s("",o&&o.unscopables||i("unscopables"))}),u(n.prototype,{constructor:s(i),toString:s("",function(){return this.__name__})}),u(i.prototype,{toString:s(function(){return"Symbol ("+a(this).__description__+")"}),valueOf:s(function(){return a(this)})}),l(i.prototype,i.toPrimitive,s("",function(){return a(this)})),l(i.prototype,i.toStringTag,s("c","Symbol")),l(n.prototype,i.toStringTag,s("c",i.prototype[i.toStringTag])),l(n.prototype,i.toPrimitive,s("c",i.prototype[i.toPrimitive]))},{"./validate-symbol":87,d:2}],87:[function(e,t,r){"use strict";var o=e("./is-symbol");t.exports=function(e){if(!o(e))throw new TypeError(e+" is not a symbol");return e}},{"./is-symbol":85}],88:[function(e,t,r){"use strict";var o,i,n,s,a,c,u,l=e("d"),p=e("es5-ext/object/valid-callable"),d=Function.prototype.apply,f=Function.prototype.call,y=Object.create,h=Object.defineProperty,g=Object.defineProperties,b=Object.prototype.hasOwnProperty,m={configurable:!0,enumerable:!1,writable:!0};o=function(e,t){var r;return p(t),b.call(this,"__ee__")?r=this.__ee__:(r=m.value=y(null),h(this,"__ee__",m),m.value=null),r[e]?"object"==typeof r[e]?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},i=function(e,t){var r,i;return p(t),i=this,o.call(this,e,r=function(){n.call(i,e,r),d.call(t,this,arguments)}),r.__eeOnceListener__=t,this},n=function(e,t){var r,o,i,n;if(p(t),!b.call(this,"__ee__"))return this;if(r=this.__ee__,!r[e])return this;if(o=r[e],"object"==typeof o)for(n=0;i=o[n];++n)(i===t||i.__eeOnceListener__===t)&&(2===o.length?r[e]=o[n?0:1]:o.splice(n,1));else(o===t||o.__eeOnceListener__===t)&&delete r[e];return this},s=function(e){var t,r,o,i,n;if(b.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==typeof i){for(r=arguments.length,n=new Array(r-1),t=1;r>t;++t)n[t-1]=arguments[t];for(i=i.slice(),t=0;o=i[t];++t)d.call(o,this,n)}else switch(arguments.length){case 1:f.call(i,this);break;case 2:f.call(i,this,arguments[1]);break;case 3:f.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,n=new Array(r-1),t=1;r>t;++t)n[t-1]=arguments[t];d.call(i,this,n)}},a={on:o,once:i,off:n,emit:s},c={on:l(o),once:l(i),off:l(n),emit:l(s)},u=g({},c),t.exports=r=function(e){return null==e?y(u):g(Object(e),c)},r.methods=a},{d:2,"es5-ext/object/valid-callable":71}],89:[function(e,t,r){"use strict";var o=e("es5-ext/object/for-each"),i=e("es5-ext/object/valid-object"),n=Array.prototype.apply,s=Object.defineProperty,a=Object.create,c=Object.prototype.hasOwnProperty,u={configurable:!0,enumerable:!1,writable:!0};t.exports=function(e,t){var r;return i(e)&&i(t),c.call(e,"__ee__")?(r=u.value=e.__ee__,c.call(t,"__ee__")?void(r!==t.__ee__&&(o(t.__ee__,function(e,t){return r[t]?void("object"==typeof r[t]?"object"==typeof e?n.apply(r[t],e):r[t].push(e):"object"==typeof e?(e.unshift(r[t]),r[t]=e):r[t]=[r[t],e]):void(r[t]=e)}),s(t,"__ee__",u),u.value=null)):(s(t,"__ee__",u),void(u.value=null))):c.call(t,"__ee__")?(u.value=t.__ee__,s(e,"__ee__",u),void(u.value=null)):(u.value=a(null),s(e,"__ee__",u),s(t,"__ee__",u),void(u.value=null))}},{"es5-ext/object/for-each":62,"es5-ext/object/valid-object":72}],90:[function(e,t,r){(function(e){"use strict";var r,o;r=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e},o=function(e){var t,o=document.createTextNode(""),i=0;return new e(function(){var e;if(t)return e=t,t=null,"function"==typeof e?void e():void e.forEach(function(e){e()})}).observe(o,{characterData:!0}),function(e){return r(e),t?void("function"==typeof t?t=[t,e]:t.push(e)):(t=e,void(o.data=i=++i%2))}},t.exports=function(){if("undefined"!=typeof e&&e&&"function"==typeof e.nextTick)return e.nextTick;if("object"==typeof document&&document){if("function"==typeof MutationObserver)return o(MutationObserver);if("function"==typeof WebKitMutationObserver)return o(WebKitMutationObserver)}return"function"==typeof setImmediate?function(e){setImmediate(r(e))}:"function"==typeof setTimeout?function(e){setTimeout(r(e),0)}:null}()}).call(this,e("_process"))},{_process:91}],91:[function(e,t,r){function o(){d&&l&&(d=!1,l.length?p=l.concat(p):f=-1,p.length&&i())}function i(){if(!d){var e=a(o);d=!0;for(var t=p.length;t;){for(l=p,p=[];++f<t;)l&&l[f].run();f=-1,t=p.length}l=null,d=!1,c(e)}}function n(e,t){this.fun=e,this.array=t}function s(){}var a,c,u=t.exports={};!function(){try{a=setTimeout}catch(e){a=function(){throw new Error("setTimeout is not defined")}}try{c=clearTimeout}catch(e){c=function(){throw new Error("clearTimeout is not defined")}}}();var l,p=[],d=!1,f=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];p.push(new n(e,t)),1!==p.length||d||a(i,0)},n.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=s,u.addListener=s,u.once=s,u.off=s,u.removeListener=s,u.removeAllListeners=s,u.emit=s,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],92:[function(t,r,o){!function(t){if("object"==typeof o)r.exports=t();else if("function"==typeof e&&e.amd)e(t);else{var i;try{i=window}catch(n){i=self}i.SparkMD5=t()}}(function(e){"use strict";function t(e,t,r,o,i,n){return t=v(v(t,e),v(o,n)),v(t<<i|t>>>32-i,r)}function r(e,r,o,i,n,s,a){return t(r&o|~r&i,e,r,n,s,a)}function o(e,r,o,i,n,s,a){return t(r&i|o&~i,e,r,n,s,a)}function i(e,r,o,i,n,s,a){return t(r^o^i,e,r,n,s,a)}function n(e,r,o,i,n,s,a){return t(o^(r|~i),e,r,n,s,a)}function s(e,t){var s=e[0],a=e[1],c=e[2],u=e[3];s=r(s,a,c,u,t[0],7,-680876936),u=r(u,s,a,c,t[1],12,-389564586),c=r(c,u,s,a,t[2],17,606105819),a=r(a,c,u,s,t[3],22,-1044525330),s=r(s,a,c,u,t[4],7,-176418897),u=r(u,s,a,c,t[5],12,1200080426),c=r(c,u,s,a,t[6],17,-1473231341),a=r(a,c,u,s,t[7],22,-45705983),s=r(s,a,c,u,t[8],7,1770035416),u=r(u,s,a,c,t[9],12,-1958414417),c=r(c,u,s,a,t[10],17,-42063),a=r(a,c,u,s,t[11],22,-1990404162),s=r(s,a,c,u,t[12],7,1804603682),u=r(u,s,a,c,t[13],12,-40341101),c=r(c,u,s,a,t[14],17,-1502002290),a=r(a,c,u,s,t[15],22,1236535329),s=o(s,a,c,u,t[1],5,-165796510),u=o(u,s,a,c,t[6],9,-1069501632),c=o(c,u,s,a,t[11],14,643717713),a=o(a,c,u,s,t[0],20,-373897302),s=o(s,a,c,u,t[5],5,-701558691),u=o(u,s,a,c,t[10],9,38016083),c=o(c,u,s,a,t[15],14,-660478335),a=o(a,c,u,s,t[4],20,-405537848),s=o(s,a,c,u,t[9],5,568446438),u=o(u,s,a,c,t[14],9,-1019803690),c=o(c,u,s,a,t[3],14,-187363961),a=o(a,c,u,s,t[8],20,1163531501),s=o(s,a,c,u,t[13],5,-1444681467),u=o(u,s,a,c,t[2],9,-51403784),c=o(c,u,s,a,t[7],14,1735328473),a=o(a,c,u,s,t[12],20,-1926607734),s=i(s,a,c,u,t[5],4,-378558),u=i(u,s,a,c,t[8],11,-2022574463),c=i(c,u,s,a,t[11],16,1839030562),a=i(a,c,u,s,t[14],23,-35309556),s=i(s,a,c,u,t[1],4,-1530992060),u=i(u,s,a,c,t[4],11,1272893353),c=i(c,u,s,a,t[7],16,-155497632),a=i(a,c,u,s,t[10],23,-1094730640),s=i(s,a,c,u,t[13],4,681279174),u=i(u,s,a,c,t[0],11,-358537222),c=i(c,u,s,a,t[3],16,-722521979),a=i(a,c,u,s,t[6],23,76029189),s=i(s,a,c,u,t[9],4,-640364487),u=i(u,s,a,c,t[12],11,-421815835),c=i(c,u,s,a,t[15],16,530742520),a=i(a,c,u,s,t[2],23,-995338651),s=n(s,a,c,u,t[0],6,-198630844),u=n(u,s,a,c,t[7],10,1126891415),c=n(c,u,s,a,t[14],15,-1416354905),a=n(a,c,u,s,t[5],21,-57434055),s=n(s,a,c,u,t[12],6,1700485571),u=n(u,s,a,c,t[3],10,-1894986606),c=n(c,u,s,a,t[10],15,-1051523),a=n(a,c,u,s,t[1],21,-2054922799),s=n(s,a,c,u,t[8],6,1873313359),u=n(u,s,a,c,t[15],10,-30611744),c=n(c,u,s,a,t[6],15,-1560198380),a=n(a,c,u,s,t[13],21,1309151649),s=n(s,a,c,u,t[4],6,-145523070),u=n(u,s,a,c,t[11],10,-1120210379),c=n(c,u,s,a,t[2],15,718787259),a=n(a,c,u,s,t[9],21,-343485551),e[0]=v(s,e[0]),e[1]=v(a,e[1]),e[2]=v(c,e[2]),e[3]=v(u,e[3])}function a(e){var t,r=[];for(t=0;64>t;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function c(e){var t,r=[];for(t=0;64>t;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function u(e){var t,r,o,i,n,c,u=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;u>=t;t+=64)s(l,a(e.substring(t-64,t)));for(e=e.substring(t-64),r=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;r>t;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(s(l,o),t=0;16>t;t+=1)o[t]=0;return i=8*u,i=i.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(i[2],16),c=parseInt(i[1],16)||0,o[14]=n,o[15]=c,s(l,o),l}function l(e){var t,r,o,i,n,a,u=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;u>=t;t+=64)s(l,c(e.subarray(t-64,t)));for(e=u>t-64?e.subarray(t-64):new Uint8Array(0),r=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;r>t;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(s(l,o),t=0;16>t;t+=1)o[t]=0;return i=8*u,i=i.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(i[2],16),a=parseInt(i[1],16)||0,o[14]=n,o[15]=a,s(l,o),l}function p(e){var t,r="";for(t=0;4>t;t+=1)r+=j[e>>8*t+4&15]+j[e>>8*t&15];return r}function d(e){var t;for(t=0;t<e.length;t+=1)e[t]=p(e[t]);return e.join("")}function f(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function y(e,t){var r,o=e.length,i=new ArrayBuffer(o),n=new Uint8Array(i);for(r=0;o>r;r+=1)n[r]=e.charCodeAt(r);return t?n:i}function h(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function g(e,t,r){var o=new Uint8Array(e.byteLength+t.byteLength);return o.set(new Uint8Array(e)),o.set(new Uint8Array(t),e.byteLength),r?o:o.buffer}function b(e){var t,r=[],o=e.length;for(t=0;o-1>t;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function m(){this.reset()}var v=function(e,t){return e+t&4294967295},j=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==d(u("hello"))&&(v=function(e,t){var r=(65535&e)+(65535&t),o=(e>>16)+(t>>16)+(r>>16);return o<<16|65535&r}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function t(e,t){return e=0|e||0,0>e?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,o){var i,n,s,a,c=this.byteLength,u=t(r,c),l=c;return o!==e&&(l=t(o,c)),u>l?new ArrayBuffer(0):(i=l-u,n=new ArrayBuffer(i),s=new Uint8Array(n),a=new Uint8Array(this,u,i),s.set(a),n)}}(),m.prototype.append=function(e){return this.appendBinary(f(e)),this},m.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,r=this._buff.length;for(t=64;r>=t;t+=64)s(this._hash,a(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},m.prototype.end=function(e){var t,r,o=this._buff,i=o.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;i>t;t+=1)n[t>>2]|=o.charCodeAt(t)<<(t%4<<3);return this._finish(n,i),r=d(this._hash),e&&(r=b(r)),this.reset(),r},m.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},m.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},m.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},m.prototype._finish=function(e,t){var r,o,i,n=t;if(e[n>>2]|=128<<(n%4<<3),n>55)for(s(this._hash,e),n=0;16>n;n+=1)e[n]=0;r=8*this._length,r=r.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(r[2],16),i=parseInt(r[1],16)||0,e[14]=o,e[15]=i,s(this._hash,e)},m.hash=function(e,t){return m.hashBinary(f(e),t)},m.hashBinary=function(e,t){var r=u(e),o=d(r);return t?b(o):o},m.ArrayBuffer=function(){this.reset()},m.ArrayBuffer.prototype.append=function(e){var t,r=g(this._buff.buffer,e,!0),o=r.length;for(this._length+=e.byteLength,t=64;o>=t;t+=64)s(this._hash,c(r.subarray(t-64,t)));return this._buff=o>t-64?new Uint8Array(r.buffer.slice(t-64)):new Uint8Array(0),this},m.ArrayBuffer.prototype.end=function(e){var t,r,o=this._buff,i=o.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;i>t;t+=1)n[t>>2]|=o[t]<<(t%4<<3);return this._finish(n,i),r=d(this._hash),e&&(r=b(r)),this.reset(),r},m.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.ArrayBuffer.prototype.getState=function(){var e=m.prototype.getState.call(this);return e.buff=h(e.buff),e},m.ArrayBuffer.prototype.setState=function(e){return e.buff=y(e.buff,!0),m.prototype.setState.call(this,e)},m.ArrayBuffer.prototype.destroy=m.prototype.destroy,m.ArrayBuffer.prototype._finish=m.prototype._finish,m.ArrayBuffer.hash=function(e,t){var r=l(new Uint8Array(e)),o=d(r);return t?b(o):o},m})},{}],93:[function(t,r,o){"use strict";!function(t,o){"function"==typeof e&&e.amd?e([],o):"object"==typeof r&&r.exports?r.exports=o():t.striptags=o()}(this,function(){function e(e,a){function c(e){f==r?h+=e:a&&f==o&&(g+=e)}function u(){var e,t,r,o="",i=!1;e:for(e=0,t=g.length;t>e;e++)switch(r=g[e].toLowerCase()){case"<":break;case">":break e;case"/":i=!0;break;default:if(r.match(s)){if(i)break e}else i=!0,o+=r}-1!==a.indexOf(o)&&(h+=g),g=""}var l,p,d,e=e||"",f=r,y=0,h="",g="",b=!1;for("string"==typeof a?a=t(a):Array.isArray(a)||(a=null),l=0,p=e.length;p>l;l++)switch(d=e[l]){case"<":if(b)break;if(" "==e[l+1]){c(d);break}if(f==r){f=o,c(d);break}if(f==o){y++;break}c(d);break;case">":if(y){y--;break}if(b)break;if(f==o){b=f=0,a&&(g+=">",u());break}if(f==i){b=f=0,g="";break}if(f==n&&"-"==e[l-1]&&"-"==e[l-2]){b=f=0,g="";break}c(d);break;case'"':case"'":f==o&&(b==d?b=!1:b||(b=d)),c(d);break;case"!":if(f==o&&"<"==e[l-1]){f=i;break}c(d);break;case"-":if(f==i&&"-"==e[l-1]&&"!"==e[l-2]){f=n;break}c(d);break;case"E":case"e":if(f==i&&"doctype"==e.substr(l-6,7).toLowerCase()){f=o;break}c(d);break;default:c(d)}return h}function t(e){for(var t,r=[];null!==(t=a.exec(e));)r.push(t[1]);return 0!==r.length?r:null}var r=0,o=1,i=2,n=3,s=/\s/,a=/<(\w*)>/g;return e})},{}],94:[function(e,t,r){"use strict";t.exports=2147483647},{}],95:[function(e,t,r){"use strict";var o=e("es5-ext/number/to-pos-integer"),i=e("./max-timeout");
t.exports=function(e){if(e=o(e),e>i)throw new TypeError(e+" exceeds maximum possible timeout");return e}},{"./max-timeout":94,"es5-ext/number/to-pos-integer":57}],96:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Ajax"),i=e("./Validator.js"),n={};n.errorCallback=function(e){o.debug("ajax error callback",2),o.debug("textStatus: "+e.textStatus,2),o.debug("errorThrown: ",2),o.debug(e.errorThrown,2),o.debug(e.jqxhr,2)},n.error=n.errorCallback,n.activeRequests=[],n.apiRequestUrl=function(e){if(o.debug("Zotero.Ajax.apiRequestUrl",3),o.debug(e,4),Object.keys(e).forEach(function(t){var r=e[t];"string"==typeof r&&(r=r.split("#",1),e[t]=r[0]),i.validate(r,t)===!1&&(o.warn("API argument failed validation: "+t+" cannot be "+r),o.warn(e),delete e[t])}),!e.target)throw new Error("No target defined for api request");if("user"!=e.libraryType&&"group"!=e.libraryType&&""!==e.libraryType)throw new Error("Unexpected libraryType for api request "+JSON.stringify(e));if(e.libraryType&&!e.libraryID)throw new Error("No libraryID defined for api request");if("publications"==e.target&&"user"!=e.libraryType)throw new Error("publications is only valid for user libraries");var t,r=Zotero.config.baseApiUrl;if(""!==e.libraryType){if(t=r+"/"+e.libraryType+"s/"+e.libraryID,e.collectionKey){if("trash"==e.collectionKey)return t+="/items/trash";-1!==e.collectionKey.indexOf(",")||"collections"!=e.target&&(t+="/collections/"+e.collectionKey)}}else t=r;switch(e.target){case"items":t+="/items";break;case"item":t+=e.itemKey?"/items/"+e.itemKey:"/items";break;case"collections":t+="/collections";break;case"childCollections":t+="/collections";break;case"collection":break;case"tags":t+="/tags";break;case"children":t+="/items/"+e.itemKey+"/children";break;case"key":t=r+"/keys/"+e.apiKey;break;case"deleted":t+="/deleted";break;case"userGroups":t=r+"/users/"+e.libraryID+"/groups";break;case"settings":t+="/settings/"+(e.settingsKey||"");break;case"publications":t+="/publications/items";break;default:return!1}switch(e.targetModifier){case"top":t+="/top";break;case"file":t+="/file";break;case"viewsnapshot":t+="/file/view"}return t},n.apiQueryString=function(e){if(o.debug("Zotero.Ajax.apiQueryString",4),o.debug(e,4),Object.keys(e).forEach(function(t){var r=e[t];"string"==typeof r&&(r=r.split("#",1),e[t]=r[0])}),e.hasOwnProperty("order")&&"creatorSummary"==e.order&&(e.order="creator"),e.hasOwnProperty("order")&&"year"==e.order&&(e.order="date"),Zotero.config.sessionAuth){var t=Zotero.utils.readCookie(Zotero.config.sessionCookieName);e.session=t}e.hasOwnProperty("sort")&&"undefined"==e.sort&&(e.sort="asc"),o.debug(e,4);var r="?",i=[],n=["start","limit","order","sort","content","include","format","q","fq","itemType","itemKey","collectionKey","searchKey","locale","tag","tagType","key","style","linkMode","linkwrap","session","newer","since"];n.sort();var s={};return n.forEach(function(t){e.hasOwnProperty(t)&&""!==e[t]&&(s[t]=e[t])}),e.hasOwnProperty("target")&&"items"!==e.target&&s.hasOwnProperty("itemKey")&&-1==s.itemKey.indexOf(",")&&delete s.itemKey,e.hasOwnProperty("target")&&"collections"!==e.target&&s.hasOwnProperty("collectionKey")&&-1===s.collectionKey.indexOf(",")&&delete s.collectionKey,Object.keys(s).forEach(function(e){var t=s[e];Array.isArray(t)?t.forEach(function(t){"tag"==e&&"-"==t[0]&&(t="\\"+t),i.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}):("tag"==e&&"-"==t[0]&&(t="\\"+t),i.push(encodeURIComponent(e)+"="+encodeURIComponent(t)))}),r+=i.join("&")},n.apiRequestString=function(e){return n.apiRequestUrl(e)+n.apiQueryString(e)},n.proxyWrapper=function(e,t){return Zotero.config.proxy?(t||(t="GET"),Zotero.config.proxyPath+"?requestMethod="+t+"&requestUrl="+encodeURIComponent(e)):e},n.downloadBlob=function(e){return new Promise(function(t,r){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.addEventListener("load",function(){200===i.status?(o.debug("downloadBlob Image retrieved. resolving",3),t(i.response)):r(i.response)}),i.send()})},t.exports=n},{"./Log.js":119,"./Validator.js":131}],97:[function(e,t,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};e("./Log.js").Logger("libZotero:ApiObject");t.exports=function(){this.instance="Zotero.ApiObject",this.version=0},t.exports.prototype.associateWithLibrary=function(e){var t=this;return t.owningLibrary=e,"object"==o(this.apiObj.library)&&(this.apiObj.library.type=e.type,this.apiObj.library.id=e.libraryID),t},t.exports.prototype.fieldComparer=function(e){if(Intl){var t=new Intl.Collator;return function(r,o){return t.compare(r.apiObj.data[e],o.apiObj.data[e])}}return function(t,r){return t.apiObj.data[e].toLowerCase()==r.apiObj.data[e].toLowerCase()?0:t.apiObj.data[e].toLowerCase()<r.apiObj.data[e].toLowerCase()?-1:1}}},{"./Log.js":119}],98:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:ApiResponse");t.exports=function(e){o.debug("Zotero.ApiResponse",3),this.totalResults=0,this.apiVersion=null,this.lastModifiedVersion=0,this.linkHeader="",this.links={},e&&(e.isError?this.isError=!0:this.isError=!1,this.data=e.data,this.parseResponse(e))},t.exports.prototype.parseResponse=function(e){o.debug("parseResponse",3);var t=this;if(t.jqxhr=e.jqxhr,t.status=e.jqxhr.status,t.lastModifiedVersion=e.jqxhr.getResponseHeader("Last-Modified-Version"),t.apiVersion=e.jqxhr.getResponseHeader("Zotero-API-Version"),t.backoff=e.jqxhr.getResponseHeader("Backoff"),t.retryAfter=e.jqxhr.getResponseHeader("Retry-After"),t.contentType=e.jqxhr.getResponseHeader("Content-Type"),t.linkHeader=e.jqxhr.getResponseHeader("Link"),t.totalResults=e.jqxhr.getResponseHeader("Total-Results"),t.backoff&&(t.backoff=parseInt(t.backoff,10)),t.retryAfter&&(t.retryAfter=parseInt(t.retryAfter,10)),o.debug("parse link header",4),o.debug(t.linkHeader,4),t.linkHeader){for(var r=t.linkHeader.split(","),i={},n=/^<([^>]+)>; rel="([^\"]*)"$/,s=0;s<r.length;s++){var a=n.exec(r[s].trim());a[2]&&(i[a[2]]=a[1])}t.parsedLinks=i}}},{"./Log.js":119}],99:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Cache");t.exports=function(e){this.store=e;var t=this.store._registry;(null===t||"undefined"==typeof t)&&(t={},this.store._registry=JSON.stringify(t))},t.exports.prototype.objectCacheString=function(e){var t=[];Object.keys(e).forEach(function(r){var o=e[r];o&&(Array.isArray(o)?o.forEach(function(e){t.push(r+"/"+encodeURIComponent(e))}):t.push(r+"/"+encodeURIComponent(o)))}),t.sort(),o.debug(t,4);var r=t.join("/");return r},t.exports.prototype.save=function(e,t,r){Array.isArray(r)||(r=[]);var o=JSON.parse(this.store._registry);o||(o={});var i=this.objectCacheString(e);this.store[i]=JSON.stringify(t);var n={id:i,saved:Date.now(),cachetags:r};o[i]=n,this.store._registry=JSON.stringify(o)},t.exports.prototype.load=function(e){o.debug("Zotero.Cache.load",3);var t=this.objectCacheString(e);o.debug(t,4);try{var r=this.store[t];return r?JSON.parse(r):(o.warn("No value found in cache store - "+t,3),null)}catch(i){return o.error("Error parsing retrieved cache data: "+t+" : "+r),null}},t.exports.prototype.expireCacheTag=function(e){o.debug("Zotero.Cache.expireCacheTag",3);var t=JSON.parse(this.store._registry),r=this.store;Object.keys(t).forEach(function(i){var n=t[i];-1!=n.cachetags.indexOf(e)&&(o.debug("tag "+e+" found for item "+n.id+" : expiring",4),delete r[n.id],delete t[n.id])})},t.exports.prototype.clear=function(){"function"==typeof this.store.clear?this.store.clear():this.store={}}},{"./Log.js":119}],100:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Client"),i=e("./Fetcher.js"),n=function(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];this._apiKey=t,this.net=e("./Net.js")};n.prototype.getUserGroups=function(e){var t={target:"userGroups",libraryType:"user",libraryID:e,order:"title"};return this._apiKey&&(t.key=this._apiKey),Zotero.ajaxRequest(t).then(function(e){o.debug("fetchUserGroups proxied callback",3);var t=e.data,r=t.map(function(e){return new Zotero.Group(e)}),i=r.addGroupsFromJson(e.data);return e.fetchedGroups=i,e})},n.prototype.getUserPublications=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];o.debug("Zotero.Client.loadPublications",3);var r={target:"publications",start:0,limit:50,order:Zotero.config.defaultSortColumn,sort:Zotero.config.defaultSortOrder,include:"bib"},n=Z.extend({},r,t,{target:"publications",libraryType:"user",libraryID:e}),s=new i(n);return s.fetchAll().then(function(e){return e.map(function(e){return new Zotero.Item(e)})})},n.prototype.getKeyPermissions=function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];if(!e)return!1;var t={target:"key",apiKey:e,libraryType:""};return Zotero.ajaxRequest(t).then(function(e){var t=JSON.parse(e.data);return t})},n.prototype.deleteKey=function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return e?this.net.ajax():!1},t.exports=n},{"./Fetcher.js":108,"./Log.js":119,"./Net.js":120}],101:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Collection");t.exports=function(e){this.instance="Zotero.Collection",this.libraryUrlIdentifier="",this.itemKeys=!1,this.key="",this.version=0,this.synced=!1,this.pristineData=null,this.apiObj={key:"",version:0,library:{},links:{},meta:{},data:{key:"",version:0,name:"",parentCollection:!1,relations:{}}},this.children=[],this.topLevel=!0,e&&this.parseJsonCollection(e)},t.exports.prototype=new Zotero.ApiObject,t.exports.prototype.instance="Zotero.Collection",t.exports.prototype.updateObjectKey=function(e){this.updateCollectionKey(e)},t.exports.prototype.updateCollectionKey=function(e){var t=this;return t.key=e,t.apiObj.key=e,t.apiObj.data.key=e,t},t.exports.prototype.parseJsonCollection=function(e){o.debug("parseJsonCollection",4);var t=this;t.key=e.key,t.version=e.version,t.apiObj=Z.extend({},e),t.pristineData=Z.extend({},e.data),t.parentCollection=!1,t.topLevel=!0,t.synced=!0,t.initSecondaryData()},t.exports.prototype.initSecondaryData=function(){var e=this;e.apiObj.data.parentCollection?e.topLevel=!1:e.topLevel=!0,Zotero.config.librarySettings.libraryPathString?e.websiteCollectionLink=Zotero.config.librarySettings.libraryPathString+"/collectionKey/"+e.apiObj.key:e.websiteCollectionLink="",e.hasChildren=e.apiObj.meta.numCollections?!0:!1},t.exports.prototype.nestCollection=function(e){o.debug("Zotero.Collection.nestCollection",4);var t=this,r=t.get("parentCollection");if(r!==!1&&e.hasOwnProperty(r)){var i=e[r];return i.children.push(t),i.hasChildren=!0,t.topLevel=!1,!0}return!1},t.exports.prototype.addItems=function(e){o.debug("Zotero.Collection.addItems",3);var t=this,r={target:"items",libraryType:t.apiObj.library.type,libraryID:t.apiObj.library.id,collectionKey:t.key},i=e.join(" ");return Zotero.ajaxRequest(r,"POST",{data:i})},t.exports.prototype.getMemberItemKeys=function(){o.debug("Zotero.Collection.getMemberItemKeys",3);var e=this,t={target:"items",libraryType:e.apiObj.library.type,libraryID:e.apiObj.library.id,collectionKey:e.key,format:"keys"};return Zotero.ajaxRequest(t,"GET",{processData:!1}).then(function(t){o.debug("getMemberItemKeys proxied callback",3);var r=t.data,i=r.trim().split(/[\s]+/);return e.itemKeys=i,i})},t.exports.prototype.removeItem=function(e){var t=this,r={target:"item",libraryType:t.apiObj.library.type,libraryID:t.apiObj.library.id,collectionKey:t.key,itemKey:e};return Zotero.ajaxRequest(r,"DELETE",{processData:!1,cache:!1})},t.exports.prototype.update=function(e,t){var r=this;t||(t=!1);var o={target:"collection",libraryType:r.apiObj.library.type,libraryID:r.apiObj.library.id,collectionKey:r.key};r.set("name",e),r.set("parentCollection",t);var i=r.writeApiObj(),n=JSON.stringify(i);return Zotero.ajaxRequest(o,"PUT",{data:n,processData:!1,headers:{"If-Unmodified-Since-Version":r.version},cache:!1})},t.exports.prototype.writeApiObj=function(){var e=this,t=Z.extend({},e.pristineData,e.apiObj.data);return t},t.exports.prototype.remove=function(){o.debug("Zotero.Collection.delete",3);var e=this,t=e.owningLibrary,r={target:"collection",libraryType:e.apiObj.library.type,libraryID:e.apiObj.library.id,collectionKey:e.key};return Zotero.ajaxRequest(r,"DELETE",{processData:!1,headers:{"If-Unmodified-Since-Version":e.version},cache:!1}).then(function(){o.debug("done deleting collection. remove local copy.",3),t.collections.removeLocalCollection(e.key),t.trigger("libraryCollectionsUpdated")})},t.exports.prototype.get=function(e){var t=this;switch(e){case"title":case"name":return t.apiObj.data.name;case"collectionKey":case"key":return t.apiObj.key||t.key;case"collectionVersion":case"version":return t.apiObj.version;case"parentCollection":return t.apiObj.data.parentCollection}return e in t.apiObj.data?t.apiObj.data[e]:t.apiObj.meta.hasOwnProperty(e)?t.apiObj.meta[e]:t.hasOwnProperty(e)?t[e]:null},t.exports.prototype.set=function(e,t){var r=this;switch(e in r.apiObj.data&&(r.apiObj.data[e]=t),e){case"title":case"name":r.apiObj.data.name=t;break;case"collectionKey":case"key":r.key=t,r.apiObj.key=t,r.apiObj.data.key=t;break;case"parentCollection":r.apiObj.data.parentCollection=t;break;case"collectionVersion":case"version":r.version=t,r.apiObj.version=t,r.apiObj.data.version=t}r.hasOwnProperty(e)&&(r[e]=t)}},{"./Log.js":119}],102:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Collections");t.exports=function(e){this.instance="Zotero.Collections",this.version=0,this.syncState={earliestVersion:null,latestVersion:null},this.collectionObjects={},this.collectionsArray=[],this.objectMap=this.collectionObjects,this.objectArray=this.collectionsArray,this.dirty=!1,this.loaded=!1,e&&(this.addCollectionsFromJson(e),this.initSecondaryData())},t.exports.prototype=new Zotero.Container,t.exports.prototype.initSecondaryData=function(){o.debug("Zotero.Collections.initSecondaryData",3);var e=this;e.collectionsArray=[],Object.keys(e.collectionObjects).forEach(function(t){var r=e.collectionObjects[t];e.collectionsArray.push(r)}),e.collectionsArray.sort(Zotero.ApiObject.prototype.fieldComparer("name")),e.nestCollections(),e.assignDepths(0,e.collectionsArray)},t.exports.prototype.addCollection=function(e){return this.addObject(e),this},t.exports.prototype.addCollectionsFromJson=function(e){o.debug("addCollectionsFromJson",3);var t=this,r=[];return e.forEach(function(e){var o=new Zotero.Collection(e);t.addObject(o),r.push(o)}),r},t.exports.prototype.assignDepths=function(e,t){o.debug("Zotero.Collections.assignDepths",3);var r=this,i=function n(e,t){t.forEach(function(t){t.nestingDepth=e,t.hasChildren&&n(e+1,t.children)})};r.collectionsArray.forEach(function(e){e.topLevel&&(e.nestingDepth=1,e.hasChildren&&i(2,e.children))})},t.exports.prototype.nestedOrderingArray=function(){o.debug("Zotero.Collections.nestedOrderingArray",3);var e=this,t=[],r=function i(e,t){t.forEach(function(t){e.push(t),t.hasChildren&&i(e,t.children)})};return e.collectionsArray.forEach(function(e){e.topLevel&&(t.push(e),e.hasChildren&&r(t,e.children))}),o.debug("Done with nestedOrderingArray",3),t},t.exports.prototype.getCollection=function(e){return this.getObject(e)},t.exports.prototype.remoteDeleteCollection=function(e){var t=this;return t.removeLocalCollection(e)},t.exports.prototype.removeLocalCollection=function(e){var t=this;return t.removeLocalCollections([e])},t.exports.prototype.removeLocalCollections=function(e){for(var t=this,r=0;r<e.length;r++)delete t.collectionObjects[e[r]];t.initSecondaryData()},t.exports.prototype.nestCollections=function(){var e=this;e.collectionsArray.forEach(function(e){e.children=[]}),e.collectionsArray.sort(Zotero.ApiObject.prototype.fieldComparer("name")),e.collectionsArray.forEach(function(t){t.nestCollection(e.collectionObjects)})},t.exports.prototype.writeCollections=function(e){o.debug("Zotero.Collections.writeCollections",3);var t,r=this,i=r.owningLibrary,n={target:"collections",libraryType:r.owningLibrary.libraryType,libraryID:r.owningLibrary.libraryID};for(t=0;t<e.length;t++){var s=e[t],a=s.get("key");if(""===a||null===a){var c=Zotero.utils.getKey();s.set("key",c),s.set("version",0)}}var u=r.chunkObjectsArray(e),l=r.rawChunks(u),p=function(e){o.debug("writeCollections successCallback",3);var t=this.library,r=this.writeChunk;t.collections.updateObjectsFromWriteResponse(this.writeChunk,e);for(var i=0;i<r.length;i++){var n=r[i];n.synced&&!n.writeFailure&&(t.collections.addCollection(n),Zotero.config.useIndexedDB&&(o.debug("updating indexedDB collections"),t.idbLibrary.updateCollections(r)))}return e.returnCollections=r,e};o.debug("collections.version: "+r.version,3),o.debug("collections.libraryVersion: "+r.libraryVersion,3);var d=[];for(t=0;t<u.length;t++){var f={writeChunk:u[t],library:i},y=JSON.stringify(l[t]);d.push({url:n,type:"POST",data:y,processData:!1,headers:{},success:p.bind(f)})}return i.sequentialRequests(d).then(function(e){return o.debug("Done with writeCollections sequentialRequests promise",3),r.initSecondaryData(),e.forEach(function(e){if(e.isError||e.data.hasOwnProperty("failed")&&Object.keys(e.data.failed).length>0)throw new Error("failure when writing collections")}),e})["catch"](function(e){throw o.error(e),e})}},{"./Log.js":119}],103:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Container");t.exports=function(){},t.exports.prototype.initSecondaryData=function(){},t.exports.prototype.addObject=function(e){o.debug("Zotero.Container.addObject",4);var t=this;return t.objectArray.push(e),t.objectMap[e.key]=e,t.owningLibrary&&e.associateWithLibrary(t.owningLibrary),t},t.exports.prototype.fieldComparer=function(e){if(Intl){var t=new Intl.Collator;return function(r,o){return t.compare(r.apiObj.data[e],o.apiObj.data[e])}}return function(t,r){return t.apiObj.data[e].toLowerCase()==r.apiObj.data[e].toLowerCase()?0:t.apiObj.data[e].toLowerCase()<r.apiObj.data[e].toLowerCase()?-1:1}},t.exports.prototype.getObject=function(e){var t=this;return t.objectMap.hasOwnProperty(e)?t.objectMap[e]:!1},t.exports.prototype.getObjects=function(e){for(var t,r=this,o=[],i=0;i<e.length;i++)t=r.getObject(e[i]),t&&o.push(t);return o},t.exports.prototype.removeObject=function(e){var t=this;t.objectMap.hasOwnProperty(e)&&(delete t.objectmap[e],t.initSecondaryData())},t.exports.prototype.removeObjects=function(e){for(var t=this,r=0;r<e.length;r++)delete t.objectMap[e[r]];t.initSecondaryData()},t.exports.prototype.writeObjects=function(e){},t.exports.prototype.assignKeys=function(e){for(var t,r=0;r<e.length;r++){t=e[r];var o=t.get("key");if(!o){var i=Zotero.utils.getKey();t.set("key",i),t.set("version",0)}}return e},t.exports.prototype.chunkObjectsArray=function(e){for(var t=50,r=[],o=0;o<e.length;o+=t)r.push(e.slice(o,o+t));return r},t.exports.prototype.rawChunks=function(e){for(var t=[],r=0;r<e.length;r++){t[r]=[];for(var o=0;o<e[r].length;o++)t[r].push(e[r][o].writeApiObj())}return t},t.exports.prototype.updateSyncState=function(e){var t=this;if(o.debug("updateSyncState: "+e,3),!t.hasOwnProperty("syncState"))throw o.debug("no syncState property"),new Error("Attempt to update sync state of object with no syncState property");null===t.syncState.earliestVersion&&(t.syncState.earliestVersion=e),null===t.syncState.latestVersion&&(t.syncState.latestVersion=e),e<t.syncState.earliestVersion&&(t.syncState.earliestVersion=e),e>t.syncState.latestVersion&&(t.syncState.latestVersion=e),o.debug("done updating sync state",3)},t.exports.prototype.updateSyncedVersion=function(e){var t=this;null!==t.syncState.earliestVersion&&t.syncState.earliestVersion==t.syncState.latestVersion?(t.version=t.syncState.latestVersion,t.synced=!0):null!==t.syncState.earliestVersion&&(t.version=t.syncState.earliestVersion)},t.exports.prototype.processDeletions=function(e){for(var t=this,r=0;r<e.length;r++){var o=t.get(e[r]);o!==!1&&o.synced===!0&&t.removeObjects([e[r]])}},t.exports.prototype.updateObjectsFromWriteResponse=function(e,t){o.debug("Zotero.Container.updateObjectsFromWriteResponse",3),o.debug("statusCode: "+t.status,3);var r=t.data;200==t.status?(o.debug("newLastModifiedVersion: "+t.lastModifiedVersion,3),r.hasOwnProperty("success")&&Object.keys(r.success).forEach(function(o){var i=parseInt(o,10),n=r.success[o],s=e[i];if(""!==s.key&&s.key!==n)throw new Error("object key mismatch in multi-write response");""===s.key&&s.updateObjectKey(n),s.set("version",t.lastModifiedVersion),s.synced=!0,s.writeFailure=!1}),r.hasOwnProperty("failed")&&(o.debug("updating objects with failed writes",3),Object.keys(r.failed).forEach(function(t){var i=r.failed[t];o.error("failed write "+t+" - "+i);var n=parseInt(t,10),s=e[n];s.writeFailure=i}))):204==t.status&&(e[0].synced=!0)},t.exports.prototype.extractKey=function(e){return"string"==typeof e?e:e.get("key")}},{"./Log.js":119}],104:[function(e,t,r){"use strict";var o={librarySettings:{},baseApiUrl:"https://api.zotero.org",baseWebsiteUrl:"https://zotero.org",baseFeedUrl:"https://api.zotero.org",baseZoteroWebsiteUrl:"https://www.zotero.org",baseDownloadUrl:"https://www.zotero.org",nonparsedBaseUrl:"",debugLogEndpoint:"",storeDebug:!0,directDownloads:!0,proxyPath:"/proxyrequest",ignoreLoggedInStatus:!1,storePrefsRemote:!0,preferUrlItem:!0,sessionAuth:!1,proxy:!1,apiKey:"",apiVersion:3,locale:"en-US",cacheStoreType:"localStorage",preloadCachedLibrary:!0,sortOrdering:{dateAdded:"desc",dateModified:"desc",date:"desc",year:"desc",accessDate:"desc",title:"asc",creator:"asc"},defaultSortColumn:"title",defaultSortOrder:"asc",largeFields:{title:1,abstractNote:1,extra:1},richTextFields:{note:1},maxFieldSummaryLength:{title:60},exportFormats:["bibtex","bookmarks","mods","refer","rdf_bibliontology","rdf_dc","rdf_zotero","ris","wikipedia"],exportFormatsMap:{bibtex:"BibTeX",bookmarks:"Bookmarks",mods:"MODS",refer:"Refer/BibIX",rdf_bibliontology:"Bibliontology RDF",rdf_dc:"Unqualified Dublin Core RDF",rdf_zotero:"Zotero RDF",ris:"RIS",wikipedia:"Wikipedia Citation Templates"},defaultApiArgs:{order:"title",sort:"asc",limit:50,start:0}};t.exports=o},{}],105:[function(e,t,r){"use strict";e("./Log.js").Logger("libZotero:Deleted");t.exports=function(e){this.instance="Zotero.Deleted","string"==typeof e?this.deletedData=JSON.parse(e):this.deletedData=e,this.untilVersion=null,this.sinceVersion=null,this.waitingPromises=[],this.pending=!1},t.exports.prototype.addWaiter=function(){}},{"./Log.js":119}],106:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Events"),i=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];r&&(o.debug("filter is not false",3),e+="_"+r),o.debug("Triggering eventful "+e,3),t.zeventful=!0;try{if(Zotero.eventmanager.callbacks.hasOwnProperty(e)){var i=Zotero.eventmanager.callbacks[e];i.forEach(function(e){var r=Z.extend({},t,e.data),o={data:r};e.f(o)})}}catch(n){o.error("failed triggering:"+e),o.error(n)}},n=function(e,t,r,i){o.debug("Zotero.listen: "+e,3);var n=e.split(" ");if(n.length>0&&i)for(var s=0;s<n.length;s++)n[s]+="_"+i;n.forEach(function(e){Zotero.eventmanager.callbacks.hasOwnProperty(e)?Zotero.eventmanager.callbacks[e].push({data:r,f:t}):Zotero.eventmanager.callbacks[e]=[{data:r,f:t}]})};t.exports={trigger:i,listen:n}},{"./Log.js":119}],107:[function(e,t,r){"use strict";var o=function(){return Object.assign.apply(Object,arguments)};t.exports=o},{}],108:[function(e,t,r){"use strict";var o=(e("./Log.js").Logger("libZotero:Fetcher"),function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t={start:0,limit:25};this.config=Z.extend({},t,e),this.hasMore=!0,this.results=[],this.totalResults=null,this.resultInfo={}});o.prototype.next=function(){var e=this;if(0==this.hasMore)return Promise.resolve(null);var t=Z.extend({},this.config),r=Zotero.net.queueRequest({url:t});r.then(function(t){return t.parsedLinks.hasOwnProperty("next")?e.hasMore=!0:e.hasMore=!1,e.results=e.results.concat(t.data),e.totalResults=t.totalResults,t});var o=Z.extend({},t);return o.start=o.start+o.limit,this.config=o,r},o.prototype.fetchAll=function(){var e=this,t=[],r=function o(){return e.hasMore?e.next().then(function(e){t=t.concat(e.data)}).then(o):Promise.resolve(t)};return r()},t.exports=o},{"./Log.js":119}],109:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:File"),i=e("spark-md5");t.exports={},t.exports.getFileInfo=function(e){return"undefined"==typeof FileReader?Promise.reject(new Error("FileReader not supported")):new Promise(function(t,r){var n={},s=new FileReader;s.onload=function(r){o.debug("Zotero.file.getFileInfo onloadFunc",3);var s=r.target.result;o.debug(s,3),n.md5=i.ArrayBuffer.hash(s),n.filename=e.name,n.filesize=e.size,n.mtime=Date.now(),n.contentType=e.type,n.filedata=s,t(n)},s.readAsArrayBuffer(e)})},t.exports.uploadFile=function(e,t){o.debug("Zotero.file.uploadFile",3),o.debug(e,4);var r=new FormData;Object.keys(e.params).forEach(function(t){var o=e.params[t];r.append(t,o)});var i=new Blob([t.filedata],{type:t.contentType});r.append("file",i);var n=new XMLHttpRequest;return n.open("POST",e.url,!0),new Promise(function(e,t){n.onload=function(r){o.debug("uploadFile onload event",3),201==this.status?(o.debug("successful upload - 201",3),e()):(o.error("uploadFile failed - "+n.status),t({message:"Failure uploading file.",code:n.status,serverMessage:n.responseText}))},n.onprogress=function(e){o.debug("progress event"),o.debug(e)},n.send(r)})}},{"./Log.js":119,"spark-md5":92}],110:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Group");t.exports=function(e){var t=this;t.instance="Zotero.Group",e&&this.parseJsonGroup(e)},t.exports.prototype=new Zotero.ApiObject,t.exports.prototype.parseJsonGroup=function(e){var t=this;t.apiObj=e},t.exports.prototype.get=function(e){var t=this;switch(e){case"title":case"name":return t.apiObj.data.name;case"members":return t.apiObj.data.members?t.apiObj.data.members:[];case"admins":return t.apiObj.data.admins?t.apiObj.data.admins:[]}return e in t.apiObj?t.apiObj[e]:e in t.apiObj.data?t.apiObj.data[e]:e in t.apiObj.meta?t.apiObj.meta[e]:t.hasOwnProperty(e)?t[e]:null},t.exports.prototype.isWritable=function(e){var t=this;o.debug(t);var r=t.apiObj.data.admins;switch(r||(r=[]),!0){case t.get("owner")==e:return!0;case-1!=r.indexOf(e):return!0;case"members"==t.apiObj.data.libraryEditing&&t.apiObj.data.members&&-1!=t.apiObj.data.members.indexOf(e):return!0;default:return!1}},t.exports.prototype.typeMap={Private:"Private",PublicOpen:"Public, Open Membership",PublicClosed:"Public, Closed Membership"},t.exports.prototype.accessMap={all:{members:"Anyone can view, only members can edit",admins:"Anyone can view, only admins can edit"},members:{members:"Only members can view and edit",admins:"Only members can view, only admins can edit"},admins:{members:"Only admins can view, only members can edit",admins:"Only admins can view and edit"}}},{"./Log.js":119}],111:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Groups");t.exports=function(){this.instance="Zotero.Groups",this.groupsArray=[]},t.exports.prototype.addGroupsFromJson=function(e){var t=this,r=[];return e.forEach(function(e){o.debug(e,3);var i=new Zotero.Group(e);t.groupsArray.push(i),r.push(i)}),r},t.exports.prototype.fetchUserGroups=function(e,t){var r=this,i={target:"userGroups",libraryType:"user",libraryID:e,order:"title"};return t?i.key=t:r.owningLibrary&&(i.key=r.owningLibrary._apiKey),Zotero.ajaxRequest(i).then(function(e){o.debug("fetchUserGroups proxied callback",3);var t=r.addGroupsFromJson(e.data);return e.fetchedGroups=t,e})}},{"./Log.js":119}],112:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Idb");t.exports={},t.exports.Library=function(e){o.debug("Zotero.Idb.Library",3),o.debug("Initializing Zotero IDB",3),this.libraryString=e,this.owningLibrary=null,this.initialized=!1},t.exports.Library.prototype.init=function(){var e=this;return new Promise(function(t,r){var i=window.indexedDB;e.indexedDB=i,o.debug("requesting indexedDb from browser",3);var n=i.open("Zotero_"+e.libraryString,4);n.onerror=function(e){o.error("ERROR OPENING INDEXED DB"),r()};var s=function(t){o.debug("Zotero.Idb onupgradeneeded or onsuccess",3);var r=t.oldVersion;o.debug("oldVersion: "+t.oldVersion,3);var i=t.target.result;if(e.db=i,4>r){o.debug("Existing object store names:",3),o.debug(JSON.stringify(i.objectStoreNames),3),o.debug("Deleting old object stores",3),i.objectStoreNames.items&&i.deleteObjectStore("items"),i.objectStoreNames.tags&&i.deleteObjectStore("tags"),i.objectStoreNames.collections&&i.deleteObjectStore("collections"),i.objectStoreNames.files&&i.deleteObjectStore("files"),i.objectStoreNames.versions&&i.deleteObjectStore("versions"),o.debug("Existing object store names:",3),o.debug(JSON.stringify(i.objectStoreNames),3);var n=i.createObjectStore("items",{keyPath:"key"}),s=i.createObjectStore("collections",{keyPath:"key"}),a=i.createObjectStore("tags",{keyPath:"tag"});i.createObjectStore("files"),i.createObjectStore("versions");o.debug("itemStore index names:",3),o.debug(JSON.stringify(n.indexNames),3),o.debug("collectionStore index names:",3),o.debug(JSON.stringify(s.indexNames),3),o.debug("tagStore index names:",3),o.debug(JSON.stringify(a.indexNames),3),Object.keys(Zotero.Item.prototype.fieldMap).forEach(function(e){o.debug("Creating index on "+e,3),n.createIndex(e,"data."+e,{unique:!1})}),n.createIndex("collectionKeys","data.collections",{unique:!1,multiEntry:!0}),n.createIndex("itemTagStrings","_supplement.tagstrings",{unique:!1,multiEntry:!0}),n.createIndex("parentItemKey","data.parentItem",{unique:!1}),n.createIndex("libraryKey","libraryKey",{unique:!1}),n.createIndex("deleted","data.deleted",{unique:!1}),s.createIndex("name","data.name",{unique:!1}),s.createIndex("key","key",{unique:!1}),s.createIndex("parentCollection","data.parentCollection",{unique:!1}),a.createIndex("tag","tag",{unique:!1})}};n.onupgradeneeded=s,n.onsuccess=function(){o.debug("IDB success",3),e.db=n.result,e.initialized=!0,t(e)}})},t.exports.Library.prototype.deleteDB=function(){var e=this;return e.db.close(),new Promise(function(t,r){var i=e.indexedDB.deleteDatabase("Zotero_"+e.libraryString);i.onerror=function(){o.error("Error deleting indexedDB"),r()},i.onsuccess=function(){o.debug("Successfully deleted indexedDB",2),t()}})},t.exports.Library.prototype.getObjectStore=function(e,t){var r=this,o=r.db.transaction(e,t);return o.objectStore(e)},t.exports.Library.prototype.clearObjectStore=function(e){var t=this,r=t.getObjectStore(e,"readwrite");return new Promise(function(e,t){var i=r.clear();i.onsuccess=function(t){o.debug("Store cleared",3),e()},i.onerror=function(e){o.error("clearObjectStore:",e.target.errorCode),t()}})},t.exports.Library.prototype.addItems=function(e){return this.addObjects(e,"item")},t.exports.Library.prototype.updateItems=function(e){return this.updateObjects(e,"item")},t.exports.Library.prototype.removeItems=function(e){return this.removeObjects(e,"item")},t.exports.Library.prototype.getItem=function(e){var t=this;return new Promise(function(r,o){var i=function(e){r(e.target.result)};t.db.transaction("items").objectStore(["items"],"readonly").get(e).onsuccess=i})},t.exports.Library.prototype.getAllItems=function(){return this.getAllObjects("item")},t.exports.Library.prototype.getOrderedItemKeys=function(e,t){var r=this;return o.debug("Zotero.Idb.getOrderedItemKeys",3),o.debug(""+e+" "+t,3),new Promise(function(i,n){var s=r.db.transaction(["items"],"readonly").objectStore("items"),a=s.index(e);if(!a)throw new Error("Index for requested field '"+e+"'' not found");var c="next";"desc"==t&&(c="prev");var u=a.openKeyCursor(null,c),l=[];u.onsuccess=function(e){var t=e.target.result;t?(l.push(t.primaryKey),t["continue"]()):(o.debug("No more cursor: done. Resolving deferred.",3),i(l))}.bind(this),u.onfailure=function(e){n()}.bind(this)})},t.exports.Library.prototype.filterItems=function(e,t){var r=this;return o.debug("Zotero.Idb.filterItems "+e+" - "+t,3),
new Promise(function(i,n){var s=[],a=r.db.transaction(["items"],"readonly").objectStore("items"),c=a.index(e);if(!c)throw new Error("Index for requested field '"+e+"'' not found");var u="next",l=IDBKeyRange.only(t),p=c.openKeyCursor(l,u);p.onsuccess=function(e){var t=e.target.result;t?(s.push(t.primaryKey),t["continue"]()):(o.debug("No more cursor: done. Resolving deferred.",3),i(s))}.bind(this),p.onfailure=function(e){n()}.bind(this)})},t.exports.Library.prototype.inferType=function(e){if(!e)return!1;if(!e.instance)return!1;switch(e.instance){case"Zotero.Item":return"item";case"Zotero.Collection":return"collection";case"Zotero.Tag":return"tag";default:return!1}},t.exports.Library.prototype.getTransactionAndStore=function(e,t){var r,o,i=this;switch(e){case"item":r=i.db.transaction(["items"],t),o=r.objectStore("items");break;case"collection":r=i.db.transaction(["collections"],t),o=r.objectStore("collections");break;case"tag":r=i.db.transaction(["tags"],t),o=r.objectStore("tags");break;default:return Promise.reject()}return[r,o]},t.exports.Library.prototype.addObjects=function(e,t){o.debug("Zotero.Idb.Library.addObjects",3);var r=this;t||(t=r.inferType(e[0]));var i=r.getTransactionAndStore(t,"readwrite"),n=i[0],s=i[1];return new Promise(function(t,r){n.oncomplete=function(e){o.debug("Add Objects transaction completed.",3),t()},n.onerror=function(e){o.error("Add Objects transaction failed."),r()};var i=function(e){o.debug("Added Object "+e.target.result,4)};for(var a in e){var c=s.add(e[a].apiObj);c.onsuccess=i}})},t.exports.Library.prototype.updateObjects=function(e,t){o.debug("Zotero.Idb.Library.updateObjects",3);var r=this;t||(t=r.inferType(e[0]));var i=r.getTransactionAndStore(t,"readwrite"),n=i[0],s=i[1];return new Promise(function(t,r){n.oncomplete=function(e){o.debug("Update Objects transaction completed.",3),t()},n.onerror=function(e){o.error("Update Objects transaction failed."),r()};var i=function(e){o.debug("Updated Object "+e.target.result,4)};for(var a in e){var c=s.put(e[a].apiObj);c.onsuccess=i}})},t.exports.Library.prototype.removeObjects=function(e,t){var r=this;t||(t=r.inferType(e[0]));var i=r.getTransactionAndStore(t,"readwrite"),n=i[0],s=i[1];return new Promise(function(t,r){n.oncomplete=function(e){o.debug("Remove Objects transaction completed.",3),t()},n.onerror=function(e){o.error("Remove Objects transaction failed."),r()};var i=function(e){o.debug("Removed Object "+e.target.result,4)};for(var a in e){var c=s["delete"](e[a].key);c.onsuccess=i}})},t.exports.Library.prototype.getAllObjects=function(e){var t=this;return new Promise(function(r,o){var i=[],n=t.db.transaction(e+"s").objectStore(e+"s");n.openCursor().onsuccess=function(e){var t=e.target.result;t?(i.push(t.value),t["continue"]()):r(i)}})},t.exports.Library.prototype.addCollections=function(e){return this.addObjects(e,"collection")},t.exports.Library.prototype.updateCollections=function(e){return o.debug("Zotero.Idb.Library.updateCollections",3),this.updateObjects(e,"collection")},t.exports.Library.prototype.getCollection=function(e){var t=this;return new Promise(function(r,o){var i=function(e){r(e.target.result)};t.db.transaction("collections").objectStore(["collections"],"readonly").get(e).onsuccess=i})},t.exports.Library.prototype.removeCollections=function(e){return o.debug("Zotero.Idb.Library.removeCollections",3),this.removeObjects(e,"collection")},t.exports.Library.prototype.getAllCollections=function(){return o.debug("Zotero.Idb.Library.getAllCollections",3),this.getAllObjects("collection")},t.exports.Library.prototype.addTags=function(e){return this.addObjects(e,"tag")},t.exports.Library.prototype.updateTags=function(e){return o.debug("Zotero.Idb.Library.updateTags",3),this.updateObjects(e,"tag")},t.exports.Library.prototype.getAllTags=function(){return o.debug("getAllTags",3),this.getAllObjects("tag")},t.exports.Library.prototype.setVersion=function(e,t){o.debug("Zotero.Idb.Library.setVersion",3);var r=this;return new Promise(function(i,n){var s=r.db.transaction(["versions"],"readwrite");s.oncomplete=function(e){o.debug("set version transaction completed.",3),i()},s.onerror=function(e){o.error("set version transaction failed."),n()};var a=s.objectStore("versions"),c=function(e){o.debug("Set Version"+e.target.result,3)},u=a.put(t,e);u.onsuccess=c})},t.exports.Library.prototype.getVersion=function(e){o.debug("Zotero.Idb.Library.getVersion",3);var t=this;return new Promise(function(r,i){var n=function(e){o.debug("done getting version"),r(e.target.result)};t.db.transaction(["versions"],"readonly").objectStore("versions").get(e).onsuccess=n})},t.exports.Library.prototype.setFile=function(e,t){o.debug("Zotero.Idb.Library.setFile",3);var r=this;return new Promise(function(i,n){var s=r.db.transaction(["files"],"readwrite");s.oncomplete=function(e){o.debug("set file transaction completed.",3),i()},s.onerror=function(e){o.error("set file transaction failed."),n()};var a=s.objectStore("files"),c=function(e){o.debug("Set File"+e.target.result,3)},u=a.put(t,e);u.onsuccess=c})},t.exports.Library.prototype.getFile=function(e){o.debug("Zotero.Idb.Library.getFile",3);var t=this;return new Promise(function(r,i){var n=function(e){o.debug("done getting file"),r(e.target.result)};t.db.transaction(["files"],"readonly").objectStore("files").get(e).onsuccess=n})},t.exports.Library.prototype.deleteFile=function(e){o.debug("Zotero.Idb.Library.deleteFile",3);var t=this;return new Promise(function(r,i){var n=t.db.transaction(["files"],"readwrite");n.oncomplete=function(e){o.debug("delete file transaction completed.",3),r()},n.onerror=function(e){o.error("delete file transaction failed."),i()};var s=n.objectStore("files"),a=function(e){o.debug("Deleted File"+e.target.result,4)},c=s["delete"](e);c.onsuccess=a})},t.exports.Library.prototype.intersect=function(e,t){for(var r=[],o=0;o<e.length;o++)-1!==t.indexOf(e[o])&&r.push(e[o]);return r},t.exports.Library.prototype.intersectAll=function(e){for(var t=this,r=e[0],o=0;o<e.length-1;o++)r=t.intersect(r,e[o+1]);return r}},{"./Log.js":119}],113:[function(e,t,r){"use strict";var o=function(){var e;e="localStorage"==Zotero.config.cacheStoreType&&"undefined"!=typeof localStorage?localStorage:"sessionStorage"==Zotero.config.cacheStoreType&&"undefined"!=typeof sessionStorage?sessionStorage:{},Zotero.store=e,Zotero.cache=new Zotero.Cache(e),Zotero.preferences=new Zotero.Preferences(Zotero.store,"global")};t.exports=o},{}],114:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Item"),i=e("striptags"),n=e("./ItemMaps.js"),s=function(e){this.instance="Zotero.Item",this.version=0,this.key="",this.synced=!1,this.apiObj={},this.pristineData=null,this.childItemKeys=[],this.writeErrors=[],this.notes=[],e?this.parseJsonItem(e):this.parseJsonItem(this.emptyJsonItem()),this.initSecondaryData()};s.prototype=new Zotero.ApiObject,s.prototype.parseJsonItem=function(e){var t=this;t.version=e.version,t.key=e.key,t.apiObj=Z.extend({},e),t.pristineData=Z.extend({},e.data),t.apiObj._supplement||(t.apiObj._supplement={})},s.prototype.emptyJsonItem=function(){return{key:"",version:0,library:{},links:{},data:{key:"",version:0,title:"",creators:[],collections:[],tags:[],relations:{}},meta:{},_supplement:{}}},s.prototype.initSecondaryData=function(){var e=this;e.version=e.apiObj.version,"attachment"==e.apiObj.data.itemType&&(e.mimeType=e.apiObj.data.contentType,e.translatedMimeType=Zotero.utils.translateMimeType(e.mimeType)),"linkMode"in e.apiObj&&(e.linkMode=e.apiObj.data.linkMode),e.attachmentDownloadUrl=Zotero.url.attachmentDownloadUrl(e),e.apiObj.meta.parsedDate?e.parsedDate=new Date(e.apiObj.meta.parsedDate):e.parsedDate=!1,e.synced=!1,e.updateTagStrings()},s.prototype.updateTagStrings=function(){for(var e=this,t=[],r=0;r<e.apiObj.data.tags.length;r++)t.push(e.apiObj.data.tags[r].tag);e.apiObj._supplement.tagstrings=t},s.prototype.initEmpty=function(e,t){var r=this;return r.getItemTemplate(e,t).then(function(e){return r.initEmptyFromTemplate(e),r})},s.prototype.initEmptyNote=function(){var e=this;e.version=0;var t={itemType:"note",note:"",tags:[],collections:[],relations:{}};return e.initEmptyFromTemplate(t),e},s.prototype.initEmptyFromTemplate=function(e){var t=this;return t.version=0,t.key="",t.pristineData=Z.extend({},e),t.apiObj={key:"",version:0,library:{},links:{},data:e,meta:{},_supplement:{}},t.initSecondaryData(),t},s.prototype.isSupplementaryItem=function(){var e=this,t=e.get("itemType");return"attachment"==t||"note"==t?!0:!1},s.prototype.isSnapshot=function(){var e=this;if(e.apiObj.links.enclosure){var t=e.apiObj.links.enclosure.type;if(!e.apiObj.links.enclosure.length&&"text/html"==t)return!0}return!1},s.prototype.updateObjectKey=function(e){return this.updateItemKey(e)},s.prototype.updateItemKey=function(e){var t=this;return t.key=e,t.apiObj.key=e,t.apiObj.data.key=e,t.pristineData.key=e,t},s.prototype.writeItem=function(){var e=this;if(!e.owningLibrary)throw new Error("Item must be associated with a library");return e.owningLibrary.items.writeItems([e])},s.prototype.writeApiObj=function(){var e=this;if(e.apiObj.data.creators){var t=e.apiObj.data.creators.filter(function(e){return e.name||e.firstName||e.lastName?!0:!1});e.apiObj.data.creators=t}var r=Z.extend({},e.pristineData,e.apiObj.data);return r},s.prototype.createChildNotes=function(e){var t=this,r=[],o=[];return e.forEach(function(e){var i=new s,n=i.initEmpty("note").then(function(o){o.set("note",e.note),o.set("parentItem",t.key),r.push(o)});o.push(n)}),Promise.all(o).then(function(){return t.owningLibrary.writeItems(r)})},s.prototype.writePatch=function(){},s.prototype.getChildren=function(e){o.debug("Zotero.Item.getChildren",4);var t=this;return Promise.resolve().then(function(){if(!t.apiObj.meta.numChildren)return[];var r={url:{target:"children",libraryType:t.apiObj.library.type,libraryID:t.apiObj.library.id,itemKey:t.key}};return t.owningLibrary.ajaxRequest(r).then(function(t){o.debug("getChildren proxied callback",4);for(var r=e.items,i=r.addItemsFromJson(t.data),n=i.length-1;n>=0;n--)i[n].associateWithLibrary(e);return i})})},s.prototype.getItemTypes=function(e){o.debug("Zotero.Item.prototype.getItemTypes",3),e||(e="en-US"),e="en-US";var t=Zotero.cache.load({locale:e,target:"itemTypes"});if(t)return o.debug("have itemTypes in localStorage",3),void(s.prototype.itemTypes=t);var r=Zotero.ajax.apiQueryString({locale:e}),i=Zotero.config.baseApiUrl+"/itemTypes"+r;Zotero.net.ajax({url:Zotero.ajax.proxyWrapper(i,"GET"),type:"GET"}).then(function(t){o.debug("got itemTypes response",3),o.debug(t.response,4),s.prototype.itemTypes=JSON.parse(t.responseText),Zotero.cache.save({locale:e,target:"itemTypes"},s.prototype.itemTypes)})},s.prototype.getItemFields=function(e){o.debug("Zotero.Item.prototype.getItemFields",3),e||(e="en-US"),e="en-US";var t=Zotero.cache.load({locale:e,target:"itemFields"});if(t)return o.debug("have itemFields in localStorage",3),s.prototype.itemFields=t,void Object.keys(s.prototype.itemFields).forEach(function(e){var t=s.prototype.itemFields[e];Zotero.localizations.fieldMap[t.field]=t.localized});var r=Zotero.ajax.apiQueryString({locale:e}),i=Zotero.config.baseApiUrl+"/itemFields"+r;Zotero.net.ajax({url:Zotero.ajax.proxyWrapper(i),type:"GET"}).then(function(t){o.debug("got itemTypes response",4);var r=JSON.parse(t.responseText);s.prototype.itemFields=r,Zotero.cache.save({locale:e,target:"itemFields"},r),Object.keys(s.prototype.itemFields).forEach(function(e){var t=s.prototype.itemFields[e];Zotero.localizations.fieldMap[t.field]=t.localized})})},s.prototype.getItemTemplate=function(){var e=arguments.length<=0||void 0===arguments[0]?"document":arguments[0],t=arguments.length<=1||void 0===arguments[1]?"":arguments[1];if(o.debug("Zotero.Item.prototype.getItemTemplate",3),"attachment"==e&&""==t)throw new Error("attachment template requested with no linkMode");var r=Zotero.ajax.apiQueryString({itemType:e,linkMode:t}),i=Zotero.config.baseApiUrl+"/items/new"+r,n={itemType:e,target:"itemTemplate"},s=Zotero.cache.load(n);if(s){o.debug("have itemTemplate in localStorage",3);var a=s;return Promise.resolve(a)}return Zotero.ajaxRequest(i,"GET",{dataType:"json"}).then(function(e){return o.debug("got itemTemplate response",3),Zotero.cache.save(n,e.data),e.data})},s.prototype.getUploadAuthorization=function(e){o.debug("Zotero.Item.getUploadAuthorization",3);var t=this,r={target:"item",targetModifier:"file",libraryType:t.owningLibrary.type,libraryID:t.owningLibrary.libraryID,itemKey:t.key},i={"Content-Type":"application/x-www-form-urlencoded"},n=t.get("md5");return n?i["If-Match"]=n:i["If-None-Match"]="*",Zotero.ajaxRequest(r,"POST",{processData:!0,data:e,headers:i})},s.prototype.registerUpload=function(e){o.debug("Zotero.Item.registerUpload",3);var t=this,r={target:"item",targetModifier:"file",libraryType:t.owningLibrary.type,libraryID:t.owningLibrary.libraryID,itemKey:t.key},i={"Content-Type":"application/x-www-form-urlencoded"},n=t.get("md5");return n?i["If-Match"]=n:i["If-None-Match"]="*",Zotero.ajaxRequest(r,"POST",{processData:!0,data:{upload:e},headers:i})},s.prototype.fullUpload=function(e){},s.prototype.creatorTypes={},s.prototype.getCreatorTypes=function(e){o.debug("Zotero.Item.prototype.getCreatorTypes: "+e,3),e||(e="document");var t=Zotero.cache.load({target:"creatorTypes"});if(t&&(o.debug("have creatorTypes in localStorage",3),s.prototype.creatorTypes=t),s.prototype.creatorTypes[e])return o.debug("creatorTypes of requested itemType available in localStorage",3),o.debug(s.prototype.creatorTypes,4),Promise.resolve(s.prototype.creatorTypes[e]);o.debug("sending request for creatorTypes",3);var r=Zotero.ajax.apiQueryString({itemType:e}),i=Zotero.config.baseApiUrl+"/itemTypeCreatorTypes"+r;return Zotero.ajaxRequest(i,"GET",{dataType:"json"}).then(function(t){return o.debug("got creatorTypes response",4),s.prototype.creatorTypes[e]=t.data,Zotero.cache.save({target:"creatorTypes"},s.prototype.creatorTypes),s.prototype.creatorTypes[e]})},s.prototype.getCreatorFields=function(e){o.debug("Zotero.Item.prototype.getCreatorFields",3);var t=Zotero.cache.load({target:"creatorFields"});if(t)return o.debug("have creatorFields in localStorage",3),s.prototype.creatorFields=t,Promise.resolve(t);var r=Zotero.config.baseApiUrl+"/creatorFields";return Zotero.ajaxRequest(r,"GET",{dataType:"json"}).then(function(e){o.debug("got itemTypes response",4),s.prototype.creatorFields=e.data,Zotero.cache.save({target:"creatorFields"},e.data)})},s.prototype.addItemTypes=function(e,t){},s.prototype.addItemFields=function(e,t){},s.prototype.addCreatorTypes=function(e,t){},s.prototype.addCreatorFields=function(e,t){},s.prototype.addItemTemplates=function(e){},s.prototype.itemTypeImageClass=function(){var e=this;if("attachment"!=e.apiObj.data.itemType)return e.apiObj.data.itemType;switch(e.apiObj.data.linkMode){case"imported_file":return"pdf"==e.translatedMimeType?e.itemTypeImageSrc.attachmentPdf:e.itemTypeImageSrc.attachmentFile;case"imported_url":return"pdf"==e.translatedMimeType?e.itemTypeImageSrc.attachmentPdf:e.itemTypeImageSrc.attachmentSnapshot;case"linked_file":return e.itemTypeImageSrc.attachmentLink;case"linked_url":return e.itemTypeImageSrc.attachmentWeblink;default:return e.itemTypeImageSrc.attachment}},s.prototype.itemTypeIconClass=function(){var e=this,t="fa fa-file-text-o";switch(e.apiObj.data.itemType){case"attachment":switch(e.apiObj.data.linkMode){case"imported_file":return"pdf"==e.translatedMimeType?"fa fa-file-pdf-o":"glyphicons glyphicons-file";case"imported_url":return"pdf"==e.translatedMimeType?"fa fa-file-pdf-o":"glyphicons glyphicons-file";case"linked_file":return"glyphicons glyphicons-link";case"linked_url":return"glyphicons glyphicons-link";default:return"glyphicons glyphicons-paperclip"}return"glyphicons file";case"artwork":return"glyphicons glyphicons-picture";case"audioRecording":return"glyphicons glyphicons-microphone";case"bill":return t;case"blogPost":return"glyphicons glyphicons-blog";case"book":return"glyphicons glyphicons-book";case"bookSection":return"glyphicons glyphicons-book-open";case"case":return t;case"computerProgram":return"glyphicons glyphicons-floppy-disk";case"conferencePaper":return t;case"dictionaryEntry":return"glyphicons glyphicons-translate";case"document":return"glyphicons glyphicons-file";case"email":return"glyphicons glyphicons-envelope";case"encyclopediaArticle":return"glyphicons glyphicons-bookmark";case"film":return"glyphicons glyphicons-film";case"forumPost":return"glyphicons glyphicons-bullhorn";case"hearing":return"fa fa-gavel";case"instantMessage":return"fa fa-comment-o";case"interview":return"fa fa-comments-o";case"journalArticle":return"fa fa-file-text-o";case"letter":return"glyphicons glyphicons-message-full";case"magazineArticle":return t;case"manuscript":return"glyphicons glyphicons-pen";case"map":return"glyphicons glyphicons-google-maps";case"newspaperArticle":return"fa fa-newspaper-o";case"note":return"glyphicons glyphicons-notes noteyellow";case"patent":return"glyphicons glyphicons-lightbulb";case"podcast":return"glyphicons glyphicons-ipod";case"presentation":return"glyphicons glyphicons-keynote";case"radioBroadcast":return"glyphicons glyphicons-wifi-alt";case"report":return"glyphicons glyphicons-notes-2";case"statue":return"glyphicons glyphicons-bank";case"thesis":return"fa fa-graduation-cap";case"tvBroadcast":return"glyphicons glyphicons-display";case"videoRecording":return"glyphicons glyphicons-facetime-video";case"webpage":return"glyphicons glyphicons-embed-close";default:return"glyphicons file"}},s.prototype.get=function(e){var t=this;switch(e){case"title":;return"note"==t.apiObj.data.itemType?t.noteTitle(t.apiObj.data.note):t.apiObj.data.title;case"creatorSummary":case"creator":return"undefined"!=typeof t.apiObj.meta.creatorSummary?t.apiObj.meta.creatorSummary:"";case"year":return t.parsedDate?t.parsedDate.getFullYear():""}return e in t.apiObj.data?t.apiObj.data[e]:e in t.apiObj.meta?t.apiObj.meta[e]:t.hasOwnProperty(e)?t[e]:null},s.prototype.set=function(e,t){var r=this;switch(e in r.apiObj&&(r.apiObj[e]=t),e in r.apiObj.data&&(r.apiObj.data[e]=t),e in r.apiObj.meta&&(r.apiObj.meta[e]=t),e){case"itemKey":case"key":r.key=t,r.apiObj.data.key=t;break;case"itemVersion":case"version":r.version=t,r.apiObj.data.version=t;break;case"itemType":r.itemType=t;break;case"linkMode":break;case"deleted":r.apiObj.data.deleted=t;break;case"parentItem":""===t&&(t=!1),r.apiObj.data.parentItem=t}return r},s.prototype.noteTitle=function(e){var t=120,r=i(e),o=r.indexOf("\n");return-1!=o&&t>o?r.substr(0,o):r.substr(0,t)},s.prototype.setParent=function(e){var t=this;return"string"!=typeof e&&e.hasOwnProperty("instance")&&"Zotero.Item"==e.instance&&(e=e.key),t.set("parentItem",e),t},s.prototype.addToCollection=function(e){var t=this;"string"!=typeof e&&"Zotero.Collection"==e.instance&&(e=e.key),-1===t.apiObj.data.collections.indexOf(e)&&t.apiObj.data.collections.push(e)},s.prototype.removeFromCollection=function(e){var t=this;"string"!=typeof e&&"Zotero.Collection"==e.instance&&(e=e.key);var r=t.apiObj.data.collections.indexOf(e);-1!=r&&t.apiObj.data.collections.splice(r,1)},s.prototype.uploadChildAttachment=function(e,t,r){var i=this;return o.debug("uploadChildAttachment",3),i.owningLibrary?(e.set("parentItem",i.key),e.associateWithLibrary(i.owningLibrary),e.writeItem().then(function(o){return i.numChildren++,e.uploadFile(t,r)},function(e){throw{message:"Failure during attachmentItem write.",code:e.status,serverMessage:e.jqxhr.responseText,response:e}})):Promise.reject(new Error("Item must be associated with a library"))},s.prototype.uploadFile=function(e,t){var r=this;o.debug("Zotero.Item.uploadFile",3);var i={md5:e.md5,filename:r.get("title"),filesize:e.filesize,mtime:e.mtime,contentType:e.contentType,params:1};return""===e.contentType&&(i.contentType="application/octet-stream"),r.getUploadAuthorization(i).then(function(t){o.debug("uploadAuth callback",3);var i;return i="string"==typeof t.data?JSON.parse(t.data):t.data,1==i.exists?{message:"File Exists"}:Zotero.file.uploadFile(i,e).then(function(){return r.registerUpload(i.uploadKey).then(function(e){if(e.isError){var t={message:"Failed to register uploaded file.",code:e.status,serverMessage:e.jqxhr.responseText,response:e};throw o.error(t),t}return{message:"Upload Successful"}})})})["catch"](function(e){throw o.debug("Failure caught during upload",3),o.debug(e,3),{message:"Failure during upload.",code:e.status,serverMessage:e.jqxhr.responseText,response:e}})},s.prototype.cslItem=function(){var e=this,t=e.get("itemType"),r=e.cslTypeMap.hasOwnProperty(t)?e.cslTypeMap[t]:!1;r||(r="article");var o=(e.get("accessDate")||e.get("url"))&&t in{journalArticle:1,newspaperArticle:1,magazineArticle:1}&&e.get("pages")&&e.citePaperJournalArticleURL,i={type:r};e.owningLibrary?i.id=e.apiObj.library.id+"/"+e.get("key"):i.id=Zotero.utils.getKey(),Object.keys(e.cslFieldMap).forEach(function(t){var r=e.cslFieldMap[t];"URL"==t&&o||r.forEach(function(r){var o=e.get(r);o&&(i[t]=o)})});var n=e.get("creators");return n.forEach(function(e){var t=e.creatorType;if(t){var r;r=e.hasOwnProperty("name")?{literal:e.name}:{family:e.lastName,given:e.firstName},i.hasOwnProperty(t)?i[t].push(r):i[t]=[r]}}),Object.keys(e.cslDateMap).forEach(function(t){var r=e.cslDateMap[t],o=e.get(r);o&&(i[t]={raw:o})}),i},Object.keys(n).forEach(function(e){s.prototype[e]=n[e]}),t.exports=s},{"./ItemMaps.js":115,"./Log.js":119,striptags:93}],115:[function(e,t,r){"use strict";var o=(e("./Log.js").Logger("libZotero:ItemMaps"),{});o.fieldMap={itemType:"Item Type",title:"Title",dateAdded:"Date Added",dateModified:"Date Modified",source:"Source",notes:"Notes",tags:"Tags",attachments:"Attachments",related:"Related",url:"URL",rights:"Rights",series:"Series",volume:"Volume",issue:"Issue",edition:"Edition",place:"Place",publisher:"Publisher",pages:"Pages",ISBN:"ISBN",publicationTitle:"Publication",ISSN:"ISSN",date:"Date",year:"Year",section:"Section",callNumber:"Call Number",archive:"Archive",archiveLocation:"Loc. in Archive",libraryCatalog:"Library Catalog",distributor:"Distributor",extra:"Extra",journalAbbreviation:"Journal Abbr",DOI:"DOI",accessDate:"Accessed",seriesTitle:"Series Title",seriesText:"Series Text",seriesNumber:"Series Number",institution:"Institution",reportType:"Report Type",code:"Code",session:"Session",legislativeBody:"Legislative Body",history:"History",reporter:"Reporter",court:"Court",numberOfVolumes:"# of Volumes",committee:"Committee",assignee:"Assignee",patentNumber:"Patent Number",priorityNumbers:"Priority Numbers",issueDate:"Issue Date",references:"References",legalStatus:"Legal Status",codeNumber:"Code Number",artworkMedium:"Medium",number:"Number",artworkSize:"Artwork Size",repository:"Repository",videoRecordingType:"Recording Type",interviewMedium:"Medium",letterType:"Type",manuscriptType:"Type",mapType:"Type",scale:"Scale",thesisType:"Type",websiteType:"Website Type",audioRecordingType:"Recording Type",label:"Label",presentationType:"Type",meetingName:"Meeting Name",studio:"Studio",runningTime:"Running Time",network:"Network",postType:"Post Type",audioFileType:"File Type",versionNumber:"Version Number",system:"System",company:"Company",conferenceName:"Conference Name",encyclopediaTitle:"Encyclopedia Title",dictionaryTitle:"Dictionary Title",language:"Language",programmingLanguage:"Language",university:"University",abstractNote:"Abstract",websiteTitle:"Website Title",reportNumber:"Report Number",billNumber:"Bill Number",codeVolume:"Code Volume",codePages:"Code Pages",dateDecided:"Date Decided",reporterVolume:"Reporter Volume",firstPage:"First Page",documentNumber:"Document Number",dateEnacted:"Date Enacted",publicLawNumber:"Public Law Number",country:"Country",applicationNumber:"Application Number",forumTitle:"Forum/Listserv Title",episodeNumber:"Episode Number",blogTitle:"Blog Title",caseName:"Case Name",nameOfAct:"Name of Act",subject:"Subject",proceedingsTitle:"Proceedings Title",bookTitle:"Book Title",shortTitle:"Short Title",docketNumber:"Docket Number",numPages:"# of Pages",note:"Note",numChildren:"# of Children",addedBy:"Added By",creator:"Creator"},o.typeMap={note:"Note",attachment:"Attachment",book:"Book",bookSection:"Book Section",journalArticle:"Journal Article",magazineArticle:"Magazine Article",newspaperArticle:"Newspaper Article",thesis:"Thesis",letter:"Letter",manuscript:"Manuscript",interview:"Interview",film:"Film",artwork:"Artwork",webpage:"Web Page",report:"Report",bill:"Bill","case":"Case",hearing:"Hearing",patent:"Patent",statute:"Statute",email:"E-mail",map:"Map",blogPost:"Blog Post",instantMessage:"Instant Message",forumPost:"Forum Post",audioRecording:"Audio Recording",presentation:"Presentation",videoRecording:"Video Recording",tvBroadcast:"TV Broadcast",radioBroadcast:"Radio Broadcast",podcast:"Podcast",computerProgram:"Computer Program",conferencePaper:"Conference Paper",document:"Document",encyclopediaArticle:"Encyclopedia Article",dictionaryEntry:"Dictionary Entry"},o.creatorMap={author:"Author",contributor:"Contributor",editor:"Editor",translator:"Translator",seriesEditor:"Series Editor",interviewee:"Interview With",interviewer:"Interviewer",director:"Director",scriptwriter:"Scriptwriter",producer:"Producer",castMember:"Cast Member",sponsor:"Sponsor",counsel:"Counsel",inventor:"Inventor",attorneyAgent:"Attorney/Agent",recipient:"Recipient",performer:"Performer",composer:"Composer",wordsBy:"Words By",cartographer:"Cartographer",programmer:"Programmer",reviewedAuthor:"Reviewed Author",artist:"Artist",commenter:"Commenter",presenter:"Presenter",guest:"Guest",podcaster:"Podcaster"},o.hideFields=["mimeType","linkMode","charset","md5","mtime","version","key","collections","relations","parentItem","contentType","filename","tags"],o.noEditFields=["accessDate","modified","filename","dateAdded","dateModified"],o.itemTypeImageSrc={note:"note",attachment:"attachment-pdf",attachmentPdf:"attachment-pdf",attachmentWeblink:"attachment-web-link",attachmentSnapshot:"attachment-snapshot",attachmentFile:"attachment-file",attachmentLink:"attachment-link",book:"book",bookSection:"book_open",journalArticle:"page_white_text",magazineArticle:"layout",newspaperArticle:"newspaper",thesis:"report",letter:"email_open",manuscript:"script",interview:"comments",film:"film",artwork:"picture",webpage:"page",report:"report",bill:"page_white","case":"page_white",hearing:"page_white",patent:"page_white",statute:"page_white",email:"email",map:"map",blogPost:"layout",instantMessage:"page_white",forumPost:"page",audioRecording:"ipod",presentation:"page_white",videoRecording:"film",tvBroadcast:"television",radioBroadcast:"transmit",podcast:"ipod_cast",computerProgram:"page_white_code",conferencePaper:"treeitem-conferencePaper",document:"page_white",encyclopediaArticle:"page_white",dictionaryEntry:"page_white"},o.cslNameMap={author:"author",editor:"editor",bookAuthor:"container-author",composer:"composer",interviewer:"interviewer",recipient:"recipient",seriesEditor:"collection-editor",translator:"translator"},o.cslFieldMap={title:["title"],"container-title":["publicationTitle","reporter","code"],"collection-title":["seriesTitle","series"],"collection-number":["seriesNumber"],publisher:["publisher","distributor"],"publisher-place":["place"],authority:["court"],page:["pages"],volume:["volume"],issue:["issue"],"number-of-volumes":["numberOfVolumes"],"number-of-pages":["numPages"],edition:["edition"],versionNumber:["version"],section:["section"],genre:["type","artworkSize"],medium:["medium","system"],archive:["archive"],archive_location:["archiveLocation"],event:["meetingName","conferenceName"],"event-place":["place"],"abstract":["abstractNote"],URL:["url"],DOI:["DOI"],ISBN:["ISBN"],"call-number":["callNumber"],note:["extra"],number:["number"],references:["history"],shortTitle:["shortTitle"],journalAbbreviation:["journalAbbreviation"],language:["language"]},o.cslDateMap={issued:"date",accessed:"accessDate"},o.cslTypeMap={book:"book",bookSection:"chapter",journalArticle:"article-journal",magazineArticle:"article-magazine",newspaperArticle:"article-newspaper",thesis:"thesis",encyclopediaArticle:"entry-encyclopedia",dictionaryEntry:"entry-dictionary",conferencePaper:"paper-conference",letter:"personal_communication",manuscript:"manuscript",interview:"interview",film:"motion_picture",artwork:"graphic",webpage:"webpage",report:"report",bill:"bill","case":"legal_case",hearing:"bill",patent:"patent",statute:"bill",email:"personal_communication",map:"map",blogPost:"webpage",instantMessage:"personal_communication",forumPost:"webpage",audioRecording:"song",presentation:"speech",videoRecording:"motion_picture",tvBroadcast:"broadcast",radioBroadcast:"broadcast",podcast:"song",computerProgram:"book"},o.citePaperJournalArticleURL=!1,t.exports=o},{"./Log.js":119}],116:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Items");t.exports=function(e){this.instance="Zotero.Items",this.itemsVersion=0,this.syncState={earliestVersion:null,latestVersion:null},this.itemObjects={},this.objectMap=this.itemObjects,this.objectArray=[],this.unsyncedItemKeys=[],e&&this.addItemsFromJson(e)},t.exports.prototype=new Zotero.Container,t.exports.prototype.getItem=function(e){return this.getObject(e)},t.exports.prototype.getItems=function(e){return this.getObjects(e)},t.exports.prototype.addItem=function(e){return this.addObject(e),this},t.exports.prototype.addItemsFromJson=function(e){o.debug("addItemsFromJson",3);var t=this,r=e,i=[];return r.forEach(function(e){var r=new Zotero.Item(e);t.addItem(r),i.push(r)}),i},t.exports.prototype.removeLocalItem=function(e){return this.removeObject(e)},t.exports.prototype.removeLocalItems=function(e){return this.removeObjects(e)},t.exports.prototype.deleteItem=function(e){o.debug("Zotero.Items.deleteItem",3);var t,r=this;if(!e)return!1;e=r.extractKey(e),t=r.getItem(e);var i={target:"item",libraryType:r.owningLibrary.libraryType,libraryID:r.owningLibrary.libraryID,itemKey:t.key},n={url:i,type:"DELETE",headers:{"If-Unmodified-Since-Version":t.get("version")}};return r.owningLibrary.ajaxRequest(n)},t.exports.prototype.deleteItems=function(e,t){o.debug("Zotero.Items.deleteItems",3);var r,i=this,n=[];t||0===i.itemsVersion||(t=i.itemsVersion);var s;for(r=0;r<e.length;r++)e[r]&&(s=i.extractKey(e[r]),s&&n.push(s));var a=i.chunkObjectsArray(n),c=[];for(r=0;r<a.length;r++){var u=a[r].join(","),l={target:"items",libraryType:i.owningLibrary.libraryType,libraryID:i.owningLibrary.libraryID,itemKey:u},p={url:l,type:"DELETE"};c.push(p)}return i.owningLibrary.sequentialRequests(c)},t.exports.prototype.trashItems=function(e){var t,r=this;for(t=0;t<e.length;t++){var o=e[t];o.set("deleted",1)}return r.writeItems(e)},t.exports.prototype.untrashItems=function(e){var t,r=this;for(t=0;t<e.length;t++){var o=e[t];o.set("deleted",0)}return r.writeItems(e)},t.exports.prototype.findItems=function(e){var t=this,r=[];return Object.keys(t.itemObjects).forEach(function(o){var i=i.itemObjects[o];e.collectionKey&&-1===i.apiObj.collections.indexOf(e.collectionKey)||r.push(t.itemObjects[o])}),r},t.exports.prototype.atomizeItems=function(e){for(var t,r=[],o=0;o<e.length;o++){t=e[o];var i=t.get("key");if(""===i||null===i){var n=Zotero.utils.getKey();t.set("key",n),t.set("version",0)}if(r.push(t),t.hasOwnProperty("notes")&&t.notes.length>0){for(var s=0;s<t.notes.length;s++)t.notes[s].set("parentItem",t.get("key"));r=r.concat(t.notes)}if(t.hasOwnProperty("attachments")&&t.attachments.length>0){for(var a=0;a<t.attachments.length;a++)t.attachments[a].set("parentItem",t.get("key"));r=r.concat(t.attachments)}}return r},t.exports.prototype.writeItems=function(e){var t,r=this,i=r.owningLibrary,n=r.atomizeItems(e),s={target:"items",libraryType:r.owningLibrary.libraryType,libraryID:r.owningLibrary.libraryID},a=r.chunkObjectsArray(n),c=r.rawChunks(a),u=function(e){return o.debug("writeItem successCallback",3),r.updateObjectsFromWriteResponse(this.writeChunk,e),Zotero.config.useIndexedDB&&this.library.idbLibrary.updateItems(this.writeChunk),
Zotero.trigger("itemsChanged",{library:this.library}),e.returnItems=this.writeChunk,e};o.debug("items.itemsVersion: "+r.itemsVersion,3),o.debug("items.libraryVersion: "+r.libraryVersion,3);var l=[];for(t=0;t<a.length;t++){var p={writeChunk:a[t],library:i},d=JSON.stringify(c[t]);l.push({url:s,type:"POST",data:d,processData:!1,success:u.bind(p)})}return i.sequentialRequests(l).then(function(e){return o.debug("Done with writeItems sequentialRequests promise",3),e})}},{"./Log.js":119}],117:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Library"),i=function(e,t,r,i){o.debug("Zotero.Library constructor",3),o.debug("Library Constructor: "+e+" "+t+" ",3);var n=this;if(o.debug(r,4),n.instance="Zotero.Library",n.libraryVersion=0,n.syncState={earliestVersion:null,latestVersion:null},n._apiKey=i||"",n.libraryUrlIdentifier=r,Zotero.config.librarySettings?n.libraryBaseWebsiteUrl=Zotero.config.librarySettings.libraryPathString:(n.libraryBaseWebsiteUrl=Zotero.config.baseWebsiteUrl,"group"==e&&(n.libraryBaseWebsiteUrl+="groups/"),r?this.libraryBaseWebsiteUrl+=r+"/items":o.warn("no libraryUrlIdentifier specified")),n.items=new Zotero.Items,n.items.owningLibrary=n,n.itemKeys=[],n.collections=new Zotero.Collections,n.collections.libraryUrlIdentifier=n.libraryUrlIdentifier,n.collections.owningLibrary=n,n.tags=new Zotero.Tags,n.searches=new Zotero.Searches,n.searches.owningLibrary=n,n.groups=new Zotero.Groups,n.groups.owningLibrary=n,n.deleted=new Zotero.Deleted,n.deleted.owningLibrary=n,!e)return void o.warn("No type specified for library");if(n.type=e,n.libraryType=e,n.libraryID=t,n.libraryString=Zotero.utils.libraryString(n.libraryType,n.libraryID),n.libraryUrlIdentifier=r,n.preferences=new Zotero.Preferences(Zotero.store,n.libraryString),"undefined"==typeof window)Zotero.config.useIndexedDB=!1,o.warn("Node detected; disabling indexedDB");else{var s=navigator.userAgent.indexOf("Chrome")>-1,a=(navigator.userAgent.indexOf("MSIE")>-1,navigator.userAgent.indexOf("Firefox")>-1,navigator.userAgent.indexOf("Safari")>-1),c=navigator.userAgent.toLowerCase().indexOf("op")>-1;s&&a&&(a=!1),s&&c&&(s=!1),a&&(Zotero.config.useIndexedDB=!1,o.warn("Safari detected; disabling indexedDB"))}if(Zotero.config.useIndexedDB===!0){o.debug("Library Constructor: indexedDB init",3);var u=new Zotero.Idb.Library(n.libraryString);u.owningLibrary=this,n.idbLibrary=u,n.cachedDataPromise=u.init().then(function(){if(o.debug("Library Constructor: idbInitD Done",3),Zotero.config.preloadCachedLibrary===!0){o.debug("Library Constructor: preloading cached library",3);var e=n.loadIndexedDBCache();return e.then(function(){o.debug("Library Constructor: Library.items.itemsVersion: "+n.items.itemsVersion,3),o.debug("Library Constructor: Library.collections.collectionsVersion: "+n.collections.collectionsVersion,3),o.debug("Library Constructor: Library.tags.tagsVersion: "+n.tags.tagsVersion,3),o.debug("Library Constructor: Triggering cachedDataLoaded",3),n.trigger("cachedDataLoaded")},function(e){throw o.error("Error loading cached library"),o.error(e),new Error("Error loading cached library")}),e}n.trigger("cachedDataLoaded")},function(){Zotero.config.useIndexedDB=!1,n.trigger("indexedDBError"),n.trigger("cachedDataLoaded"),o.error("Error initializing indexedDB. Promise rejected.")})}else n.cachedDataPromise=Promise.resolve();n.dirty=!1,n.tagsChanged=function(){},n.collectionsChanged=function(){},n.itemsChanged=function(){}};i.prototype.sortableColumns=["title","creator","itemType","date","year","publisher","publicationTitle","journalAbbreviation","language","accessDate","libraryCatalog","callNumber","rights","dateAdded","dateModified","addedBy"],i.prototype.displayableColumns=["title","creator","itemType","date","year","publisher","publicationTitle","journalAbbreviation","language","accessDate","libraryCatalog","callNumber","rights","dateAdded","dateModified","numChildren","addedBy"],i.prototype.groupOnlyColumns=["addedBy"],i.prototype.comparer=function(){return Intl?(new Intl.Collator).compare:function(e,t){return e.toLocaleLowerCase()==t.toLocaleLowerCase()?0:e.toLocaleLowerCase()<t.toLocaleLowerCase()?-1:1}},i.prototype.ajaxRequest=function(e,t,r){o.debug("Library.ajaxRequest",3),t||(t="GET"),r||(r={});var i={url:e,type:t};return i=Z.extend({},i,r),i.key||""==this._apiKey||(i.key=this._apiKey),o.debug(i,3),Zotero.net.queueRequest(i)},i.prototype.sequentialRequests=function(e){var t=this;o.debug("Zotero.Library.sequentialRequests",3);var r=e.map(function(e){return e.key||""==t._apiKey||(e.key=t._apiKey),e});return Zotero.net.queueRequest(r)},i.prototype.websiteUrl=function(e){o.debug("Zotero.library.websiteUrl",3),o.debug(e,4);var t=this,r=[];Object.keys(e).forEach(function(t){var o=e[t];""!==o&&r.push(t+"/"+o)}),r.sort(),o.debug(r,4);var i=r.join("/");return t.libraryBaseWebsiteUrl+"/"+i},i.prototype.synchronize=function(){},i.prototype.loadUpdatedItems=function(){o.debug("Zotero.Library.loadUpdatedItems",3);var e=this,t=e.libraryVersion?e.libraryVersion:e.items.itemsVersion;return Promise.resolve(e.updatedVersions("items",t)).then(function(t){o.debug("itemVersions resolved",3),o.debug("items Last-Modified-Version: "+t.lastModifiedVersion,3),e.items.updateSyncState(t.lastModifiedVersion);var r=t.data;e.itemVersions=r;var i=[];return Object.keys(r).forEach(function(t){var o=r[t],n=e.items.getItem(t);n&&n.apiObj.key==o||i.push(t)}),e.loadItemsFromKeys(i)}).then(function(t){o.debug("loadItemsFromKeys resolved",3),e.items.updateSyncedVersion();var r=Zotero.state.getUrlVars();if(e.buildItemDisplayView(r),Zotero.config.useIndexedDB){e.idbLibrary.updateItems(e.items.objectArray)}})},i.prototype.loadUpdatedCollections=function(){o.debug("Zotero.Library.loadUpdatedCollections",3);var e=this;o.debug("library.collections.collectionsVersion:"+e.collections.collectionsVersion,4);var t=e.collections.collectionsVersion;return o.debug("loadUpdatedCollections syncFromVersion: "+t,3),e.updatedVersions("collections",t).then(function(t){o.debug("collectionVersions finished",3),o.debug("Collections Last-Modified-Version: "+t.lastModifiedVersion,3),e.collections.updateSyncState(t.lastModifiedVersion);var r=t.data;e.collectionVersions=r;var i=[];return Object.keys(r).forEach(function(t){var o=r[t],n=e.collections.getCollection(t);n&&n.apiObj.version==o||i.push(t)}),0===i.length?(o.debug("No collectionKeys need updating. resolving",3),t):(o.debug("fetching collections by key",3),e.loadCollectionsFromKeys(i).then(function(){var t=e.collections;t.initSecondaryData(),o.debug("All updated collections loaded",3),e.collections.updateSyncedVersion();Zotero.state.getUrlVars();return o.debug("loadUpdatedCollections complete - saving collections to cache before resolving",3),o.debug("collectionsVersion: "+e.collections.collectionsVersion,3),Zotero.config.useIndexedDB?e.idbLibrary.updateCollections(t.collectionsArray):void 0}))}).then(function(){return o.debug("done getting collection data. requesting deleted data",3),e.getDeleted(e.libraryVersion)}).then(function(t){o.debug("got deleted collections data: removing local copies",3),o.debug(e.deleted,3),e.deleted.deletedData.collections&&e.deleted.deletedData.collections.length>0&&e.collections.removeLocalCollections(e.deleted.deletedData.collections)})},i.prototype.loadUpdatedTags=function(){o.debug("Zotero.Library.loadUpdatedTags",3);var e=this;return o.debug("tagsVersion: "+e.tags.tagsVersion,3),Promise.resolve(e.loadAllTags({since:e.tags.tagsVersion})).then(function(){return o.debug("done getting tags, request deleted tags data",3),e.getDeleted(e.libraryVersion)}).then(function(t){if(o.debug("got deleted tags data",3),e.deleted.deletedData.tags&&e.deleted.deletedData.tags.length>0&&e.tags.removeTags(e.deleted.deletedData.tags),Zotero.config.useIndexedDB){o.debug("saving updated tags to IDB",3);e.idbLibrary.updateTags(e.tags.tagsArray)}})},i.prototype.getDeleted=function(e){o.debug("Zotero.Library.getDeleted",3);var t=this,r={target:"deleted",libraryType:t.libraryType,libraryID:t.libraryID,since:e};return t.deleted.pending?(o.debug("getDeleted resolving with previously pending promise",3),Promise.resolve(t.deleted.pendingPromise)):(o.debug("version:"+e,3),o.debug("sinceVersion:"+t.deleted.sinceVersion,3),o.debug("untilVersion:"+t.deleted.untilVersion,3),t.deleted.untilVersion&&e>=t.deleted.sinceVersion?(o.debug("deletedVersion matches requested: immediately resolving",3),Promise.resolve(t.deleted.deletedData)):(t.deleted.pending=!0,t.deleted.pendingPromise=t.ajaxRequest(r).then(function(r){o.debug("got deleted response",3),t.deleted.deletedData=r.data,o.debug("Deleted Last-Modified-Version:"+r.lastModifiedVersion,3),t.deleted.untilVersion=r.lastModifiedVersion,t.deleted.sinceVersion=e}).then(function(e){o.debug("cleaning up deleted pending",3),t.deleted.pending=!1,t.deleted.pendingPromise=!1}),t.deleted.pendingPromise))},i.prototype.processDeletions=function(e){var t=this;t.collections.processDeletions(e.collections),t.items.processDeletions(e.items)},i.prototype.loadFullBib=function(e,t){var r=this,o=e.join(","),i={target:"items",libraryType:r.libraryType,libraryID:r.libraryID,itemKey:o,format:"bib",linkwrap:"1"};1==e.length&&(i.target="item"),t&&(i.style=t);var n=r.ajaxRequest(i).then(function(e){return e.data});return n},i.prototype.loadItemBib=function(e,t){o.debug("Zotero.Library.loadItemBib",3);var r=this,i={target:"item",libraryType:r.libraryType,libraryID:r.libraryID,itemKey:e,content:"bib"};t&&(i.style=t);var n=r.ajaxRequest(i).then(function(e){var t=new Zotero.Item(e.data),r=t.apiObj.bib;return r});return n},i.prototype.loadSettings=function(){o.debug("Zotero.Library.loadSettings",3);var e=this,t={target:"settings",libraryType:e.libraryType,libraryID:e.libraryID};return e.ajaxRequest(t).then(function(t){var r;return r="string"==typeof t.data?JSON.parse(t.data):t.data,e.preferences.setPref("settings",r),e.trigger("settingsLoaded"),e.preferences})},i.prototype.matchColoredTags=function(e){var t=this;if(!t.tagColors){var r=[],o=t.preferences.getPref("settings");o&&o.hasOwnProperty("tagColors")&&(r=o.tagColors.value),t.tagColors=new Zotero.TagColors(r)}return t.tagColors.match(e)},i.prototype.sendToLibrary=function(e,t){for(var r=[],o=0;o<e.length;o++){var i=e[o],n=i.emptyJsonItem();n.data=Z.extend({},e[o].apiObj.data),n.data.key="",n.data.version=0,n.data.collections=[],delete n.data.dateModified,delete n.data.dateAdded;var s=new Zotero.Item(n);s.pristine=Z.extend({},s.apiObj),s.initSecondaryData(),s.apiObj.data.relations||(s.apiObj.data.relations={}),s.apiObj.data.relations["owl:sameAs"]=Zotero.url.relationUrl(i.owningLibrary.libraryType,i.owningLibrary.libraryID,i.key),r.push(s)}return t.items.writeItems(r)},i.prototype.updatedVersions=function(){var e=arguments.length<=0||void 0===arguments[0]?"items":arguments[0],t=arguments.length<=1||void 0===arguments[1]?this.libraryVersion:arguments[1];o.debug("Library.updatedVersions",3);var r=this,i={target:e,format:"versions",libraryType:r.libraryType,libraryID:r.libraryID,since:t};return r.ajaxRequest(i)},i.prototype.loadItemsFromKeys=function(e){o.debug("Zotero.Library.loadItemsFromKeys",3);var t=this;return t.loadFromKeys(e,"items")},i.prototype.loadCollectionsFromKeys=function(e){o.debug("Zotero.Library.loadCollectionsFromKeys",3);var t=this;return t.loadFromKeys(e,"collections")},i.prototype.loadSeachesFromKeys=function(e){o.debug("Zotero.Library.loadSearchesFromKeys",3);var t=this;return t.loadFromKeys(e,"searches")},i.prototype.loadFromKeys=function(e,t){o.debug("Zotero.Library.loadFromKeys",3),t||(t="items");for(var r=this,i=[];e.length>0;)i.push(e.splice(0,50));var n=[];i.forEach(function(e){var o=e.join(",");switch(t){case"items":n.push({url:{target:"items",targetModifier:null,itemKey:o,limit:50,libraryType:r.libraryType,libraryID:r.libraryID},type:"GET",success:r.processLoadedItems.bind(r)});break;case"collections":n.push({url:{target:"collections",targetModifier:null,collectionKey:o,limit:50,libraryType:r.libraryType,libraryID:r.libraryID},type:"GET",success:r.processLoadedCollections.bind(r)});break;case"searches":n.push({url:{target:"searches",targetModifier:null,searchKey:o,limit:50,libraryType:r.libraryType,libraryID:r.libraryID},type:"GET"})}});for(var s=[],a=0;a<n.length;a++){var c=n[a].url,u=n[a].type,l={success:n[a].success};s.push(r.ajaxRequest(c,u,l))}return Promise.all(s)},i.prototype.buildItemDisplayView=function(e){o.debug("Zotero.Library.buildItemDisplayView",3),o.debug(e,4);var t=this;if(!t.idbLibrary.db)return Promise.resolve([]);var r=[];e.collectionKey?"trash"==e.collectionKey?r.push(t.idbLibrary.filterItems("deleted",1)):r.push(t.idbLibrary.filterItems("collectionKeys",e.collectionKey)):r.push(t.idbLibrary.getOrderedItemKeys("title"));var i=e.tag||[];"string"==typeof i&&(i=[i]);for(var n=0;n<i.length;n++)o.debug("adding selected tag filter",3),r.push(t.idbLibrary.filterItems("itemTagStrings",i[n]));return Promise.all(r).then(function(r){var i;for(i=0;i<r.length;i++)o.debug("result from filterPromise: "+r[i].length,3),o.debug(r[i],3);var n=t.idbLibrary.intersectAll(r),s=t.items.getItems(n);o.debug("All filters applied - Down to "+s.length+" items displayed",3),o.debug("remove child items and, if not viewing trash, deleted items",3);var a=[];for(i=0;i<s.length;i++)s[i].apiObj.data.parentItem||"trash"!=e.collectionKey&&s[i].apiObj.deleted||a.push(s[i]);var c=e.order||"title",u=e.sort||"asc";o.debug("Sorting by "+c+" - "+u,3);var l=Zotero.Library.prototype.comparer();return a.sort(function(e,t){var r=e.get(c),o=t.get(c);return l(r,o)}),"desc"==u&&(o.debug("sort is desc - reversing array",4),a.reverse()),o.debug("triggering publishing displayedItemsUpdated",3),t.trigger("displayedItemsUpdated"),a})},i.prototype.trigger=function(e,t){var r=this;Zotero.trigger(e,t,r.libraryString)},i.prototype.listen=function(e,t,r){var o=this,i=o.libraryString;Zotero.listen(e,t,r,i)},i.prototype.processLoadedCollections=function(e){o.debug("processLoadedCollections",3);var t=this;o.debug("adding collections to library.collections",3);for(var r=t.collections.addCollectionsFromJson(e.data),i=0;i<r.length;i++)r[i].associateWithLibrary(t);return t.collections.updateSyncState(e.lastModifiedVersion),Zotero.trigger("loadedCollectionsProcessed",{library:t,collectionsAdded:r}),e},i.prototype.addCollection=function(e,t){o.debug("Zotero.Library.addCollection",3);var r=this,i=new Zotero.Collection;return i.associateWithLibrary(r),i.set("name",e),i.set("parentCollection",t),r.collections.writeCollections([i])},i.prototype.fetchItemKeys=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o.debug("Zotero.Library.fetchItemKeys",3);var t=this,r=Z.extend(!0,{target:"items",libraryType:this.libraryType,libraryID:this.libraryID,format:"keys"},e);return t.ajaxRequest(r)},i.prototype.getTrashKeys=function(){o.debug("Zotero.Library.getTrashKeys",3);var e=this,t={target:"items",libraryType:e.libraryType,libraryID:e.libraryID,format:"keys",collectionKey:"trash"};return e.ajaxRequest(t)},i.prototype.emptyTrash=function(){o.debug("Zotero.Library.emptyTrash",3);var e=this;return e.getTrashKeys().then(function(t){var r=t.data.split("\n");return e.items.deleteItems(r,t.lastModifiedVersion)})},i.prototype.loadItemKeys=function(e){o.debug("Zotero.Library.loadItemKeys",3);var t=this;return this.fetchItemKeys(e).then(function(e){o.debug("loadItemKeys proxied callback",3);var r=e.data.split(/[\s]+/);t.itemKeys=r})},i.prototype.loadItems=function(e){o.debug("Zotero.Library.loadItems",3);var t=this;e||(e={});var r={target:"items",targetModifier:"top",start:0,limit:25,order:Zotero.config.defaultSortColumn,sort:Zotero.config.defaultSortOrder},i=Z.extend({},r,e),n=Z.extend({target:"items",libraryType:t.libraryType,libraryID:t.libraryID},i);return t.ajaxRequest(n).then(function(e){o.debug("loadItems proxied callback",3);for(var r=t.items,i=r.addItemsFromJson(e.data),n=0;n<i.length;n++)i[n].associateWithLibrary(t);return e.loadedItems=i,Zotero.trigger("itemsChanged",{library:t}),e})},i.prototype.loadPublications=function(e){o.debug("Zotero.Library.loadPublications",3);var t=this;e||(e={});var r={target:"publications",start:0,limit:50,order:Zotero.config.defaultSortColumn,sort:Zotero.config.defaultSortOrder,include:"bib"},i=Z.extend({},r,e),n=Z.extend({target:"publications",libraryType:t.libraryType,libraryID:t.libraryID},i);return t.ajaxRequest(n).then(function(e){o.debug("loadPublications proxied callback",3);var t=[],r=e.data;return r.forEach(function(e){var r=new Zotero.Item(e);t.push(r)}),e.publicationItems=t,e})},i.prototype.processLoadedItems=function(e){o.debug("processLoadedItems",3);for(var t=this,r=t.items,i=r.addItemsFromJson(e.data),n=0;n<i.length;n++)i[n].associateWithLibrary(t);return t.items.updateSyncState(e.lastModifiedVersion),Zotero.trigger("itemsChanged",{library:t,loadedItems:i}),e},i.prototype.loadItem=function(e){o.debug("Zotero.Library.loadItem",3);var t=this;if(!r)var r={};var i={target:"item",libraryType:t.libraryType,libraryID:t.libraryID,itemKey:e};return t.ajaxRequest(i).then(function(e){o.debug("Got loadItem response",3);var r=new Zotero.Item(e.data);return r.owningLibrary=t,t.items.itemObjects[r.key]=r,Zotero.trigger("itemsChanged",{library:t}),r},function(e){o.warn("Error loading Item")})},i.prototype.trashItem=function(e){var t=this;return t.items.trashItems([t.items.getItem(e)])},i.prototype.untrashItem=function(e){if(o.debug("Zotero.Library.untrashItem",3),!e)return!1;var t=this.items.getItem(e);return t.apiObj.deleted=0,t.writeItem()},i.prototype.deleteItem=function(e){o.debug("Zotero.Library.deleteItem",3);var t=this;return t.items.deleteItem(e)},i.prototype.deleteItems=function(e){o.debug("Zotero.Library.deleteItems",3);var t=this;return t.items.deleteItems(e)},i.prototype.addNote=function(e,t){o.debug("Zotero.Library.prototype.addNote",3);var r=this,i={target:"children",libraryType:r.libraryType,libraryID:r.libraryID,itemKey:e};this.items.getItem(e);return r.ajaxRequest(i,"POST",{processData:!1})},i.prototype.fetchGlobalItems=function(e){o.debug("Zotero.Library.fetchGlobalItems",3);var t=this;e||(e={});var r={target:"items",start:0,limit:25},i=Z.extend({},r,e),n=Z.extend({target:"items",libraryType:""},i);return t.ajaxRequest(n,"GET",{dataType:"json"}).then(function(e){return o.debug("globalItems callback",3),e.data})},i.prototype.fetchGlobalItem=function(e){o.debug("Zotero.Library.fetchGlobalItem",3),o.debug(e,3);var t=this,r={target:"item"},i=Z.extend({},r),n=Z.extend({target:"item",libraryType:"",itemKey:e},i);return t.ajaxRequest(n,"GET",{dataType:"json"}).then(function(e){return o.debug("globalItem callback",3),e.data})},i.prototype.fetchTags=function(e){o.debug("Zotero.Library.fetchTags",3);var t={target:"tags",order:"title",sort:"asc",limit:100},r=Z.extend({},t,e),i=Z.extend({target:"tags",libraryType:this.libraryType,libraryID:this.libraryID},r);return Zotero.ajaxRequest(i)},i.prototype.loadTags=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o.debug("Zotero.Library.loadTags",3);var t=this;return e.showAutomaticTags&&e.collectionKey&&delete e.collectionKey,t.tags.displayTagsArray=[],t.fetchTags(e).then(function(e){o.debug("loadTags proxied callback",3);var r=e.lastModifiedVersion;t.tags.updateSyncState(r);t.tags.addTagsFromJson(e.data);return t.tags.updateTagsVersion(r),t.tags.rebuildTagsArray(),e.parsedLinks.hasOwnProperty("next")?(t.tags.hasNextLink=!0,t.tags.nextLink=e.parsedLinks.next):(t.tags.hasNextLink=!1,t.tags.nextLink=null),t.trigger("tagsChanged",{library:t}),t.tags})},i.prototype.loadAllTags=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o.debug("Zotero.Library.loadAllTags",3);var t=this,r={target:"tags",order:"title",sort:"asc",limit:100,libraryType:t.libraryType,libraryID:t.libraryID},n=Z.extend({},r,e),s=Z.extend({},n);return new Promise(function(r,n){var a=function c(r){o.debug("loadAllTags continueLoadingCallback",3);var n=Zotero.Tags.prototype.plainTagsList(r.tagsArray);if(n.sort(i.prototype.comparer()),r.plainList=n,r.hasNextLink){o.debug("still has next link.",3),r.tagsArray.sort(Zotero.Tag.prototype.tagComparer()),n=Zotero.Tags.prototype.plainTagsList(r.tagsArray),n.sort(i.prototype.comparer()),r.plainList=n;var s=r.nextLink,a=Zotero.utils.parseQuery(Zotero.utils.querystring(s)),u=Z.extend({},e);return u.start=a.start,u.limit=a.limit,t.loadTags(u).then(c)}o.debug("no next in tags link",3),r.updateSyncedVersion(),r.tagsArray.sort(Zotero.Tag.prototype.tagComparer()),n=Zotero.Tags.prototype.plainTagsList(r.tagsArray),n.sort(i.prototype.comparer()),r.plainList=n,o.debug("resolving loadTags deferred",3),t.tagsLoaded=!0,t.tags.loaded=!0,r.loadedConfig=e;for(var l=0;l<t.tags.tagsArray.length;l++)r.tagsArray[l].apiObj.version=r.tagsVersion;return t.trigger("tagsChanged",{library:t}),r};r(t.loadTags(s).then(a))})},i.prototype.loadIndexedDBCache=function(){o.debug("Zotero.Library.loadIndexedDBCache",3);var e=this,t=e.idbLibrary.getAllItems(),r=e.idbLibrary.getAllCollections(),i=e.idbLibrary.getAllTags();return t.then(function(t){o.debug("loadIndexedDBCache itemsD done",3);for(var r=0,i=0;i<t.length;i++){var n=new Zotero.Item(t[i]);e.items.addItem(n),n.version>r&&(r=n.version)}e.items.itemsVersion=r,e.items.loaded=!0,o.debug("Done loading indexedDB items promise into library",3)}),r.then(function(t){o.debug("loadIndexedDBCache collectionsD done",3);for(var r=0,i=0;i<t.length;i++){var n=new Zotero.Collection(t[i]);e.collections.addCollection(n),n.version>r&&(r=n.version)}e.collections.collectionsVersion=r,e.collections.initSecondaryData(),e.collections.loaded=!0}),i.then(function(t){o.debug("loadIndexedDBCache tagsD done",3),o.debug(t,4);for(var r=0,i=0,n=0;n<t.length;n++){var s=new Zotero.Tag(t[n]);e.tags.addTag(s),t[n].version>r&&(r=t[n].version)}i=r,e.tags.tagsVersion=i,e.tags.loaded=!0}),Promise.all([t,r,i])},i.prototype.saveIndexedDB=function(){var e=this,t=e.idbLibrary.updateItems(e.items.itemsArray),r=e.idbLibrary.updateCollections(e.collections.collectionsArray),o=e.idbLibrary.updateTags(e.tags.tagsArray);return Promise.all([t,r,o])},t.exports=i},{"./Log.js":119}],118:[function(e,t,r){"use strict";var o=e("./ItemMaps.js");t.exports.fieldMap=o.fieldMap,t.exports.typeMap=o.typeMap,t.exports.creatorMap=o.creatorMap},{"./ItemMaps.js":115}],119:[function(e,t,r){"use strict";var o,i,n,s={},a=1;"undefined"==typeof console?(o=function(){},i=function(){},n=function(){}):(o=function(e){console.log(e)},i=function(e){console.warn(e)},n=function(e){console.error(e)}),s.SetLevel=function(e){a=e},s.debug=function(e,t){"number"!=typeof t&&(t=1),a>=t&&o(e)},s.debugObject=function(e,t){"number"!=typeof t&&(t=1),a>=t&&o(e)},s.warn=function(e){i(e)},s.error=function(e){n(e)},s.Logger=function(e){var t=arguments.length<=1||void 0===arguments[1]?2:arguments[1];return a=t,{debug:function(t,r){return"string"==typeof t?s.debug(e+": "+t,r):(s.debug(e+": \\",r),void s.debug(t,r))},warn:function(t){return s.warn(e+": "+t)},error:function(t){return s.error(e+": "+t)}}},t.exports=s},{}],120:[function(e,t,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},i=e("./Log.js").Logger("libZotero:Net"),n=e("deferred"),s=function(){this.deferredQueue=[],this.numRunning=0,this.numConcurrent=3,this.backingOff=!1};s.prototype.queueDeferred=function(){var e=this,t=new n;return e.deferredQueue.push(t),Promise.resolve(t)},s.prototype.queueRequest=function(e){i.debug("Zotero.Net.queueRequest",3);var t,r=this;return t=Array.isArray(e)?r.queueDeferred().then(function(){return i.debug("running sequential after queued deferred resolved",4),r.runSequential(e)}).then(function(e){return i.debug("runSequential done",3),r.queuedRequestDone(),e}):r.queueDeferred().then(function(){return i.debug("running concurrent after queued deferred resolved",4),r.runConcurrent(e)}).then(function(e){return i.debug("done with queuedRequest",4),r.queuedRequestDone(),e}),r.runNext(),t["catch"](function(e){i.error("Error before leaving Zotero.Net"),i.error(e)})},s.prototype.runConcurrent=function(e){return i.debug("Zotero.Net.runConcurrent",3),this.ajaxRequest(e).then(function(e){return i.debug("done with runConcurrent request",3),e})},s.prototype.runSequential=function(e){i.debug("Zotero.Net.runSequential",3);for(var t=this,r=[],o=Promise.resolve(),n=0;n<e.length;n++){var s=e[n];o=o.then(function(){var e=t.ajaxRequest(s).then(function(e){i.debug("pushing sequential response into result array",3),r.push(e)});return e})}return o.then(function(){return i.debug("done with sequential aggregator promise - returning responses",4),r})},s.prototype.individualRequestDone=function(e){i.debug("Zotero.Net.individualRequestDone",3);var t=this,r=t.checkDelay(e);if(r>0){var o=1e3*r;t.backingOff=!0;var n=Date.now()+o;n>t.waitingExpires&&(t.waitingExpires=n),setTimeout(t.runNext,o)}return e},s.prototype.queuedRequestDone=function(e){i.debug("queuedRequestDone",3);var t=this;return t.numRunning--,t.runNext(),e},s.prototype.runNext=function(){i.debug("Zotero.Net.runNext",3);var e=this,t=Date.now();if(e.backingOff&&e.waitingExpires>t-100){i.debug("currently backing off",3);var r=e.waitingExpires-t;return void setTimeout(e.runNext,r)}for(e.backingOff&&e.waitingExpires<=t-100&&(e.backingOff=!1),i.debug(e.numRunning+"/"+e.numConcurrent+" Running. "+e.deferredQueue.length+" queued.",3);e.deferredQueue.length>0&&e.numRunning<e.numConcurrent;){e.numRunning++;var o=e.deferredQueue.shift();o.resolve(),i.debug(e.numRunning+"/"+e.numConcurrent+" Running. "+e.deferredQueue.length+" queued.",3)}},s.prototype.checkDelay=function(e){i.debug("Zotero.Net.checkDelay",4);var t=this,r=0;if(Array.isArray(e))for(var o=0;o<e.length;o++){var n=t.checkDelay(e[o]);n>r&&(r=n)}else 429==e.status?r=e.retryAfter:e.backoff&&(r=e.backoff);return r},s.prototype.ajaxRequest=function(e){i.debug("Zotero.Net.ajaxRequest",3);var t=this,r={type:"GET",headers:{"Zotero-API-Version":Zotero.config.apiVersion,"Content-Type":"application/json"},success:function(e){return e},error:function(e){return i.error("ajaxRequest rejected:"+e.jqxhr.status+" - "+e.jqxhr.responseText),e}},n=Z.extend({},r.headers,e.headers);e.key&&(n=Z.extend(n,{"Zotero-API-Key":e.key}),delete e.key);var s=Z.extend({},r,e);if(s.headers=n,"object"==o(s.url)&&(s.url=Zotero.ajax.apiRequestString(s.url)),s.url=Zotero.ajax.proxyWrapper(s.url,s.type),!s.url)throw"No url specified in Zotero.Net.ajaxRequest";s.zsuccess=s.success,s.zerror=s.error,delete s.success,delete s.error,i.debug("AJAX config",4),i.debug(s,4);var a=new Promise(function(e,r){t.ajax(s).then(function(t){var r;if("json"==t.responseType||""===t.responseType&&"application/json"===t.getResponseHeader("content-type"))try{r=JSON.parse(t.response)}catch(o){r=t.response}else r=t.response;var i=new Zotero.ApiResponse({jqxhr:t,data:r,textStatus:t.responseText});e(i)},function(e){var t=new Zotero.ApiResponse({jqxhr:e,textStatus:e.responseText,isError:!0});r(t)})}).then(t.individualRequestDone.bind(t)).then(function(e){if(e.isError)throw i.error("re-throwing ApiResponse that was a rejection"),e;return e}).then(s.zsuccess,s.zerror);return a},s.prototype.ajax=function(e){e=Zotero.extend({type:"GET"},e);var t=new Promise(function(t,r){var o=new XMLHttpRequest,n=e.url;o.open(e.type,n),e.headers&&Object.keys(e.headers).forEach(function(t){var r=e.headers[t];o.setRequestHeader(t,r)}),o.send(e.data),o.onload=function(){i.debug("XMLHttpRequest done",4),i.debug(o,4),o.status>=200&&o.status<300?(i.debug("200-300 response: resolving Net.ajax promise",3),t(o)):(i.debug("not 200-300 response: rejecting Net.ajax promise",3),r(o))},o.onerror=function(){r(o)}});return t},t.exports=new s},{"./Log.js":119,deferred:30}],121:[function(e,t,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},i=(e("./Log.js").Logger("libZotero:Preferences"),function(e,t){this.store=e,this.idString=t,this.preferencesObject={},this.defaults={debug_level:3,debug_log:!0,debug_mock:!1,listDisplayedFields:["title","creator","dateModified"],showAutomaticTags:!1,itemsPerPage:25,order:"title",title:"asc"},this.load()});i.prototype.setPref=function(e,t){var r=this;r.preferencesObject[e]=t,r.persist()},i.prototype.setPrefs=function(e){var t=this;if("object"!=("undefined"==typeof e?"undefined":o(e)))throw new Error("Preferences must be an object");t.preferencesObject=e,t.persist()},i.prototype.getPref=function(e){var t=this;return t.preferencesObject[e]?t.preferencesObject[e]:t.defaults[e]?t.defaults[e]:null},i.prototype.getPrefs=function(){var e=this;return e.preferencesObject},i.prototype.persist=function(){var e=this,t="preferences_"+e.idString;e.store[t]=JSON.stringify(e.preferencesObject)},i.prototype.load=function(){var e=this,t="preferences_"+e.idString,r=e.store[t];r?e.preferencesObject=JSON.parse(r):e.preferencesObject={}},t.exports=i},{"./Log.js":119}],122:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:RequestConfig"),i=e("./Validator.js"),n=function(){this.config={}};n.prototype.Target=function(e){return this.config.target=e,this},n.prototype.TargetModifier=function(e){return this.config.targetModifier=e,this},n.prototype.LibraryType=function(e){return this.config.libraryType=e,this},n.prototype.LibraryID=function(e){return this.config.libraryID=e,this},n.prototype.ItemType=function(e){return this.config.itemType=e,this},n.prototype.ItemKey=function(e){return this.config.itemKey=e,this},n.prototype.CollectionKey=function(e){return this.config.collectionKey=e,this},n.prototype.Sort=function(e){return this.config.sort=e,this},n.prototype.Order=function(e){return this.config.order=e,this},n.prototype.Start=function(e){return this.config.start=e,this},n.prototype.Limit=function(e){return this.config.limit=e,this},n.prototype.Content=function(e){return this.config.content=e,this},n.prototype.Include=function(e){return this.config.include=e,this},n.prototype.Format=function(e){return this.config.format=e,this},n.prototype.Q=function(e){return this.config.q=e,this},n.prototype.Fq=function(e){return this.config.fq=e,this},n.prototype.Tag=function(e){return this.config.tag=e,this},n.prototype.TagType=function(e){return this.config.tagType=e,this},n.prototype.Key=function(e){return this.config.key=e,this},n.prototype.Style=function(e){return this.config.style=e,this},n.prototype.LinkWrap=function(e){return this.config.linkwrap=e,this},n.prototype.Validate=function(){var e=this.config,t=!0;return Object.keys(e).forEach(function(r){var n=e[r];i.validate(n,r)===!1&&(o.warn("API argument failed validation: "+r+" cannot be "+n),delete e[r],t=!1)}),t},t.exports=n},{"./Log.js":119,"./Validator.js":131}],123:[function(e,t,r){"use strict";e("./Log.js").Logger("libZotero:Search");t.exports=function(){this.instance="Zotero.Search",this.searchObject={}}},{"./Log.js":119}],124:[function(e,t,r){"use strict";e("./Log.js").Logger("libZotero:Searches");t.exports=function(){this.instance="Zotero.Searches",this.searchObjects={},this.syncState={earliestVersion:null,latestVersion:null}}},{"./Log.js":119}],125:[function(e,t,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};e("./Log.js").Logger("libZotero:Tag");t.exports=function(e){this.instance="Zotero.Tag",this.color=null,this.version=0,"object"==("undefined"==typeof e?"undefined":o(e))?this.parseJsonTag(e):"string"==typeof e?this.parseJsonTag(this.templateApiObj(e)):this.parseJsonTag(this.tamplateApiObj(""))},t.exports.prototype=new Zotero.ApiObject,t.exports.prototype.parseJsonTag=function(e){var t=this;t.apiObj=Z.extend({},e),t.urlencodedtag=encodeURIComponent(t.apiObj.tag),t.version=t.apiObj.version},t.exports.prototype.templateApiObj=function(e){
return{tag:e,links:{},meta:{type:0,numItems:1}}},t.exports.prototype.tagComparer=function(){if(Intl){var e=new Intl.Collator;return function(t,r){return e.compare(t.apiObj.tag,r.apiObj.tag)}}return function(e,t){return e.apiObj.tag.toLocaleLowerCase()==t.apiObj.tag.toLocaleLowerCase()?0:e.apiObj.tag.toLocaleLowerCase()<t.apiObj.tag.toLocaleLowerCase()?-1:1}},t.exports.prototype.set=function(e,t){var r=this;switch(e in r.apiObj&&(r.apiObj[e]=t),e in r.apiObj.meta&&(r.apiObj.meta[e]=t),e){case"tagVersion":case"version":r.version=t,r.apiObj.version=t}return r},t.exports.prototype.get=function(e){var t=this;if(e in t.apiObj)return t.apiObj[e];if(e in t.apiObj.meta)return t.apiObj.meta[e];switch(e){case"tagVersion":case"version":return t.version}return null}},{"./Log.js":119}],126:[function(e,t,r){"use strict";var o=(e("./Log.js").Logger("libZotero:TagColors"),function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];this.instance="Zotero.TagColors",this.colorsArray=t,this.colors=new Map,this.colorsArray.forEach(function(t){e.colors.set(t.name.toLowerCase(),t.color)})});o.prototype.match=function(e){for(var t=[],r=0;r<e.length;r++){var o=e[r].toLowerCase();this.colors.has(o)&&t.push(this.colors.get(o))}return t},t.exports=o},{"./Log.js":119}],127:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Tags");t.exports=function(e){this.instance="Zotero.Tags",this.tagsVersion=0,this.syncState={earliestVersion:null,latestVersion:null},this.displayTagsArray=[],this.displayTagsUrl="",this.tagObjects={},this.tagsArray=[],this.loaded=!1,e&&this.addTagsFromJson(e)},t.exports.prototype=new Zotero.Container,t.exports.prototype.addTag=function(e){var t=this;t.tagObjects[e.apiObj.tag]=e,t.tagsArray.push(e),t.owningLibrary&&e.associateWithLibrary(t.owningLibrary)},t.exports.prototype.getTag=function(e){var t=this;return t.tagObjects.hasOwnProperty(e)?this.tagObjects[e]:null},t.exports.prototype.removeTag=function(e){var t=this;delete t.tagObjects[e],t.updateSecondaryData()},t.exports.prototype.removeTags=function(e){var t=this;e.forEach(function(e){delete t.tagObjects[e]}),t.updateSecondaryData()},t.exports.prototype.plainTagsList=function(e){o.debug("Zotero.Tags.plainTagsList",3);var t=[];return e.forEach(function(e){t.push(e.apiObj.tag)}),t},t.exports.prototype.clear=function(){o.debug("Zotero.Tags.clear",3),this.tagsVersion=0,this.syncState.earliestVersion=null,this.syncState.latestVersion=null,this.displayTagsArray=[],this.displayTagsUrl="",this.tagObjects={},this.tagsArray=[]},t.exports.prototype.updateSecondaryData=function(){o.debug("Zotero.Tags.updateSecondaryData",3);var e=this;e.tagsArray=[],Object.keys(e.tagObjects).forEach(function(t){var r=e.tagObjects[t];e.tagsArray.push(r)}),e.tagsArray.sort(Zotero.Tag.prototype.tagComparer());var t=e.plainTagsList(e.tagsArray);t.sort(Zotero.Library.prototype.comparer()),e.plainList=t},t.exports.prototype.updateTagsVersion=function(e){var t=this;Object.keys(t.tagObjects).forEach(function(r){var o=t.tagObjects[r];o.set("version",e)})},t.exports.prototype.rebuildTagsArray=function(){var e=this;e.tagsArray=[],Object.keys(e.tagObjects).forEach(function(t){var r=e.tagObjects[t];e.tagsArray.push(r)})},t.exports.prototype.addTagsFromJson=function(e){o.debug("Zotero.Tags.addTagsFromJson",3);var t=this,r=[];return e.forEach(function(e){var o=new Zotero.Tag(e);t.addTag(o),r.push(o)}),r}},{"./Log.js":119}],128:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Url"),i={};i.itemHref=function(e){var t="";return t+=Zotero.config.librarySettings.libraryPathString+"/itemKey/"+e.get("key")},i.attachmentDownloadLink=function(e){var t="",r=e.attachmentDownloadUrl;e.get("contentType");if(e.apiObj.links&&e.apiObj.links.enclosure){if(e.apiObj.links.enclosure.length||!e.isSnapshot()){var i=Zotero.utils.translateMimeType(e.apiObj.links.enclosure.type),n=e.apiObj.links.enclosure,s=parseInt(n.length,10),a=""+s+" B";return s>1073741824?a=""+(s/1073741824).toFixed(1)+" GB":s>1048576?a=""+(s/1048576).toFixed(1)+" MB":s>1024&&(a=""+(s/1024).toFixed(1)+" KB"),o.debug(i,3),t+='<a href="'+r+'">',t+="undefined"==i||""===i||"undefined"==typeof i?a+"</a>":i+", "+a+"</a>"}t+='<a href="'+r+'">View Snapshot</a>'}return t},i.attachmentDownloadUrl=function(e){return e.apiObj.links&&e.apiObj.links.enclosure?Zotero.config.proxyDownloads?i.wwwDownloadUrl(e):i.apiDownloadUrl(e):!1},i.apiDownloadUrl=function(e){return e.apiObj.links.enclosure?e.apiObj.links.enclosure.href:!1},i.proxyDownloadUrl=function(e){return e.apiObj.links.enclosure?Zotero.config.proxyDownloads?Zotero.config.baseDownloadUrl+"?itemkey="+e.get("key"):i.apiDownloadUrl(e):!1},i.wwwDownloadUrl=function(e){return e.apiObj.links.enclosure?Zotero.config.baseZoteroWebsiteUrl+Zotero.config.librarySettings.libraryPathString+"/"+e.get("key")+"/file/view":!1},i.publicationsDownloadUrl=function(e){return e.apiObj.links.enclosure?e.apiObj.links.enclosure.href:!1},i.attachmentFileDetails=function(e){if(!e.apiObj.links.enclosure)return"";var t=Zotero.utils.translateMimeType(e.apiObj.links.enclosure.type),r=e.apiObj.links.enclosure,o="";if(r.length){var i=parseInt(r.length,10);return o=""+i+" B",i>1073741824?o=""+(i/1073741824).toFixed(1)+" GB":i>1048576?o=""+(i/1048576).toFixed(1)+" MB":i>1024&&(o=""+(i/1024).toFixed(1)+" KB"),"("+t+", "+o+")"}return"("+t+")"},i.userWebLibrary=function(e){return[Zotero.config.baseWebsiteUrl,e,"items"].join("/")},i.groupWebLibrary=function(e){return"Private"==e.type?[Zotero.config.baseWebsiteUrl,"groups",e.get("id"),"items"].join("/"):[Zotero.config.baseWebsiteUrl,"groups",Zotero.utils.slugify(e.get("name")),"items"].join("/")},i.exportUrls=function(e){o.debug("Zotero.url.exportUrls",3);var t={},r={};return Zotero.config.exportFormats.forEach(function(o){r=Z.extend(e,{format:o}),t[o]=Zotero.ajax.apiRequestUrl(r)+Zotero.ajax.apiQueryString({format:o,limit:"25"})}),t},i.relationUrl=function(e,t,r){switch(e){case"group":return"http://zotero.org/groups/"+t+"/items/"+r;case"user":return"http://zotero.org/users/"+t+"/items/"+r;case"publications":return"http://zotero.org/users/"+t+"/publications/items/"+r}return""},t.exports=i},{"./Log.js":119}],129:[function(e,t,r){"use strict";t.exports=function(){this.instance="Zotero.User"},t.exports.prototype=new Zotero.ApiObject,t.exports.prototype.loadObject=function(e){this.title=e.title,this.author=e.author,this.tagID=e.tagID,this.published=e.published,this.updated=e.updated,this.links=e.links,this.numItems=e.numItems,this.items=e.items,this.tagType=e.tagType,this.modified=e.modified,this.added=e.added,this.key=e.key},t.exports.prototype.parseXmlUser=function(e){this.parseXmlEntry(e);var t=e.find("content>tag");0!==t.length&&(this.tagKey=t.attr("key"),this.libraryID=t.attr("libraryID"),this.tagName=t.attr("name"),this.dateAdded=t.attr("dateAdded"),this.dateModified=t.attr("dateModified"))}},{}],130:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Utils"),i={randomString:function(e,t){t||(t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),e||(e=8);for(var r="",o=0;e>o;o++){var i=Math.floor(Math.random()*t.length);r+=t.substring(i,i+1)}return r},getKey:function(){var e="23456789ABCDEFGHIJKMNPQRSTUVWXZ";return i.randomString(8,e)},slugify:function(e){var t=e.trim();return t=t.toLowerCase(),t=t.replace(/[^a-z0-9 ._-]/g,""),t=t.replace(/\s/g,"_")},prependAutocomplete:function(e,t){o.debug("Zotero.utils.prependAutocomplete",3),o.debug("prepend match: "+e,4);var r;if(t||o.warn("source is not defined"),""===e)return r=t.slice(0);var i=e.length,n=e.toLowerCase();return r=t.map(function(e){return e.substr(0,i).toLowerCase()==n?e:null})},matchAnyAutocomplete:function(e,t){o.debug("Zotero.utils.matchAnyAutocomplete",3),o.debug("matchAny match: "+e,4);var r;if(t||o.warn("source is not defined"),""===e)return r=t.slice(0);var i=e.toLowerCase();return r=t.map(function(e){return-1!=e.toLowerCase().indexOf(i)?e:null})},libraryString:function(e,t){var r="";return"user"==e?r="u":"group"==e?r="g":"publications"==e&&(r="p"),r+=t},parseLibString:function(e){var t,r;if("u"==e.charAt(0))t="user";else if("g"==e.charAt(0))t="group";else{if("p"!=e.charAt(0))throw new Error("unexpected type character in libraryString");t="publications"}if(r=parseInt(e.substring(1),10),isNaN(r))throw new Error("NaN libraryID");return{libraryType:t,libraryID:r}},stale:function(e,t){var r=Date.now(),o=r.getTime()-e.getTime();return o/6e4>t?!0:!1},entityify:function(e){var t={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"};return e.replace(/[<>&"]/g,function(e){return t[e]})},parseApiDate:function(e){var t=/([0-9]+)-([0-9]+)-([0-9]+)T([0-9]+):([0-9]+):([0-9]+)Z/,r=t.exec(e);if(null===r)return o.debug("error parsing api date: "+e,2),null;var i=new Date(Date.UTC(r[1],r[2]-1,r[3],r[4],r[5],r[6]));return i},readCookie:function(e){for(var t=e+"=",r=document.cookie.split(";"),o=0;o<r.length;o++){for(var i=r[o];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null},translateMimeType:function(e){switch(e){case"text/html":return"html";case"application/pdf":case"application/x-pdf":case"application/acrobat":case"applications/vnd.pdf":case"text/pdf":case"text/x-pdf":return"pdf";case"image/jpg":case"image/jpeg":return"jpg";case"image/gif":return"gif";case"application/msword":case"application/doc":case"application/vnd.msword":case"application/vnd.ms-word":case"application/winword":case"application/word":case"application/x-msw6":case"application/x-msword":return"doc";case"application/vnd.oasis.opendocument.text":case"application/x-vnd.oasis.opendocument.text":return"odt";case"video/flv":case"video/x-flv":return"flv";case"image/tif":case"image/tiff":case"image/x-tif":case"image/x-tiff":case"application/tif":case"application/x-tif":case"application/tiff":case"application/x-tiff":return"tiff";case"application/zip":case"application/x-zip":case"application/x-zip-compressed":case"application/x-compress":case"application/x-compressed":case"multipart/x-zip":return"zip";case"video/quicktime":case"video/x-quicktime":return"mov";case"video/avi":case"video/msvideo":case"video/x-msvideo":return"avi";case"audio/wav":case"audio/x-wav":case"audio/wave":return"wav";case"audio/aiff":case"audio/x-aiff":case"sound/aiff":return"aiff";case"text/plain":return"plain text";case"application/rtf":return"rtf";default:return e}},getKeyPermissions:function(e,t){if(!e)return!1;if(!t)return!1;var r={target:"key",apiKey:t,libraryType:""};return Zotero.ajaxRequest(r).then(function(e){var t=JSON.parse(e.data);return t})},parseQuery:function(e){o.debug("parseQuery"),o.debug(e);for(var t,r={},i=/\+/g,n=/([^&=]+)=?([^&]*)/g,s=function(e){return decodeURIComponent(e.replace(i," "))};t=n.exec(e);)r[s(t[1])]=s(t[2]);return r},buildQuery:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t="?";for(var r in e)t+="&"+encodeURIComponent(r)+"="+encodeURIComponent(e[r]);return t},querystring:function(e){if(-1==e.indexOf("?"))return"";var t=-1!=e.indexOf("#")?e.indexOf("#"):void 0,r=e.substring(e.indexOf("?")+1,t);return r}};t.exports=i},{"./Log.js":119}],131:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Validator"),i={patterns:{itemKey:/^.+$/,collectionKey:/^([A-Z0-9]{8,})|trash$/,libraryID:/^[0-9]+$/,libraryType:/^(user|group|)$/,target:/^(items?|collections?|tags|children|deleted|userGroups|key|settings|publications)$/,targetModifier:/^(top|file|file\/view)$/,sort:/^(asc|desc)$/,start:/^[0-9]*$/,limit:/^[0-9]*$/,order:/^\S*$/,content:/^((html|json|data|bib|none|bibtex|bookmarks|coins|csljson|mods|refer|rdf_bibliontology|rdf_dc|rdf_zotero|ris|tei|wikipedia),?)+$/,include:/^((html|json|data|bib|none|bibtex|bookmarks|coins|csljson|mods|refer|rdf_bibliontology|rdf_dc|rdf_zotero|ris|tei|wikipedia),?)+$/,format:/^((atom|bib|json|keys|versions|bibtex|bookmarks|coins|csljson|mods|refer|rdf_bibliontology|rdf_dc|rdf_zotero|ris|tei|wikipedia),?)+$/,q:/^.*$/,fq:/^\S*$/,itemType:/^\S*$/,locale:/^\S*$/,tag:/^.*$/,tagType:/^(0|1)$/,key:/^\S*/,style:/^\S*$/,linkwrap:/^(0|1)*$/},validate:function(e,t){if(o.debug("Zotero.validate",4),""===e)return null;if(null===e)return!0;o.debug(e+" "+t,4);var r=this.patterns;return r.hasOwnProperty(t)?r[t].test(e):null}};t.exports=i},{"./Log.js":119}],132:[function(e,t,r){"use strict";var o=e("./Log.js").Logger("libZotero:Writer"),i=function(e,t,r){this.libraryType=e,this.libraryID=t,this.apiKey=r};i.prototype.writeObjects=function(e,t){var r=this.libraryType,i=this.libraryID,n=(new Zotero.RequestConfig).LibraryType(r).LibraryID(i);n.Key(this.apiKey),n.Target(t);var u=s(e),l=a(u),p=function(e){return o.debug("write successCallback",3),c(this.writeChunk,e),e.returnObjects=this.writeChunk,e},d=[];return u.forEach(function(e,t){var r={writeChunk:e},o=JSON.stringify(l[t]);d.push({url:n.config,type:"POST",data:o,processData:!1,success:p.bind(r)})}),Zotero.net.queueRequest(d).then(function(e){return o.debug("Done with writeObjects sequentialRequests promise",3),e})},i.prototype.writeItems=function(e){var t=n(e);return this.writeObjects(t,"items")};var n=function(e){for(var t,r=[],o=0;o<e.length;o++){t=e[o];var i=t.get("key");if(""===i||null===i){var n=Zotero.utils.getKey();t.set("key",n),t.set("version",0)}if(r.push(t),t.hasOwnProperty("notes")&&t.notes.length>0){for(var s=0;s<t.notes.length;s++)t.notes[s].set("parentItem",t.get("key"));r=r.concat(t.notes)}if(t.hasOwnProperty("attachments")&&t.attachments.length>0){for(var a=0;a<t.attachments.length;a++)t.attachments[a].set("parentItem",t.get("key"));r=r.concat(t.attachments)}}return r},s=function(e){for(var t=50,r=[],o=0;o<e.length;o+=t)r.push(e.slice(o,o+t));return r},a=function(e){for(var t=[],r=0;r<e.length;r++){t[r]=[];for(var o=0;o<e[r].length;o++)t[r].push(e[r][o].writeApiObj())}return t},c=function(e,t){o.debug("updateObjectsFromWriteResponse",3),o.debug("statusCode: "+t.status,3);var r=t.data;200==t.status?(o.debug("newLastModifiedVersion: "+t.lastModifiedVersion,3),r.hasOwnProperty("success")&&Object.keys(r.success).forEach(function(o){var i=parseInt(o,10),n=r.success[o],s=e[i];if(""!==s.key&&s.key!==n)throw new Error("object key mismatch in multi-write response");""===s.key&&s.updateObjectKey(n),s.set("version",t.lastModifiedVersion),s.synced=!0,s.writeFailure=!1}),r.hasOwnProperty("failed")&&(o.debug("updating objects with failed writes",3),Object.keys(r.failed).forEach(function(t){var i=r.failed[t];o.error("failed write "+t+" - "+i);var n=parseInt(t,10),s=e[n];s.writeFailure=i}))):204==t.status&&(e[0].synced=!0)};t.exports=i},{"./Log.js":119}],133:[function(e,t,r){(function(r){"use strict";var o=e("./Log.js").Logger("libZotero");if("undefined"==typeof window){var i=r;i.XMLHttpRequest||(i.XMLHttpRequest=e("w3c-xmlhttprequest").XMLHttpRequest)}else{var i=window;"undefined"==typeof Promise&&e("es6-promise").polyfill()}var n={};i.Zotero=i.Z=n,n.Cache=e("./Cache.js"),n.Ajax=n.ajax=e("./Ajax.js"),n.ApiObject=e("./ApiObject.js"),n.ApiResponse=e("./ApiResponse.js"),n.Net=n.net=e("./Net.js"),n.Library=e("./Library.js"),n.Container=e("./Container"),n.Collections=e("./Collections.js"),n.Items=e("./Items.js"),n.Tags=e("./Tags.js"),n.Groups=e("./Groups.js"),n.Searches=e("./Searches.js"),n.Deleted=e("./Deleted.js"),n.Collection=e("./Collection.js"),n.Localizations=n.localizations=e("./Localizations.js"),n.Item=e("./Item.js"),n.Tag=e("./Tag.js"),n.Search=e("./Search.js"),n.Group=e("./Group.js"),n.User=e("./User.js"),n.Utils=n.utils=e("./Utils.js"),n.Url=n.url=e("./Url.js"),n.File=n.file=e("./File.js"),n.Idb=e("./Idb.js"),n.Preferences=e("./Preferences.js"),n.Client=e("./Client.js"),n.Fetcher=e("./Fetcher.js"),n.Writer=e("./Writer.js"),n.TagColors=e("./TagColors.js"),n.Validator=e("./Validator.js"),n.RequestConfig=e("./RequestConfig.js"),n.extend=e("./Extend.js"),n.eventmanager={callbacks:{}};var s=e("./Events.js"),a=s.trigger,c=s.listen;n.trigger=a,n.listen=c,n.libraries={},n.config=e("./DefaultConfig.js"),n.catchPromiseError=function(e){o.error(e)},n.ajaxRequest=function(e,t,r){o.debug("Zotero.ajaxRequest ==== "+e,3),t||(t="GET"),r||(r={});var i={url:e,type:t};return i=Z.extend({},i,r),o.debug(i,3),n.net.queueRequest(i)},n.init=e("./Init.js"),n.init(),t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Ajax.js":96,"./ApiObject.js":97,"./ApiResponse.js":98,"./Cache.js":99,"./Client.js":100,"./Collection.js":101,"./Collections.js":102,"./Container":103,"./DefaultConfig.js":104,"./Deleted.js":105,"./Events.js":106,"./Extend.js":107,"./Fetcher.js":108,"./File.js":109,"./Group.js":110,"./Groups.js":111,"./Idb.js":112,"./Init.js":113,"./Item.js":114,"./Items.js":116,"./Library.js":117,"./Localizations.js":118,"./Log.js":119,"./Net.js":120,"./Preferences.js":121,"./RequestConfig.js":122,"./Search.js":123,"./Searches.js":124,"./Tag.js":125,"./TagColors.js":126,"./Tags.js":127,"./Url.js":128,"./User.js":129,"./Utils.js":130,"./Validator.js":131,"./Writer.js":132,"es6-promise":82,"w3c-xmlhttprequest":1}]},{},[133])(133)});